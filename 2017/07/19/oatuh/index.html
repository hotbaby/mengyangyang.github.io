<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>OAuth | Mengyy&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="OAuth">
  
  
  
  
  <meta name="description" content="OAuth客户端使用一个访问令牌(access token)来访问受保护的资源，其中访问令牌包含了特殊作用域(specific scope), 生命周期，和其他的访问属性。访问令牌由授权服务器在资源拥有者授权之后颁发(issue)。客户端通过访问令牌资源服务器上受保护资源。 比如，一个终端用户(resource-owner)可以授权打印服务器(client)访问他的存储在图片分享服务(resour">
<meta name="keywords" content="OAuth">
<meta property="og:type" content="article">
<meta property="og:title" content="OAuth">
<meta property="og:url" content="http://mengyangyang.org/2017/07/19/oatuh/index.html">
<meta property="og:site_name" content="Mengyy&#39;s Blog">
<meta property="og:description" content="OAuth客户端使用一个访问令牌(access token)来访问受保护的资源，其中访问令牌包含了特殊作用域(specific scope), 生命周期，和其他的访问属性。访问令牌由授权服务器在资源拥有者授权之后颁发(issue)。客户端通过访问令牌资源服务器上受保护资源。 比如，一个终端用户(resource-owner)可以授权打印服务器(client)访问他的存储在图片分享服务(resour">
<meta property="og:locale" content="en_US.UTF-8">
<meta property="og:image" content="http://processon.com/chart_image/59633488e4b0c2773f86cf4c.png">
<meta property="og:image" content="http://processon.com/chart_image/59660f76e4b09c8a2926274f.png">
<meta property="og:image" content="http://processon.com/chart_image/5966de55e4b09c8a29265aaf.png">
<meta property="og:updated_time" content="2020-01-30T11:36:23.884Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OAuth">
<meta name="twitter:description" content="OAuth客户端使用一个访问令牌(access token)来访问受保护的资源，其中访问令牌包含了特殊作用域(specific scope), 生命周期，和其他的访问属性。访问令牌由授权服务器在资源拥有者授权之后颁发(issue)。客户端通过访问令牌资源服务器上受保护资源。 比如，一个终端用户(resource-owner)可以授权打印服务器(client)访问他的存储在图片分享服务(resour">
<meta name="twitter:image" content="http://processon.com/chart_image/59633488e4b0c2773f86cf4c.png">
  
    <link rel="alternate" href="/atom.xml" title="Mengyy&#39;s Blog" type="application/atom+xml">
  
  <link rel="icon" href="/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/fashion.css">
  <link rel="stylesheet" href="/css/glyphs.css">

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  


<header id="allheader" class="site-header" role="banner" 
   >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="Mengyy&#39;s Blog" rel="home"> Mengyy&#39;s Blog </a>
            
          </h1>
          
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-oatuh" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      OAuth
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/07/19/oatuh/" class="article-date">
	  <time datetime="2017-07-19T14:30:45.000Z" itemprop="datePublished">July 19, 2017</time>
	</a>



        <!-- 不蒜子统计 -->
        <span id="busuanzi_container_page_pv" style='display:none' class="article-date">
              <i class="icon-smile icon"></i> 阅读数：<span id="busuanzi_value_page_pv"></span>次
        </span>



       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>OAuth客户端使用一个访问令牌(access token)来访问受保护的资源，其中访问令牌包含了特殊作用域(specific scope), 生命周期，和其他的访问属性。访问令牌由授权服务器在资源拥有者授权之后颁发(issue)。客户端通过访问令牌资源服务器上受保护资源。</p>
<p>比如，一个终端用户(resource-owner)可以授权打印服务器(client)访问他的存储在图片分享服务(resource server)上的受保护的图片，但不用与打印服务器分享他的用户名和密码。他可以授权图片分享服务(authorization server)颁发一个特殊的证书(access token).</p>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><h2 id="Roles"><a href="#Roles" class="headerlink" title="Roles"></a>Roles</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource owner</td>
<td>一个能授权访问受保护资源的实体</td>
</tr>
<tr>
<td>resource server</td>
<td>托管受保护资源的服务器，能处理通过访问令牌访问受保护资源的请求</td>
</tr>
<tr>
<td>client</td>
<td>代表资源拥有者发起访问受保护资源的请求的应用程序</td>
</tr>
<tr>
<td>authorization server</td>
<td>在资源拥有者认证、授权之后，能够颁发访问令牌给客户端的服务器</td>
</tr>
</tbody>
</table>
<h2 id="Protocol-Flow"><a href="#Protocol-Flow" class="headerlink" title="Protocol Flow"></a>Protocol Flow</h2><p><img src="http://processon.com/chart_image/59633488e4b0c2773f86cf4c.png" alt></p>
<h2 id="Authorization-Grant"><a href="#Authorization-Grant" class="headerlink" title="Authorization Grant"></a>Authorization Grant</h2><p>授权grant是一个证书表示资源拥有者已经授权，客户端可以用授权grant获取访问令牌。该规范定义4种授权类型：</p>
<ul>
<li>authorization code</li>
<li>implicit</li>
<li>resource owner password credentials</li>
<li>client credentials</li>
</ul>
<h2 id="Access-Token"><a href="#Access-Token" class="headerlink" title="Access Token"></a>Access Token</h2><p>访问令牌是一种证书用来访问受保护的资源。一个访问令牌就是认证服务器颁发给客户端的字符串。令牌包含了特殊作用域，过期时间，授权的资源拥有者等信息。</p>
<h2 id="Refresh-Token"><a href="#Refresh-Token" class="headerlink" title="Refresh Token"></a>Refresh Token</h2><p>刷新令牌也是一个证书用来获取访问令牌。刷新令牌是认证服务器发放给客户端的，在当访问令牌不可用或过期时，用来获取新的访问令牌。</p>
<p>刷新令牌是资源资源拥有者授权给客户端认证码。与访问令牌不同，刷新令牌只能与认证服务器通信，不能从资源服务器获取资源。</p>
<p><a href="http://processon.com/chart_image/59660f76e4b09c8a2926274f.png" target="_blank" rel="noopener"><img src="http://processon.com/chart_image/59660f76e4b09c8a2926274f.png" alt="Refreshing an Expired Access Token"></a>Refreshing an Expired Access Token</p>
<h1 id="Client-Registration"><a href="#Client-Registration" class="headerlink" title="Client Registration"></a>Client Registration</h1><p>在使用OAuth协议之前，客户端需要在认证服务器注册应用。</p>
<p>客户端注册是让认证服务器能够识别、信任客户端，其中包括客户端类型，重定向URI等。</p>
<h2 id="Client-Types"><a href="#Client-Types" class="headerlink" title="Client Types"></a>Client Types</h2><p>OAuth定义了两种客户端类型</p>
<ul>
<li>confidential - 客户端能够管理证书的机密性</li>
<li>public - 客户端不能管理证书的机密性</li>
</ul>
<h2 id="Client-Identifier"><a href="#Client-Identifier" class="headerlink" title="Client Identifier"></a>Client Identifier</h2><p>认证服务器给已注册的客户端颁发一个客户端标识。对于认证服务器，客户端标识是唯一的。</p>
<h2 id="Client-Authentication"><a href="#Client-Authentication" class="headerlink" title="Client Authentication"></a>Client Authentication</h2><p>如果客户端类型是confidential, 客户端和认证服务器建立一个客户端认证方法。Confidential客户端会向认证服务器声明它支持证书，比如密码或公私钥对。</p>
<h1 id="Obtaining-Authorization"><a href="#Obtaining-Authorization" class="headerlink" title="Obtaining Authorization"></a>Obtaining Authorization</h1><p>在请求访问令牌之前，客户端先要获取资源拥有者的授权。OAuth定义了4种授权类型: authorization code, implicit, resource owner password credential, 和client credentials.</p>
<h2 id="Authorization-Code-Grant"><a href="#Authorization-Code-Grant" class="headerlink" title="Authorization Code Grant"></a>Authorization Code Grant</h2><p>授权码授权类型用来获取访问令牌和刷新令牌。</p>
<p>认证码获取流程:</p>
<p><img src="http://processon.com/chart_image/5966de55e4b09c8a29265aaf.png" alt></p>
<h3 id="Authorization-Request"><a href="#Authorization-Request" class="headerlink" title="Authorization Request"></a>Authorization Request</h3><p><code>Content-Type: application/x-www-form-urlencoded</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>response_type</td>
<td><strong>REQUIRED</strong>该值必须设置为”code”</td>
</tr>
<tr>
<td>client_id</td>
<td><strong>REQUIRED</strong>注册的应用的id</td>
</tr>
<tr>
<td>redirect_uri</td>
<td><strong>OPTIONAL</strong>重定向URI，成功获取授权码后重定向到oauth客户端的URI</td>
</tr>
<tr>
<td>scope</td>
<td><strong>OPTIONAL</strong>作用域</td>
</tr>
<tr>
<td>state</td>
<td><strong>RECOMMENDED</strong>客户端用来管理请求、回调状态的值。认证服务器的重定向到UA时，会包含这个值。<strong>这个参数应该用来防止扩展请求伪造</strong></td>
</tr>
</tbody>
</table>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/o/authorize/?response_type=code&amp;client_id=wt6Pvm2s3vbb8RPE7nlPlugwaMnj58UhFpk8bCPp&amp;redirect_uri=http%3A%2F%2Flocalhost%3A8000%2Foauth%2Fauthorized%2F</span> HTTP/1.0</span><br><span class="line"><span class="attribute">Host</span>: localhost:8000</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate, sdch, br</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.8</span><br></pre></td></tr></table></figure>
<p>认证服务器会验证这个请求，保证请求中的所有参数都是有效的。如果请求是有效的，认证服务器需要资源拥有者授权。如果资源拥有者授权成功，授权服务器根据<code>redirect_uri</code>返回给UA一个重定向响应。</p>
<h3 id="Authorization-Response"><a href="#Authorization-Response" class="headerlink" title="Authorization Response"></a>Authorization Response</h3><p><code>Content-Type: application/x-www-form-urlencoded</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td><strong>REQUIRED</strong>认证服务器生成的授权码，为了防止泄露的危险，授权码必须在很短的时间过期。授权码生存期推荐为10min.客户端只能使用一次授权码。授权码与客户端id,重定向URI绑定</td>
</tr>
<tr>
<td>state</td>
<td><strong>REQUIRED</strong>如果客户端请求中包含state,授权服务器必须要返回该值</td>
</tr>
</tbody>
</table>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.0 <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Date</span>: Tue, 18 Jul 2017 04:12:00 GMT</span><br><span class="line"><span class="attribute">Server</span>: WSGIServer/0.1 Python/2.7.9</span><br><span class="line"><span class="attribute">X-Frame-Options</span>: SAMEORIGIN</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: *</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=utf-8</span><br><span class="line"><span class="attribute">Location</span>: http://localhost:8000/oauth/authorized/?code=x1yxsYhAJ23pXNMXej4tB13dvMFTov</span><br><span class="line"><span class="attribute">Vary</span>: Cookie</span><br></pre></td></tr></table></figure>
<h4 id="Error-Response"><a href="#Error-Response" class="headerlink" title="Error Response"></a>Error Response</h4><p><code>Conent-Type: application/x-www-form-urlencoded</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>error</td>
<td><strong>REQUIRED</strong></td>
</tr>
<tr>
<td>error_description</td>
<td><strong>OPTIONAL</strong></td>
</tr>
<tr>
<td>error_uri</td>
<td><strong>OPTIONAL</strong></td>
</tr>
<tr>
<td>state</td>
<td><strong>REQUIRED</strong></td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Location: https://client.example.com/cb?error=access_denied&amp;state=xyz</span><br></pre></td></tr></table></figure>
<h3 id="Access-Token-Request"><a href="#Access-Token-Request" class="headerlink" title="Access Token Request"></a>Access Token Request</h3><p><code>Conent-Type: application/x-www-form-urlencoded</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>grant_type</td>
<td><strong>REQUIRED</strong>该值必须设置“authorization_code”</td>
</tr>
<tr>
<td>code</td>
<td><strong>REQUIRED</strong>授权服务器返回的code</td>
</tr>
<tr>
<td>redirect_uri</td>
<td><strong>REQUIRED</strong>重定向URI</td>
</tr>
<tr>
<td>client_id</td>
<td><strong>REQUIRED</strong>注册应用的ID</td>
</tr>
</tbody>
</table>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/o/token/</span> HTTP/1.0</span><br><span class="line"><span class="attribute">Host</span>: localhost:8000</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Length</span>: 183</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span>: */*</span><br><span class="line"><span class="attribute">User-Agent</span>: python-requests/2.18.1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">grant_type=authorization_code&amp;code=x1yxsYhAJ23pXNMXej4tB13dvMFTov&amp;redirect_uri=http%3A%2F%2Flocalhost%3A8000%2Foauth%2Fauthorized%2F&amp;client_id=wt6Pvm2s3vbb8RPE7nlPlugwaMnj58UhFpk8bCPp</span><br></pre></td></tr></table></figure>
<p>认证服务器必须要验证客户端的请求</p>
<ul>
<li>对于confidential客户端，需要客户端认证</li>
<li>如果客户端包含认证信息，认证客户端</li>
<li>验证授权码是否有效</li>
<li>验证redirect_uri是否证券</li>
</ul>
<h3 id="Access-Token-Response"><a href="#Access-Token-Response" class="headerlink" title="Access Token Response"></a>Access Token Response</h3><p>如果获取访问令牌的请求是有效的而且认证通过，认证服务器需要发放访问令牌和可选的刷新令牌。如果请求是无效的或认证失败，需要返回一个错误响应。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Date: Tue, 18 Jul 2017 04:12:00 GMT</span><br><span class="line">Server: WSGIServer/0.1 Python/2.7.9</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-store</span><br><span class="line"></span><br><span class="line">&#123;&quot;access_token&quot;: &quot;4C1gRp2TfYKN0tO45fqa6BkFZxTJNU&quot;, &quot;token_type&quot;: &quot;Bearer&quot;, &quot;expires_in&quot;: 36000, &quot;refresh_token&quot;: &quot;oZX6XtV2OGSVRnvyOoa7qerWddOPKw&quot;, &quot;scope&quot;: &quot;read write&quot;&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Refreshing-an-Access-Token"><a href="#Refreshing-an-Access-Token" class="headerlink" title="Refreshing an Access Token"></a>Refreshing an Access Token</h1><p>如果认证服务器向客户端颁发了刷新令牌，客户端可以使用刷新令牌更新访问令牌。</p>
<p><code>Content-Type: application/x-www-form-urlencoded</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>grant_type</td>
<td><strong>REQUIRED</strong>该值必须设置为”refresh_token”</td>
</tr>
<tr>
<td>refresh_token</td>
<td><strong>REQUIRED</strong>认证服务器颁发的刷新令牌</td>
</tr>
<tr>
<td>scope</td>
<td><strong>OPTIONAL</strong></td>
</tr>
</tbody>
</table>
<p>刷新令牌是长期存在证书用来更新访问令牌，刷新令牌必须要与客户端id绑定。此外，客户端必须向认证服务器提供认证信息。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/o/token/</span> HTTP/1.0</span><br><span class="line"><span class="attribute">Host</span>: localhost:8000</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Length</span>: 69</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span>: */*</span><br><span class="line"><span class="attribute">User-Agent</span>: python-requests/2.18.1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Authorization</span>: Basic d3Q2UHZtMnMzdmJiOFJQRTdubFBsdWd3YU1uajU4VWhGcGs4YkNQcDpWcUF3NDlwb3VXc0lUVU1OcWFrdzczQ0NSRVZzclMyRWd5SG9WeVJnekpWNWRlWnNKQUNBeVdkeEFJMXZRc2RaZk1JQmlCRlRFeUR5YUkyeTJJcU1vR3JEbkFNWE5ITWd4TFRJUDIxRXhIR0tkUmNTVlJ5RjRxOHA5STR5OWhqVQ==</span><br><span class="line"></span><br><span class="line">grant_type=refresh_token&amp;refresh_token=oZX6XtV2OGSVRnvyOoa7qerWddOPKw</span><br></pre></td></tr></table></figure>
<p>Response:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.0 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Tue, 18 Jul 2017 06:47:50 GMT</span><br><span class="line"><span class="attribute">Server</span>: WSGIServer/0.1 Python/2.7.9</span><br><span class="line"><span class="attribute">X-Frame-Options</span>: SAMEORIGIN</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Pragma</span>: no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span>: no-store</span><br><span class="line"></span><br><span class="line">&#123;"access_token": "gebkQX71vIwmksTsvleRKMzpdysLHY", "token_type": "Bearer", "expires_in": 36000, "refresh_token": "CbpaNXAqyexTQOuCvQf1RUoEN2EZeX", "scope": "read write"&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Accessing-Protected-Resources"><a href="#Accessing-Protected-Resources" class="headerlink" title="Accessing Protected Resources"></a>Accessing Protected Resources</h1><p>客户端可以同访问访问资源服务器受保护的资源。资源服务器必须要验证访问令牌，保证访问令牌没有过期，并且其作用域能覆盖此资源。</p>
<h2 id="Access-Token-Types"><a href="#Access-Token-Types" class="headerlink" title="Access Token Types"></a>Access Token Types</h2><p>“bearer”令牌类型，参考<a href="https://tools.ietf.org/html/rfc6750" target="_blank" rel="noopener">RFC6750</a></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/resource/1</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: example.com</span><br><span class="line"><span class="attribute">Authorization</span>: Bearer mF_9.B5f-4.1JqM</span><br></pre></td></tr></table></figure>
<p>“mac”令牌类型</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/resource/1</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: example.com</span><br><span class="line"><span class="attribute">Authorization</span>: MAC id="h480djs93hd8",</span><br><span class="line">               nonce="274312:dj83hs9s",</span><br><span class="line">               mac="kDZvddkndxvhGRXZhvuDjEWhGeE="</span><br></pre></td></tr></table></figure>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://oauth.net/2/" target="_blank" rel="noopener">https://oauth.net/2/</a></li>
<li><a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc6749</a></li>
<li><a href="https://github.com/evonove/django-oauth-toolkit" target="_blank" rel="noopener">https://github.com/evonove/django-oauth-toolkit</a></li>
<li><a href="https://oauth.net/articles/authentication/" target="_blank" rel="noopener">https://oauth.net/articles/authentication/</a></li>
<li><a href="https://www.oauth.com/" target="_blank" rel="noopener">https://www.oauth.com</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OAuth/">OAuth</a></li></ul>

      
        
    <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
    <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>

	<style>
	.gitment-editor-tab:hover {
		background: none
	}
	</style>
    <div id="comment"></div>
	<script type="text/javascript">
    function renderGitment(){
      var gitment = new Gitment({
          id: window.location.pathname,
          owner: 'hotbaby',
          repo: 'blog-comment',
          oauth: {
              client_secret:'527e06c77f169bb5847b22681e0cc0f413c1e973',
              client_id: '862b359cec66adf51707'
          }});
      gitment.render('comment');
    }
    renderGitment();
    </script>


      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/07/29/http-cache/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          HTTP缓存
        
      </div>
    </a>
  
  
    <a href="/2017/07/18/python-metaclass/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Python元类</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Roles"><span class="nav-number">1.1.</span> <span class="nav-text">Roles</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Protocol-Flow"><span class="nav-number">1.2.</span> <span class="nav-text">Protocol Flow</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Authorization-Grant"><span class="nav-number">1.3.</span> <span class="nav-text">Authorization Grant</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Access-Token"><span class="nav-number">1.4.</span> <span class="nav-text">Access Token</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Refresh-Token"><span class="nav-number">1.5.</span> <span class="nav-text">Refresh Token</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Client-Registration"><span class="nav-number">2.</span> <span class="nav-text">Client Registration</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Client-Types"><span class="nav-number">2.1.</span> <span class="nav-text">Client Types</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Client-Identifier"><span class="nav-number">2.2.</span> <span class="nav-text">Client Identifier</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Client-Authentication"><span class="nav-number">2.3.</span> <span class="nav-text">Client Authentication</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Obtaining-Authorization"><span class="nav-number">3.</span> <span class="nav-text">Obtaining Authorization</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Authorization-Code-Grant"><span class="nav-number">3.1.</span> <span class="nav-text">Authorization Code Grant</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Authorization-Request"><span class="nav-number">3.1.1.</span> <span class="nav-text">Authorization Request</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Authorization-Response"><span class="nav-number">3.1.2.</span> <span class="nav-text">Authorization Response</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Error-Response"><span class="nav-number">3.1.2.1.</span> <span class="nav-text">Error Response</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-Token-Request"><span class="nav-number">3.1.3.</span> <span class="nav-text">Access Token Request</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-Token-Response"><span class="nav-number">3.1.4.</span> <span class="nav-text">Access Token Response</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Refreshing-an-Access-Token"><span class="nav-number">4.</span> <span class="nav-text">Refreshing an Access Token</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Accessing-Protected-Resources"><span class="nav-number">5.</span> <span class="nav-text">Accessing Protected Resources</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Access-Token-Types"><span class="nav-number">5.1.</span> <span class="nav-text">Access Token Types</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-number">5.2.</span> <span class="nav-text">References</span></a></li></ol></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2020 Mengyy&#39;s Blog All Rights Reserved.
         
      </div>

	
	        <!-- 不蒜子统计 -->
	        <span id="busuanzi_container_site_pv">
	                本站总访问量<span id="busuanzi_value_site_pv"></span>次
	        </span>
	        <span class="post-meta-divider">|</span>
	        <span id="busuanzi_container_site_uv" style='display:none'>
	                本站访客数<span id="busuanzi_value_site_uv"></span>人
	        </span>
	        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	  

      <div class="site-credit">
        <!--
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
        -->
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
    
</script>

    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>










	<script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?{{ theme.baidu_analytics }}";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
