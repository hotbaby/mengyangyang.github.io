<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Mengyy&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta name="keywords" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Mengyy&#39;s Blog">
<meta property="og:url" content="http://mengyangyang.org/page/4/index.html">
<meta property="og:site_name" content="Mengyy&#39;s Blog">
<meta property="og:locale" content="en_US.UTF-8">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mengyy&#39;s Blog">
  
    <link rel="alternate" href="/atom.xml" title="Mengyy&#39;s Blog" type="application/atom+xml">
  
  <link rel="icon" href="/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/fashion.css">
  <link rel="stylesheet" href="/css/glyphs.css">

</head>
</html>


  <body>


  


<header id="allheader" class="site-header" role="banner" 
   >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="Mengyy&#39;s Blog" rel="home"> Mengyy&#39;s Blog </a>
            
          </h1>
          
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">

  
    <article id="post-nodejs"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/28/nodejs/">安装Node.js</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/28/nodejs/" class="article-date">
	  <time datetime="2017-10-27T16:00:00.000Z" itemprop="datePublished">October 28, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -;</span><br><span class="line">sudo apt-get install -y nodejs;</span><br></pre></td></tr></table></figure>
<h3 id="Mac-OSX"><a href="#Mac-OSX" class="headerlink" title="Mac OSX"></a>Mac OSX</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl "https://nodejs.org/dist/latest/node-$&#123;VERSION:-$(wget -qO- https://nodejs.org/dist/latest/ | sed -nE 's|.*&gt;node-(.*)\.pkg&lt;/a&gt;.*|\1|p')&#125;.pkg" &gt; "$HOME/Downloads/node-latest.pkg" &amp;&amp; sudo installer -store -pkg "$HOME/Downloads/node-latest.pkg" -target "/";</span><br><span class="line">brew install node;</span><br></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://nodejs.org/en/download/package-manager/" target="_blank" rel="noopener">https://nodejs.org/en/download/package-manager/</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node-js/">Node.js</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-旅行写作编程"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/24/旅行写作编程/">旅行，写作，编程</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/24/旅行写作编程/" class="article-date">
	  <time datetime="2017-10-24T14:37:51.000Z" itemprop="datePublished">October 24, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>花了10个月的时间做世界环游，途经非洲，东南亚，澳洲，中南美洲里的17个国家和地区。这次旅行的主题就是冲浪和摄影。<br>出席在香港，日本，美国和伦敦举行的会议<br>启程时给O’Reilly出版公司写了一本书，书名叫做《JavaScript Web Applications》<br>另外写了一本关于CoffeeScript的书，很快就会由O’Reilly公司出版。<br>写了大量的开源库，例如Spine, Spine.Mobile, GFX, 和 Juggernaut.<br>筹划了一个创业公司的框架<br>出席伦敦2011FOWA会议<br>最后，我在Twitter公司找到了一份工作<br>那么，让我从一年前开始，那是2010年9月，我刚好从一个我合作创办的公司里出来，尽管这段经历是很有价值的，但无休无止的长时间苦干让我精疲力 尽。我回到了英格兰，需要对未来做一些思考。我一直有一个梦想——移居美国(几年就好)，所以，我在Google记事本上写了下面的话：</p>
<p>人生的选择：<br>去纽约哥伦比亚大学深造<br>坏处 - 非常昂贵，并不一定能学到什么真正有用的东西，无聊?<br>好处 - 那是一个纽约的大学！<br>写一本书，申请 01 签证<br>坏处 - 需要大量的时间，有风险<br>好处 - 对事业有好处，有趣<br>等待。去纽约度一次假(3个月)。等待创业签证。<br>很容易 - 不是那么有趣</p>
<p>也许选第二个，不行就选3？<br>最终我选择了2，我已经对JavaScript web应用研究了很久，我要写一本这方面的书，为什么不边做环游世界的旅行、边写书呢？这也是我一个梦想呀。我从oneworld买了一份环游世界的机票(比你们想象的要便宜)，决定下周去我的第一站，南非。</p>
<p>如果你从来没有到过非洲，你应该去一次。那里的景色原始而美丽，对那些没有体验过这种景色的人，你很难用言语描绘明白。几年前我就喜欢上了南 方，那时我在东海岸做了一个为期3个月的冲浪旅行。这次，我只有一个月的时间，穿越特兰斯凯，从开普敦到德班。当我在南非旅行时，我的写作也开始了，把早 期向O’Reilly提交的书的框架里的数章填充了材料。</p>
<p>特兰斯凯是南非非常具有乡野特色的地方，到处是连绵的小山，一些小村庄和土堆的茅屋。他们仍然沿袭着酋长制度，有一个首领，大多数的当地人靠捕 鱼为生。我们在高低不平的土路上颠了两天才到达我心仪的地方，一个美丽的海湾，叫做咖啡湾(Coffee Bay)。在那里，我休整了一下，从网上下载了一些相关资料，为更远的海湾远征做准备。</p>
<p>我还清晰的记得我们走了数里地来到那个未开垦的海滩，我们从那些一个个被黄沙和小丘孤立的村庄穿行而过。有一个地方，我们要过一条大河，我们需 要游过去，我把背包举过头顶，以免里面的相机和iPod遇到水。非洲是一个让你脱离尘世的地方，解放你的思想，重新认识人生最重要的东西是什么。</p>
<p>下一站是香港，在那里，我度过了我的21岁生日，接着，我从陆路由新加坡到越南河内。很多人不相信香港70%的面积由自然公园覆盖，我徒步走了几条精彩的景观路线，非常的精彩壮观，比如：香港龙脊。有几天，我在boot.hk这个网站上闲逛，这是一个协作工作的网站，我顺便教了一个同行的游客如何使用ruby。然后，到了夜里，我跟Soho里的一些冲浪爱好者狂欢到凌晨。</p>
<p>从泰国到柬埔寨到越南是我这次旅行中做喜欢的部分，如果你从没有到过亚洲，你绝对应该去一次。这些国家非常的漂亮，气候非常的好，食物美味可口，人们非常友善。吴哥窟是世上最神奇的地方之一，每个人都应该去看看。是Trey Ratcliff的照片把我吸引到了那里，我的很多其它旅游目的地也是受了他的影响。那个家伙是很多旅游地的第一宣传者。</p>
<p>在一些无名的小博客中，我听有人说过一个很远的美丽的小岛，在柬埔寨的海边。说小岛的Sihanoukville这个地方有个酒吧，说只能坐小 渔船到那里。我，还有几个非常好的朋友，乘坐晚上的大巴，开始寻找这个传说中的酒吧。搜索差不多进行了一整天，每一个问过的酒吧都把我们指向另外一个酒 吧。最终，我们问了出来，并在第二天早晨做短程巴士去了那个地方。</p>
<p>上面的照片上是海岸边一个10美元一晚的小木屋。从当地居民区离开后，我们的队伍像小岛上唯一的人，我们随性自由的奔跑。白天我们懒懒的躺在海滩上，吃着岛上厨师准备的鲜美可口的水果沙拉，在夜晚，我们在到处是浮游生物的海里游泳。</p>
<p>下一站是越南，我们沿着湄公河支流来到一个边界上的小镇，我们是这里唯一的西方人，交流成了最大的问题。幸运的是，我们发现一个也许是镇上唯一会说英语的人，他骑车当我们的向导。当我的信用卡被那里的一个自动取款机吞掉了后，他提供了我很大的帮助！</p>
<p>我们的队伍分成了几路，在我到达越南时，我的书正在按计划完成，进行的非常顺利。此时，我在西贡多待了几周，让我在书的好几章上有了重大的进展，正好是中国旧历新年，气氛非常的壮观热闹。</p>
<p>接着是日本，澳大利亚，新西兰和夏威夷。我很难把我所有的感受都在这篇文章里写出来，但说这是此生难忘的一段历程是不为过的。把如此多的美景都 放到一个国家里，太让人赞叹了,我说的正是新西兰。我最喜爱的一段记忆是沿着Wanaka的一个湖边在阳光下跑步，还有就是背着食物和生活用品，徒步数天 穿越Routeburn的大山。在这个国家的旅途中，我结识了好几个值得一生相伴的好友。这是一个真正的天堂。</p>
<p>就在我环绕新西兰的南部岛屿时，我的书终于完成了，提交给了技术编辑校对。</p>
<p>接下来是纽约和旧金山，这两个神奇的地方到处是天才的程序员，有些人我很幸运的认识。Techcrunch Disrupt办的很精彩(我高度推荐hackathon)。</p>
<p>在从纽约到旧金山的中途停留期间，我在各种公司了进行了不少的求职面试，最终在Twitter公司找到了一份做前端开发的工作。要在那里和杰出的团队一起工作，我不能不高兴的颤抖，而去旧金山，同样也是我此生的一个梦想。</p>
<p>当签证的事办下来了后，我去了中、南美洲旅行，同时开发了我的一个小工程：一个JavaScript MVC框架库，叫做Spine。我到了哥斯达黎加，巴拿马，秘鲁，Bolvia，和阿根廷。 秘鲁是我的最爱，尽管那里的海拔给我带来了不少麻烦，我大部分的时间都在探险。下面的图片是哥斯达黎加传说中神奇猎鹰，是在我爬下世界最深的峡谷时拍到的。</p>
<p>当我在哥斯达黎加时，微博上有个叫Roberto的家伙给我发了条信息，说他读了我的书，问我是否有兴趣一起冲浪。我欣然同意，坐上去圣何塞的 汽车，在几天后和他会了面。那天我们一起在他海边的公寓里开发Spine和Ruby项目，使用移动硬盘，用汽车电源给笔记本充电。当电量不足后，让太阳能 板补充能量，我们去冲浪。</p>
<p>我推荐大家去写一本书，特别是边旅游边写书。可以想象，如果我不去旧金山去看一看，我可能还在旅途中，做顾问，去创业。当作家并不能让你直接的 挣到很多钱，但它绝对能提升你的身份地位，给你带来很多潜在的机会。事实上，写作过程让我真正享受的是，我可以认真深入的研究一个题目。</p>
<p>这一年是我这辈子目前为止最好的一年，而我感觉今后的一年会更好。当我如今定居下来后，我并没有感觉旅行对我的吸引力减少了；我始终把签证放到一个口袋里，而另一个口袋里装着钱包，当召唤降临，随时准备离开。</p>
<p>可是，这篇文章并不是关于我的旅行，它是要发送一个信号：</p>
<p>对于程序员来说，有个得天独厚的条件，就是这种职业可以远程工作或边旅游边工作，这是其它职业办不到的。当然，也不都是这样，在我的旅途中，我 没有碰到第二个跟我的做法相似的程序员。这种情况让人悲哀。我想向程序员们送出的信息是，不要再找借口了，行动起来，你可以做到。一个人只有一生，我可以 向你保证，这样的生活才不枉世间走这一遭。</p>
<p>就像我，我感到极度的幸运，能这样的生活，去发现我的热情所在，去做每天我喜欢做的事情。你可以看出，大部分我现在的境遇并非偶然或侥幸，这是计划，追求，工作的结果。</p>
<p>一份汗水，一份收成。</p>
<p>这篇文章的目标不是做一些自我陶醉似的炫耀和大话，而是向大家演示如何立下目标，鼓励大家去做相似的事情。想清楚你现在的处境，这一年内你想得到什么，制定出一系列具体的能让你到达这些目标的步骤。追随你的梦想。</p>
<p>原文地址：<a href="https://www.oschina.net/news/23952/traveling_writing_programming" target="_blank" rel="noopener">https://www.oschina.net/news/23952/traveling_writing_programming</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-django-queryset"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/23/django-queryset/">Django QuerySet</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/23/django-queryset/" class="article-date">
	  <time datetime="2017-10-23T08:41:04.000Z" itemprop="datePublished">October 23, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="字段查找过滤"><a href="#字段查找过滤" class="headerlink" title="字段查找过滤"></a>字段查找过滤</h3><table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>__exact</td>
<td>精确等于 like ‘aaa’</td>
</tr>
<tr>
<td>__iexact</td>
<td>精确等于 忽略大小写 ilike ‘aaa’</td>
</tr>
<tr>
<td>__contains</td>
<td>包含 like ‘%aaa%’</td>
</tr>
<tr>
<td>__icontains</td>
<td>包含 忽略大小写 ilike ‘%aaa%’，但是对于sqlite来说，contains的作用效果等同于icontains。</td>
</tr>
<tr>
<td>__gt</td>
<td>大于</td>
</tr>
<tr>
<td>__gte</td>
<td>大于等于</td>
</tr>
<tr>
<td>__lt</td>
<td>小于</td>
</tr>
<tr>
<td>__lte</td>
<td>小于等于</td>
</tr>
<tr>
<td>__in</td>
<td>存在于一个list范围内</td>
</tr>
<tr>
<td>__startswith</td>
<td>以…开头</td>
</tr>
<tr>
<td>__istartswith</td>
<td>以…开头 忽略大小写</td>
</tr>
<tr>
<td>__endswith</td>
<td>以…结尾</td>
</tr>
<tr>
<td>__iendswith</td>
<td>以…结尾，忽略大小写</td>
</tr>
<tr>
<td>__range</td>
<td>在…范围内</td>
</tr>
<tr>
<td>__year</td>
<td>日期字段的年份</td>
</tr>
<tr>
<td>__month</td>
<td>日期字段的月份</td>
</tr>
<tr>
<td>__day</td>
<td>日期字段的日</td>
</tr>
</tbody>
</table>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://docs.djangoproject.com/en/1.7/ref/models/querysets/" target="_blank" rel="noopener">Django QuerySet API Reference</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/">Django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-当我跑步时我谈些什么"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/18/当我跑步时我谈些什么/">当我跑步时，我谈些什么</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/18/当我跑步时我谈些什么/" class="article-date">
	  <time datetime="2017-10-18T14:34:28.000Z" itemprop="datePublished">October 18, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>在肉体上时痛苦的，在精神上，令人沮丧的局面有时也会出现。不过，“痛苦”对于这一运动，乃是前提条件的东西。不伴随着痛苦，还有谁来挑战铁人三项赛事和全程马拉松这种费时耗力的运动呢？正因为痛苦，正因为刻意经历者这种痛苦，我才从这个过程中发现自己还活着的感觉，至少是发现了一部分。我现在意识到：生存的质量并非成绩、数字、名次之类固定的东西，而是含于运动中流动性的东西。</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/村上春树/">村上春树</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书/">读书</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/跑步/">跑步</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-http-cache"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/07/29/http-cache/">HTTP缓存</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/07/29/http-cache/" class="article-date">
	  <time datetime="2017-07-29T14:32:15.000Z" itemprop="datePublished">July 29, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>缓存是某个资源(或文档)的副本。对于私有缓存，可以服务同一个客户端的对同一个资源多次的请求，比如浏览器缓存。对于共享缓存(或代理缓存)，可以服务多个客户端对于同一个资源的请求，比如CDN。为什么需要缓存，缓存有哪些优点：</p>
<ul>
<li>减少网络延迟，更快的加载内容，提高用户体验</li>
<li>减少冗余数据传输，降低网络负载</li>
<li>降低服务器负载，服务器可以更快的处理请求</li>
</ul>
<h2 id="不同类型的缓存"><a href="#不同类型的缓存" class="headerlink" title="不同类型的缓存"></a>不同类型的缓存</h2><ul>
<li>私有缓存 - 服务于单个用户</li>
<li>共享缓存 -存储响应被很多用户复用</li>
</ul>
<p>其他缓存，gateway cache, CDN, reverse proxy cache 和　部署在服务器上的负载均衡器，以获得更好的可靠性和性能．</p>
<p><a href="http://www.processon.com/chart_image/597c3deee4b06e43d2d663b5.png" target="_blank" rel="noopener"><img src="http://www.processon.com/chart_image/597c3deee4b06e43d2d663b5.png" alt="HTTP Cache Type"></a>HTTP Cache Type</p>
<p><strong>私有浏览器缓存(Private browser cache)</strong></p>
<p>私有缓存服务于单个用户．</p>
<h3 id="共享代理缓存-Shared-proxy-caches"><a href="#共享代理缓存-Shared-proxy-caches" class="headerlink" title="共享代理缓存(Shared proxy caches)"></a>共享代理缓存(Shared proxy caches)</h3><p>共享缓存服务于多个用户．比如ISP或者企业可以配置一个web代理，作为本地网络基础架构，服务于多个用户．热点资源可以被多个用户复用，减少网络流量和延迟．　</p>
<p>常用的缓存条目的形式：</p>
<ul>
<li>成功的检索请求结果 - 200 OK响应，比如HTML 文档，图片或者文件</li>
<li>永久重定向 - 301(Moved Permanently)响应</li>
<li>错误响应 - 404(Not Found)结果页</li>
<li>未完成的结果 - 206(Partial Content)响应</li>
<li>不仅仅是GET请求的响应 - 定义一个合适的cache key</li>
</ul>
<h2 id="缓存处理步骤"><a href="#缓存处理步骤" class="headerlink" title="缓存处理步骤"></a>缓存处理步骤</h2><p>对于一个HTTP GET请求报文，基本缓存处理包含7个步骤：</p>
<ol>
<li>接收-缓存从网络中读取请求报文</li>
<li>解析-缓存对报文进行解析，提取HTTP首部信息</li>
<li>查询-缓存查询是否命中，如果没有，则从源服务器获取，并缓存到本地</li>
<li>新鲜度检测-检查副本是否新鲜，如果不新鲜，则与源服务器进行验证</li>
<li>响应-缓存用新的首部和缓存主体创建响应报文</li>
<li>发送-缓存通过网络将响应发送给客户端</li>
<li>日志-缓存记录这次请求的日志</li>
</ol>
<p>缓存处理流程图：<br><a href="http://www.processon.com/chart_image/597ca20ee4b06e43d2d675ec.png" target="_blank" rel="noopener"><img src="http://www.processon.com/chart_image/597ca20ee4b06e43d2d675ec.png" alt="HTTP_CACHE_GET_FLOW_CHART"></a>HTTP_CACHE_GET_FLOW_CHART</p>
<h2 id="缓存控制"><a href="#缓存控制" class="headerlink" title="缓存控制"></a>缓存控制</h2><p>服务器可以通过HTTP定义文档过期之前可以将其缓存多长时间。</p>
<ul>
<li>Cache-Control: no-store</li>
<li>Cache-Control: no-cache</li>
<li>Cache-Control: must-revalidate</li>
<li>Cache-Control: max-age</li>
<li>Expires</li>
</ul>
<p>no-store与no-cache</p>
<p>HTTP/1.1提供了几种限制对象缓存方式。 no-store和no-cache首部可以防止缓存未经证实的已缓存对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-store</span><br><span class="line">Cache-Control: no-cache</span><br></pre></td></tr></table></figure>
<p>标识为<code>no-store</code>的响应回禁止缓存对响应进行复制。标识为<code>no-cache</code>的响应可以在本地缓存中，只是在与服务器进行新鲜度再验证之前，缓存不能提供给客户端使用。</p>
<p><code>Cache-Control: max-age=3600</code>表示收到服务器响应文档处于新鲜状态的秒数。max-age=0表示不缓存文档。</p>
<p><code>Expires: Fri, 05 Jul 2017, 12:00:00 GMT</code>表示文档绝对过期时间。<strong>不推荐使用Expires</strong>，HTTP设计者后来任务，由于服务器之间的时间不同步或不正确，会导致文档新鲜度计算错误。</p>
<p>如果源服务器希望缓存严格遵守过期时间，可以在加<code>Cache-Control: must-revalidate</code>的HTTP首部。<code>Cache-Control: must-revalidate</code>响应告诉缓存，在事先没有跟源服务器再验证之前，不能提供这个对象的过期副本。缓存仍然可以提供新鲜的副本。如果缓存进行must-revalidate新鲜度是，源服务器不可用，缓存必须返回一条Gateway Timeout从错误。</p>
<h2 id="缓存命中"><a href="#缓存命中" class="headerlink" title="缓存命中"></a>缓存命中</h2><p>缓存命中、未命中和再验证：<br><a href="http://www.processon.com/chart_image/597c0011e4b06e43d2d653b8.png" target="_blank" rel="noopener"><img src="http://www.processon.com/chart_image/597c0011e4b06e43d2d653b8.png" alt="HTTP Cache Hit"></a>HTTP Cache Hit</p>
<p>缓存命中率</p>
<p>由缓存缓存提供服务的请求所占的比例成为称为缓存命中率(cache hit rate)。命中率在0到1之间，0表示缓存全部未命中，1表示缓存全部命中。缓存服务提供者希望缓存的命中是100%，而实际的缓存命中率与缓存大小，缓存内容变化，请求者兴趣相似度等因素相关。</p>
<h2 id="缓存新鲜度"><a href="#缓存新鲜度" class="headerlink" title="缓存新鲜度"></a>缓存新鲜度</h2><h3 id="文档过期"><a href="#文档过期" class="headerlink" title="文档过期"></a>文档过期</h3><p>就像牛奶过期一样，文档也有过期时间。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Cache-Control: max-age=484200</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Expires: Fri, 05 Jul 2017, 12:00:00 GMT</span><br></pre></td></tr></table></figure>
<p><code>Cache-Control: max-age=484200</code>是一个相对过期时间，max-age定义了文档的最大使用期，从第一次生成文档到文档不再新鲜为止，以秒为单位。</p>
<p><code>Expires:Fri, 05 Jul 2017, 12:00:00 GMT</code>是一个绝对过期时间，如果过期时间已经过了，则文档不再新鲜。该首部要<strong>时钟同步</strong>。</p>
<h3 id="服务器再验证"><a href="#服务器再验证" class="headerlink" title="服务器再验证"></a>服务器再验证</h3><p>缓存文档过期并不意味着该副本与服务器文档不一致，只是意味着要与源服务器进行再验证。</p>
<ul>
<li>如果再验证内容发生了变化，缓存获取新的副本，替换过期副本</li>
<li>如果再验证内容没有发生变化，缓存只需要获取新的首部，对缓存的副本的首部进行更新</li>
</ul>
<p>条件再验证HTTP首部：</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>If-Modify-Since:</td>
<td>如果从指定日期之后文档被修改过了，就执行该请求。可以与Last-Modified服务器响应首部配合使用，只有在内容被修改后，才去获取新的内容</td>
</tr>
<tr>
<td>If-None-Match:</td>
<td>服务器可以为文档提供特殊的标签，而不是将其与最近修改时间相匹配，这些标签就像序列号一样</td>
</tr>
</tbody>
</table>
<p>If-Modify-Since: Date再验证:</p>
<ul>
<li>如果自指定日期后，文档被修改了，If-Modify-Since条件为真，源服务器会返回成功的响应，包含新的过期首部和新文档实体</li>
<li>如果自指定日期后，文档未被修改，If-Modify-Since条件为假，源服务器会返回一个304 Not Modified的响应，不包含文档实体内容</li>
</ul>
<p><a href="http://www.processon.com/chart_image/597c3916e4b06e43d2d6618c.png" target="_blank" rel="noopener"><img src="http://www.processon.com/chart_image/597c3916e4b06e43d2d6618c.png" alt="img"></a></p>
<p>If-None-Match: Tags</p>
<p>有些情况下，仅使用最后修改时间是不够的。</p>
<ul>
<li>文档被周期性的重写，最后修改时间发生变化，而内容未改变</li>
<li>服务器无法判定最后修改时间</li>
</ul>
<p>HTTP允许用户对实体打标签，进行标识。</p>
<p><a href="http://www.processon.com/chart_image/597c40b1e4b06b35d2fa3f2e.png" target="_blank" rel="noopener"><img src="http://www.processon.com/chart_image/597c40b1e4b06b35d2fa3f2e.png" alt="img"></a></p>
<p>什么时候使用最后修改时间和标签验证？</p>
<p>如果服务器返回了ETag首部，客户端必须使用标签验证。如果服务器只返回了Last-Modified首部，客户端可以使用最后修改时间验证。</p>
<h3 id="新鲜度计算算法"><a href="#新鲜度计算算法" class="headerlink" title="新鲜度计算算法"></a>新鲜度计算算法</h3><p>为了分辨文档是否新鲜，需要计算两个值，文档的使用期(age)和文档的新鲜生存期(freshness lifetime)。如果文档使用期小于文档新鲜生存期，则文档是新鲜的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is_fresh_enough = True if age &lt; freshness_lifetime</span><br></pre></td></tr></table></figure>
<h4 id="使用期"><a href="#使用期" class="headerlink" title="使用期"></a>使用期</h4><p>使用期包含了网络传输时间和文档在缓存的停留时间。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apparent_time = time_got_response - date_header_value</span><br><span class="line">corrent_apparent_time = max(0, apparent_time)</span><br><span class="line">age_when_document_arrived_at_our_cache = corrent_apparent_time</span><br><span class="line"></span><br><span class="line">how_long_copy_has_been_in_our_cache = current_time - got_response_time</span><br><span class="line"></span><br><span class="line">age = age_when_document_arrived_at_our_cache + how_long_copy_has_been_in_our_cache</span><br></pre></td></tr></table></figure>
<p>基于Date首部计算apparent使用期</p>
<p>apparen时间：</p>
<p>apparent时间等于获得响应时间减去服务器发送文档时间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apparent_time = time_got_response - date_header_value</span><br></pre></td></tr></table></figure>
<p>为了防止由于服务器时间不同步导致apparent_time为负，进行时间修正：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apparent_time = max(0, apparent_time)</span><br><span class="line">age_when_document_arrived_at_our_cache = apparent_time</span><br></pre></td></tr></table></figure>
<p>对网络时延对补偿：</p>
<p><strong>如果文档在网络或服务器中阻塞了很长时间，相对使用期的计算可能会极大的低估文档使用期。缓存知道文档请求时间，以及文档到达时间。HTTP/1.1会在这些网络延迟上加上整个网络时延，一遍对其进行保守校正。这个从缓存到服务器到缓存高估了服务器到缓存延迟，它是保守的。如果出错，只会使文档看起来比实际使用期要老，并会引发不必要的验证。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response_delay_estimate = time_got_response - time_issued_request</span><br><span class="line">age_when_document_arrived_at_our_cache = apparent_time + response_delay_estimate</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:该时延补偿会导致最后计算文档使用期大于实际的文档使用期。apparent_time是包含网络时延的，对网络时延补偿是否必要？在服务器负载较高，对服务器的处理时间进行补偿倒是很有必要。</p>
</blockquote>
<p>缓存停留时间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">how_long_copy_has_been_in_our_cache = current_time - got_response_time</span><br></pre></td></tr></table></figure>
<p><a href="http://www.processon.com/chart_image/597c52a3e4b06e43d2d66a4e.png" target="_blank" rel="noopener"><img src="http://www.processon.com/chart_image/597c52a3e4b06e43d2d66a4e.png" alt="img"></a></p>
<h4 id="新鲜生存期"><a href="#新鲜生存期" class="headerlink" title="新鲜生存期"></a>新鲜生存期</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def calculate_server_freshness_limit(**kwargs):</span><br><span class="line">	heuristic = False</span><br><span class="line">	server_freshness_limit = default_cache_min_lifetime</span><br><span class="line">    if max_age_value_set:</span><br><span class="line">    	server_freshness_limit = max_age_value_set</span><br><span class="line">    elif expires_value_set:</span><br><span class="line">   		server_freshness_limit = expires_value_set - date_value</span><br><span class="line">    elif last_modified_value_set:</span><br><span class="line">    	time_since_last_modify = max(0, date_value - last_modified_value)</span><br><span class="line">        server_freshness_limit = int(time_since_last_modify*lm_factor)</span><br><span class="line">        heuristic = True</span><br><span class="line">    else:</span><br><span class="line">    	server_freshness_limit = default_cache_min_lifetime</span><br><span class="line">        heuristic = True</span><br><span class="line"></span><br><span class="line">	if heuristic:</span><br><span class="line">    	if server_freshness_limit &gt; default_cache_max_lifetime:</span><br><span class="line">        	server_freshness_limit = default_cache_max_lifetime</span><br><span class="line">        if server_freshness_limit &lt; default_cache_min_lifetime:</span><br><span class="line">        	server_freshness_limit = default_cache_min_lifetime</span><br><span class="line">            </span><br><span class="line">	return server_freshness_limit</span><br></pre></td></tr></table></figure>
<p>LM-factor算法计算新鲜周期</p>
<ul>
<li>如果已缓存文档最后一次修改发生在很久以前，它可能是一份稳定的文档，不会突然发生变化，因此将其汲取保存在缓存中比较安全</li>
<li>如果已缓存的文档最近被修改过，就说明它很可能会频繁发生变化，因此在与服务器再验证之前，只应该将其缓存很短一段时间</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">time_since_modify = max(0, date_value - server_last_modified)</span><br><span class="line">server_freshness_limit = time_since_modify * lm_factor</span><br></pre></td></tr></table></figure>
<p><a href="http://www.processon.com/chart_image/597c9f3be4b06e43d2d6757c.png" target="_blank" rel="noopener"><img src="http://www.processon.com/chart_image/597c9f3be4b06e43d2d6757c.png" alt="img"></a></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>缓存相关的HTTP头部：</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cache-Control</td>
<td>缓存控制</td>
</tr>
<tr>
<td>Expires</td>
<td>过期绝对时间</td>
</tr>
<tr>
<td>If-Modify-Since</td>
<td>从某个时间开始文档是否发生改变</td>
</tr>
<tr>
<td>If-None-Match</td>
<td>文档的标签是否发生改变</td>
</tr>
<tr>
<td>Last-Modified</td>
<td>最后修改时间</td>
</tr>
<tr>
<td>ETag</td>
<td>文档标签</td>
</tr>
</tbody>
</table>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Expires" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Expires</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Last-Modified" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Last-Modified</a></li>
<li><a href="https://tools.ietf.org/html/rfc7234" target="_blank" rel="noopener">rfc7234 Hypertext Transfer Protocol (HTTP/1.1): Caching</a></li>
<li><a href="http://blog.mengyangyang.org/2017/07/29/http-cache/HTTP%20Cache-Control%20Extensions%20for%20Stale%20Content" target="_blank" rel="noopener">rfc5861 HTTP Cache-Control Extensions for Stale Content</a></li>
<li><a href="https://www.mnot.net/cache_docs/" target="_blank" rel="noopener">Caching Tutorial</a></li>
<li><a href="https://redbot.org/" target="_blank" rel="noopener">redbot</a>, a tool to check your cache-related HTTP headers.</li>
<li><a href="https://www.ietf.org/rfc/rfc2616.txt" target="_blank" rel="noopener">Hypertext Transfer Protocol – HTTP/1.1</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/">HTTP</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-oatuh"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/07/19/oatuh/">OAuth</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/07/19/oatuh/" class="article-date">
	  <time datetime="2017-07-19T14:30:45.000Z" itemprop="datePublished">July 19, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>OAuth客户端使用一个访问令牌(access token)来访问受保护的资源，其中访问令牌包含了特殊作用域(specific scope), 生命周期，和其他的访问属性。访问令牌由授权服务器在资源拥有者授权之后颁发(issue)。客户端通过访问令牌资源服务器上受保护资源。</p>
<p>比如，一个终端用户(resource-owner)可以授权打印服务器(client)访问他的存储在图片分享服务(resource server)上的受保护的图片，但不用与打印服务器分享他的用户名和密码。他可以授权图片分享服务(authorization server)颁发一个特殊的证书(access token).</p>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><h2 id="Roles"><a href="#Roles" class="headerlink" title="Roles"></a>Roles</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource owner</td>
<td>一个能授权访问受保护资源的实体</td>
</tr>
<tr>
<td>resource server</td>
<td>托管受保护资源的服务器，能处理通过访问令牌访问受保护资源的请求</td>
</tr>
<tr>
<td>client</td>
<td>代表资源拥有者发起访问受保护资源的请求的应用程序</td>
</tr>
<tr>
<td>authorization server</td>
<td>在资源拥有者认证、授权之后，能够颁发访问令牌给客户端的服务器</td>
</tr>
</tbody>
</table>
<h2 id="Protocol-Flow"><a href="#Protocol-Flow" class="headerlink" title="Protocol Flow"></a>Protocol Flow</h2><p><img src="http://processon.com/chart_image/59633488e4b0c2773f86cf4c.png" alt></p>
<h2 id="Authorization-Grant"><a href="#Authorization-Grant" class="headerlink" title="Authorization Grant"></a>Authorization Grant</h2><p>授权grant是一个证书表示资源拥有者已经授权，客户端可以用授权grant获取访问令牌。该规范定义4种授权类型：</p>
<ul>
<li>authorization code</li>
<li>implicit</li>
<li>resource owner password credentials</li>
<li>client credentials</li>
</ul>
<h2 id="Access-Token"><a href="#Access-Token" class="headerlink" title="Access Token"></a>Access Token</h2><p>访问令牌是一种证书用来访问受保护的资源。一个访问令牌就是认证服务器颁发给客户端的字符串。令牌包含了特殊作用域，过期时间，授权的资源拥有者等信息。</p>
<h2 id="Refresh-Token"><a href="#Refresh-Token" class="headerlink" title="Refresh Token"></a>Refresh Token</h2><p>刷新令牌也是一个证书用来获取访问令牌。刷新令牌是认证服务器发放给客户端的，在当访问令牌不可用或过期时，用来获取新的访问令牌。</p>
<p>刷新令牌是资源资源拥有者授权给客户端认证码。与访问令牌不同，刷新令牌只能与认证服务器通信，不能从资源服务器获取资源。</p>
<p><a href="http://processon.com/chart_image/59660f76e4b09c8a2926274f.png" target="_blank" rel="noopener"><img src="http://processon.com/chart_image/59660f76e4b09c8a2926274f.png" alt="Refreshing an Expired Access Token"></a>Refreshing an Expired Access Token</p>
<h1 id="Client-Registration"><a href="#Client-Registration" class="headerlink" title="Client Registration"></a>Client Registration</h1><p>在使用OAuth协议之前，客户端需要在认证服务器注册应用。</p>
<p>客户端注册是让认证服务器能够识别、信任客户端，其中包括客户端类型，重定向URI等。</p>
<h2 id="Client-Types"><a href="#Client-Types" class="headerlink" title="Client Types"></a>Client Types</h2><p>OAuth定义了两种客户端类型</p>
<ul>
<li>confidential - 客户端能够管理证书的机密性</li>
<li>public - 客户端不能管理证书的机密性</li>
</ul>
<h2 id="Client-Identifier"><a href="#Client-Identifier" class="headerlink" title="Client Identifier"></a>Client Identifier</h2><p>认证服务器给已注册的客户端颁发一个客户端标识。对于认证服务器，客户端标识是唯一的。</p>
<h2 id="Client-Authentication"><a href="#Client-Authentication" class="headerlink" title="Client Authentication"></a>Client Authentication</h2><p>如果客户端类型是confidential, 客户端和认证服务器建立一个客户端认证方法。Confidential客户端会向认证服务器声明它支持证书，比如密码或公私钥对。</p>
<h1 id="Obtaining-Authorization"><a href="#Obtaining-Authorization" class="headerlink" title="Obtaining Authorization"></a>Obtaining Authorization</h1><p>在请求访问令牌之前，客户端先要获取资源拥有者的授权。OAuth定义了4种授权类型: authorization code, implicit, resource owner password credential, 和client credentials.</p>
<h2 id="Authorization-Code-Grant"><a href="#Authorization-Code-Grant" class="headerlink" title="Authorization Code Grant"></a>Authorization Code Grant</h2><p>授权码授权类型用来获取访问令牌和刷新令牌。</p>
<p>认证码获取流程:</p>
<p><img src="http://processon.com/chart_image/5966de55e4b09c8a29265aaf.png" alt></p>
<h3 id="Authorization-Request"><a href="#Authorization-Request" class="headerlink" title="Authorization Request"></a>Authorization Request</h3><p><code>Content-Type: application/x-www-form-urlencoded</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>response_type</td>
<td><strong>REQUIRED</strong>该值必须设置为”code”</td>
</tr>
<tr>
<td>client_id</td>
<td><strong>REQUIRED</strong>注册的应用的id</td>
</tr>
<tr>
<td>redirect_uri</td>
<td><strong>OPTIONAL</strong>重定向URI，成功获取授权码后重定向到oauth客户端的URI</td>
</tr>
<tr>
<td>scope</td>
<td><strong>OPTIONAL</strong>作用域</td>
</tr>
<tr>
<td>state</td>
<td><strong>RECOMMENDED</strong>客户端用来管理请求、回调状态的值。认证服务器的重定向到UA时，会包含这个值。<strong>这个参数应该用来防止扩展请求伪造</strong></td>
</tr>
</tbody>
</table>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/o/authorize/?response_type=code&amp;client_id=wt6Pvm2s3vbb8RPE7nlPlugwaMnj58UhFpk8bCPp&amp;redirect_uri=http%3A%2F%2Flocalhost%3A8000%2Foauth%2Fauthorized%2F</span> HTTP/1.0</span><br><span class="line"><span class="attribute">Host</span>: localhost:8000</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate, sdch, br</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.8</span><br></pre></td></tr></table></figure>
<p>认证服务器会验证这个请求，保证请求中的所有参数都是有效的。如果请求是有效的，认证服务器需要资源拥有者授权。如果资源拥有者授权成功，授权服务器根据<code>redirect_uri</code>返回给UA一个重定向响应。</p>
<h3 id="Authorization-Response"><a href="#Authorization-Response" class="headerlink" title="Authorization Response"></a>Authorization Response</h3><p><code>Content-Type: application/x-www-form-urlencoded</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td><strong>REQUIRED</strong>认证服务器生成的授权码，为了防止泄露的危险，授权码必须在很短的时间过期。授权码生存期推荐为10min.客户端只能使用一次授权码。授权码与客户端id,重定向URI绑定</td>
</tr>
<tr>
<td>state</td>
<td><strong>REQUIRED</strong>如果客户端请求中包含state,授权服务器必须要返回该值</td>
</tr>
</tbody>
</table>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.0 <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Date</span>: Tue, 18 Jul 2017 04:12:00 GMT</span><br><span class="line"><span class="attribute">Server</span>: WSGIServer/0.1 Python/2.7.9</span><br><span class="line"><span class="attribute">X-Frame-Options</span>: SAMEORIGIN</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: *</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=utf-8</span><br><span class="line"><span class="attribute">Location</span>: http://localhost:8000/oauth/authorized/?code=x1yxsYhAJ23pXNMXej4tB13dvMFTov</span><br><span class="line"><span class="attribute">Vary</span>: Cookie</span><br></pre></td></tr></table></figure>
<h4 id="Error-Response"><a href="#Error-Response" class="headerlink" title="Error Response"></a>Error Response</h4><p><code>Conent-Type: application/x-www-form-urlencoded</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>error</td>
<td><strong>REQUIRED</strong></td>
</tr>
<tr>
<td>error_description</td>
<td><strong>OPTIONAL</strong></td>
</tr>
<tr>
<td>error_uri</td>
<td><strong>OPTIONAL</strong></td>
</tr>
<tr>
<td>state</td>
<td><strong>REQUIRED</strong></td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Location: https://client.example.com/cb?error=access_denied&amp;state=xyz</span><br></pre></td></tr></table></figure>
<h3 id="Access-Token-Request"><a href="#Access-Token-Request" class="headerlink" title="Access Token Request"></a>Access Token Request</h3><p><code>Conent-Type: application/x-www-form-urlencoded</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>grant_type</td>
<td><strong>REQUIRED</strong>该值必须设置“authorization_code”</td>
</tr>
<tr>
<td>code</td>
<td><strong>REQUIRED</strong>授权服务器返回的code</td>
</tr>
<tr>
<td>redirect_uri</td>
<td><strong>REQUIRED</strong>重定向URI</td>
</tr>
<tr>
<td>client_id</td>
<td><strong>REQUIRED</strong>注册应用的ID</td>
</tr>
</tbody>
</table>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/o/token/</span> HTTP/1.0</span><br><span class="line"><span class="attribute">Host</span>: localhost:8000</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Length</span>: 183</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span>: */*</span><br><span class="line"><span class="attribute">User-Agent</span>: python-requests/2.18.1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">grant_type=authorization_code&amp;code=x1yxsYhAJ23pXNMXej4tB13dvMFTov&amp;redirect_uri=http%3A%2F%2Flocalhost%3A8000%2Foauth%2Fauthorized%2F&amp;client_id=wt6Pvm2s3vbb8RPE7nlPlugwaMnj58UhFpk8bCPp</span><br></pre></td></tr></table></figure>
<p>认证服务器必须要验证客户端的请求</p>
<ul>
<li>对于confidential客户端，需要客户端认证</li>
<li>如果客户端包含认证信息，认证客户端</li>
<li>验证授权码是否有效</li>
<li>验证redirect_uri是否证券</li>
</ul>
<h3 id="Access-Token-Response"><a href="#Access-Token-Response" class="headerlink" title="Access Token Response"></a>Access Token Response</h3><p>如果获取访问令牌的请求是有效的而且认证通过，认证服务器需要发放访问令牌和可选的刷新令牌。如果请求是无效的或认证失败，需要返回一个错误响应。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Date: Tue, 18 Jul 2017 04:12:00 GMT</span><br><span class="line">Server: WSGIServer/0.1 Python/2.7.9</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-store</span><br><span class="line"></span><br><span class="line">&#123;&quot;access_token&quot;: &quot;4C1gRp2TfYKN0tO45fqa6BkFZxTJNU&quot;, &quot;token_type&quot;: &quot;Bearer&quot;, &quot;expires_in&quot;: 36000, &quot;refresh_token&quot;: &quot;oZX6XtV2OGSVRnvyOoa7qerWddOPKw&quot;, &quot;scope&quot;: &quot;read write&quot;&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Refreshing-an-Access-Token"><a href="#Refreshing-an-Access-Token" class="headerlink" title="Refreshing an Access Token"></a>Refreshing an Access Token</h1><p>如果认证服务器向客户端颁发了刷新令牌，客户端可以使用刷新令牌更新访问令牌。</p>
<p><code>Content-Type: application/x-www-form-urlencoded</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>grant_type</td>
<td><strong>REQUIRED</strong>该值必须设置为”refresh_token”</td>
</tr>
<tr>
<td>refresh_token</td>
<td><strong>REQUIRED</strong>认证服务器颁发的刷新令牌</td>
</tr>
<tr>
<td>scope</td>
<td><strong>OPTIONAL</strong></td>
</tr>
</tbody>
</table>
<p>刷新令牌是长期存在证书用来更新访问令牌，刷新令牌必须要与客户端id绑定。此外，客户端必须向认证服务器提供认证信息。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/o/token/</span> HTTP/1.0</span><br><span class="line"><span class="attribute">Host</span>: localhost:8000</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Length</span>: 69</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span>: */*</span><br><span class="line"><span class="attribute">User-Agent</span>: python-requests/2.18.1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Authorization</span>: Basic d3Q2UHZtMnMzdmJiOFJQRTdubFBsdWd3YU1uajU4VWhGcGs4YkNQcDpWcUF3NDlwb3VXc0lUVU1OcWFrdzczQ0NSRVZzclMyRWd5SG9WeVJnekpWNWRlWnNKQUNBeVdkeEFJMXZRc2RaZk1JQmlCRlRFeUR5YUkyeTJJcU1vR3JEbkFNWE5ITWd4TFRJUDIxRXhIR0tkUmNTVlJ5RjRxOHA5STR5OWhqVQ==</span><br><span class="line"></span><br><span class="line">grant_type=refresh_token&amp;refresh_token=oZX6XtV2OGSVRnvyOoa7qerWddOPKw</span><br></pre></td></tr></table></figure>
<p>Response:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.0 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Tue, 18 Jul 2017 06:47:50 GMT</span><br><span class="line"><span class="attribute">Server</span>: WSGIServer/0.1 Python/2.7.9</span><br><span class="line"><span class="attribute">X-Frame-Options</span>: SAMEORIGIN</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Pragma</span>: no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span>: no-store</span><br><span class="line"></span><br><span class="line">&#123;"access_token": "gebkQX71vIwmksTsvleRKMzpdysLHY", "token_type": "Bearer", "expires_in": 36000, "refresh_token": "CbpaNXAqyexTQOuCvQf1RUoEN2EZeX", "scope": "read write"&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Accessing-Protected-Resources"><a href="#Accessing-Protected-Resources" class="headerlink" title="Accessing Protected Resources"></a>Accessing Protected Resources</h1><p>客户端可以同访问访问资源服务器受保护的资源。资源服务器必须要验证访问令牌，保证访问令牌没有过期，并且其作用域能覆盖此资源。</p>
<h2 id="Access-Token-Types"><a href="#Access-Token-Types" class="headerlink" title="Access Token Types"></a>Access Token Types</h2><p>“bearer”令牌类型，参考<a href="https://tools.ietf.org/html/rfc6750" target="_blank" rel="noopener">RFC6750</a></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/resource/1</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: example.com</span><br><span class="line"><span class="attribute">Authorization</span>: Bearer mF_9.B5f-4.1JqM</span><br></pre></td></tr></table></figure>
<p>“mac”令牌类型</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/resource/1</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: example.com</span><br><span class="line"><span class="attribute">Authorization</span>: MAC id="h480djs93hd8",</span><br><span class="line">               nonce="274312:dj83hs9s",</span><br><span class="line">               mac="kDZvddkndxvhGRXZhvuDjEWhGeE="</span><br></pre></td></tr></table></figure>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://oauth.net/2/" target="_blank" rel="noopener">https://oauth.net/2/</a></li>
<li><a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc6749</a></li>
<li><a href="https://github.com/evonove/django-oauth-toolkit" target="_blank" rel="noopener">https://github.com/evonove/django-oauth-toolkit</a></li>
<li><a href="https://oauth.net/articles/authentication/" target="_blank" rel="noopener">https://oauth.net/articles/authentication/</a></li>
<li><a href="https://www.oauth.com/" target="_blank" rel="noopener">https://www.oauth.com</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OAuth/">OAuth</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-metaclass"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/07/18/python-metaclass/">Python元类</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/07/18/python-metaclass/" class="article-date">
	  <time datetime="2017-07-18T14:29:23.000Z" itemprop="datePublished">July 18, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>[Metaclasses] are deeper magic than 99% of users should ever worry about. If you wonder whether you need them, you don’t (the people who actually need them know with certainty that they need them, and don’t need an explanation about why).</em> The Python core developer Time Peters said.</p>
<p>元类是创建类的类。新风格(new-style)类是type类的实例。元类是type类的派生类，通过重载type类的<code>__new__</code>和<code>__init__</code>方法，重新定义类创建协议，来实现类创建的定制化。</p>
<h2 id="元类模型"><a href="#元类模型" class="headerlink" title="元类模型"></a>元类模型</h2><p>(对象)实例是通过类创建，类是通过type类创建，元类是type类的派生类。</p>
<ul>
<li>类型(自定义)是通过type类或type派生元类创建</li>
<li>元类是type类的派生类</li>
<li>用户自定义类是type类的实例</li>
<li>用户自定义类可以生成自己的实例</li>
</ul>
<h3 id="类声明协议"><a href="#类声明协议" class="headerlink" title="类声明协议"></a>类声明协议</h3><p>Python解释器在类声明语句结束时，调用type类型创建，<code>class = type(classname, superclasses, attributedict)</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type.__new__(meta, classname, superclasses, attributedict)</span><br><span class="line">type.__init__(cls, classname, superclasses, attributedict)</span><br></pre></td></tr></table></figure>
<h2 id="声明元类"><a href="#声明元类" class="headerlink" title="声明元类"></a>声明元类</h2><p>Py3与Py2声明元类的方式不一样：</p>
<p>Py3声明元类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Metaclass</span><span class="params">(type)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(meta, classname, superclasses, attributedict)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> type(classname, superclasses, attributedict)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(cls, classname, superclasses, attributedict)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Dummy</span><span class="params">(object, metaclass=Metaclass)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Py2声明元类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Metaclass</span><span class="params">(type)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(meta, classname, superclasses, attributedict)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> type(classname, superclasses, attributedict)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(cls, classname, superclasses, attributedict)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Dummy</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">... </span>    __metaclass__ = Metaclass</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="继承和实例"><a href="#继承和实例" class="headerlink" title="继承和实例"></a>继承和实例</h2><ul>
<li>元类继承于type类</li>
<li>元类的声明可以被派生类继承</li>
<li>元类的属性不能被类的实例继承</li>
<li>元类的属性可以被类获取</li>
</ul>
<p><strong>元类继承于type类</strong></p>
<p>元类重载type类的<code>__new__</code>和<code>__init__</code>方法，定制类的创建和初始化。</p>
<p><strong>元类的声明可以被派生类继承</strong></p>
<p><strong>元类的属性不能被类实例继承</strong></p>
<p>类是元类的实例，元类的行为可以被类访问，当类不能被类的实例访问。</p>
<p><strong>元类的属性可以被类获取</strong></p>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p><strong>Python继承算法</strong></p>
<ol>
<li>对于一个实例，先搜索这个实例，再搜索实例的类，再搜索超类<br>a. 先搜索实例的<code>__dict__</code><br>b. 再搜索该实例的类的<code>__mro__</code>对应类的<code>__dict__</code></li>
<li>对于一个类，先搜索类，再搜索超类，再搜索元类<br>a. 根据<code>__mro__</code>搜索类的<code>__dict__</code><br>b. 再搜索元类的<code>__dict__</code></li>
<li>规则1和2中，再b阶段中，数据描述的优先级高</li>
<li>规则1和2中，对于内置的运算符，跳过a阶段</li>
</ol>
<p><strong>数据描述符继承算法</strong></p>
<p>对于定义了<code>__set__</code>拦截赋值的描述符就是数据描述符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, ins, _type)</span>:</span></span><br><span class="line"><span class="meta">... </span>            print(<span class="string">'call D.__get__'</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, ins, value)</span>:</span></span><br><span class="line"><span class="meta">... </span>            print(<span class="string">'call D.__set__'</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Dummy</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">... </span>    d = D()</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins = Dummy()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins.d</span><br><span class="line">call D.__get__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins.d = <span class="string">'spam'</span></span><br><span class="line">call D.__set__</span><br></pre></td></tr></table></figure>
<p>未定义<code>__set__</code>的描述符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, ins, value)</span>:</span></span><br><span class="line"><span class="meta">... </span>            print(<span class="string">'call D.__get__'</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Dummy</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">... </span>    d = D()</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins = Dummy()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins.d</span><br><span class="line">call D.__get__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins.d = <span class="string">'spam'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins.d</span><br><span class="line"><span class="string">'spam</span></span><br></pre></td></tr></table></figure>
<p>Python 的继承算法</p>
<ol>
<li>对于实例I，先搜索实例，再搜索类，再搜索超类<br>a. 根据类的<code>__mro__</code>搜索超类的<code>__dict__</code><br>b. If 如果在a阶段发现了数据描述，调用该数据描述，完成后退出<br>c. Else 返回该实例<code>__dict__</code>中的值<br>d. Else 调用非数据描述符，并放回结果</li>
<li>对于类C，搜索类，再搜索超类，再搜索元类<br>a. 搜索类的<code>__mro__</code>依次搜索类的<code>__dict__</code><br>b. If 如果在a阶段发现了数据描述符，调用该数据描述符，完成后退出<br>c. Else 返回该类<code>__dict__</code>中值g<br>d. Else 调用非数据描述符，返回结果</li>
</ol>
<blockquote>
<p>Note, 数据描述符的优先级 &gt; 普通属性 &gt; 非数据描述符</p>
</blockquote>
<h2 id="元类与类装饰器"><a href="#元类与类装饰器" class="headerlink" title="元类与类装饰器"></a>元类与类装饰器</h2><p>TODO</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>django ORM</p>
<p>ripozo API</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><em>Learning Python 5th Edition</em></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-descriptor"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/07/10/python-descriptor/">Python描述符</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/07/10/python-descriptor/" class="article-date">
	  <time datetime="2017-07-10T14:28:07.000Z" itemprop="datePublished">July 10, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>如果一个对象定义了以下任意方法，这个对象就是一个描述符。给描述符下个定义，描述符就是绑定了行为属性的对象。</p>
<p><code>object.__get__(self, instance, owner)</code></p>
<p><code>object.__set__(self, instance, value)</code></p>
<p><code>object.__delete__(self, instance)</code></p>
<p>属性访问的默认行为就是从一个对象字典中获取、设置和删除属性。比如，<code>a.x</code>首先会搜索<code>a.__dict__[&#39;x&#39;]</code>，其次<code>type(a).__dict__[&#39;x&#39;]</code>，最后所有<code>type(a)</code>的元类。<strong>如果要查找的值一个包含描述器方法的对象，Python会用调用描述器方法代替默认行为。</strong></p>
<blockquote>
<p>Note:只有new-style class会调用描述符的对象的方法。</p>
</blockquote>
<p>描述符是一个强大的通用协议。Python内建的property, staticmethod, classmethod, super背后的实现机制都是描述符协议。</p>
<h2 id="Descriptor-Protocol"><a href="#Descriptor-Protocol" class="headerlink" title="Descriptor Protocol"></a>Descriptor Protocol</h2><p><code>object.__get__(self, ins, _type=None)</code></p>
<p><code>object.__set__(self, ins, value)</code></p>
<p><code>object.__del__(self, ins)</code></p>
<p>如果一个对象包含上面任意一个方法，就可以被看作是一个描述符。如果一个对象定义了<code>__get__</code>和<code>__set__</code>两个方法，该对象可以被看作一个数据描述符，如果一个对象只定义了<code>__get__</code>，该对象就是non-data描述符。</p>
<p><strong>数据描述符与非数据描述符的区别在于，描述符与对象实例entry调用优先级。如果一个实例的字典有一个entry和数据描述符的名字相同，数据描述符的调用的优先级高。如果一个实例有一个entry和非数据描述符的名字相同个，实例entry的调用的优先级高。</strong></p>
<h2 id="Invoking-Descriptors"><a href="#Invoking-Descriptors" class="headerlink" title="Invoking Descriptors"></a>Invoking Descriptors</h2><p><code>obj.d</code>查找obj的字典是否包含d，如果d定义了<code>__get__</code>方法，<code>d.__get__(obj, type(obj))</code>就会被调用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">    <span class="string">"Emulate type_getattro() in Objects/typeobject.c"</span></span><br><span class="line">    v = object.__getattribute__(self, key)</span><br><span class="line">    <span class="keyword">if</span> hasattr(v, <span class="string">'__get__'</span>):</span><br><span class="line">        <span class="keyword">return</span> v.__get__(<span class="keyword">None</span>, self)</span><br><span class="line">    <span class="keyword">return</span> v</span><br></pre></td></tr></table></figure>
<p>super()返回的对象有一个定制化的<code>__getattribute__</code>方法，用于调用描述符。<code>super(B, self).m</code>先会搜索<code>obj.__class__.__mro__</code>查找基类A，如果是一个数据描述符，则会调用<code>A.__dict__[&#39;m&#39;].__get__(obj, B)</code>，如果是一个非数据描述符，返回结果不会改变。</p>
<h2 id="Built-in-Descriptors"><a href="#Built-in-Descriptors" class="headerlink" title="Built-in Descriptors"></a>Built-in Descriptors</h2><h3 id="Property"><a href="#Property" class="headerlink" title="Property"></a>Property</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getx</span><span class="params">(self)</span>:</span> <span class="keyword">return</span> self.__x</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setx</span><span class="params">(self, value)</span>:</span> self.__x = value</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delx</span><span class="params">(self)</span>:</span> <span class="keyword">del</span> self.__x</span><br><span class="line">    x = property(getx, setx, delx, <span class="string">"I'm the 'x' property."</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Property</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"Emulate PyProperty_Type() in Objects/descrobject.c"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, fget=None, fset=None, fdel=None, doc=None)</span>:</span></span><br><span class="line">        self.fget = fget</span><br><span class="line">        self.fset = fset</span><br><span class="line">        self.fdel = fdel</span><br><span class="line">        <span class="keyword">if</span> doc <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">and</span> fget <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            doc = fget.__doc__</span><br><span class="line">        self.__doc__ = doc</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, obj, objtype=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> obj <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">if</span> self.fget <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">"unreadable attribute"</span>)</span><br><span class="line">        <span class="keyword">return</span> self.fget(obj)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, obj, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.fset <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">"can't set attribute"</span>)</span><br><span class="line">        self.fset(obj, value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.fdel <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">"can't delete attribute"</span>)</span><br><span class="line">        self.fdel(obj)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getter</span><span class="params">(self, fget)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> type(self)(fget, self.fset, self.fdel, self.__doc__)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setter</span><span class="params">(self, fset)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> type(self)(self.fget, fset, self.fdel, self.__doc__)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deleter</span><span class="params">(self, fdel)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> type(self)(self.fget, self.fset, fdel, self.__doc__)</span><br></pre></td></tr></table></figure>
<h3 id="Staticmethod"><a href="#Staticmethod" class="headerlink" title="Staticmethod"></a>Staticmethod</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaticMethod</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"Emulate PyStaticMethod_Type() in Objects/funcobject.c"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, f)</span>:</span></span><br><span class="line">        self.f = f</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, obj, objtype=None)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.f</span><br></pre></td></tr></table></figure>
<h3 id="Classmethod"><a href="#Classmethod" class="headerlink" title="Classmethod"></a>Classmethod</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassMethod</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"Emulate PyClassMethod_Type() in Objects/funcobject.c"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, f)</span>:</span></span><br><span class="line">        self.f = f</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, obj, klass=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> klass <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            klass = type(obj)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">newfunc</span><span class="params">(*args)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self.f(klass, *args)</span><br><span class="line">        <span class="keyword">return</span> newfunc</span><br></pre></td></tr></table></figure>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://docs.python.org/2/reference/datamodel.html#descriptors" target="_blank" rel="noopener">https://docs.python.org/2/reference/datamodel.html#descriptors</a></li>
<li><a href="https://docs.python.org/2/howto/descriptor.html" target="_blank" rel="noopener">https://docs.python.org/2/howto/descriptor.html</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-context"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/07/09/python-context/">Python上下文管理器</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/07/09/python-context/" class="article-date">
	  <time datetime="2017-07-09T14:26:25.000Z" itemprop="datePublished">July 9, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>上下管理器是一个对象，定义了执行<code>with</code>语句时需要创建的上下文。context manager的<code>__enter__()</code>和<code>__exit__()</code>方法分别在进入、退出<code>with</code>语句时被调用。</p>
<p><code>object.__enter__(self)</code></p>
<p><code>object.__exit__(self, exc_type, exc_value, traceback)</code></p>
<h2 id="with-statement"><a href="#with-statement" class="headerlink" title="with statement"></a>with statement</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with_stmt ::=  <span class="string">"with"</span> with_item (<span class="string">","</span> with_item)* <span class="string">":"</span> suite</span><br><span class="line">with_item ::=  expression [<span class="string">"as"</span> target]</span><br></pre></td></tr></table></figure>
<p><strong>with</strong>语句执行数据流：</p>
<ol>
<li>评估上下文表达式是否包含上下文管理器</li>
<li>加载上下文管理器的<code>__exit__</code>方法</li>
<li>调用上下文管理的<code>__enter__</code>方法</li>
<li>如果target包含在with语句中，将<code>__enter__</code>方法的返回值赋给target</li>
<li>执行suite</li>
<li>调用<code>__exit__()</code>方法</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mgr = (EXPR)</span><br><span class="line">exit = type(mgr).__exit__  <span class="comment"># Not calling it yet</span></span><br><span class="line">value = type(mgr).__enter__(mgr)</span><br><span class="line">exc = <span class="keyword">True</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    VAR = value  <span class="comment"># Only if "as VAR" is present</span></span><br><span class="line">    BLOCK</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># The exceptional case is handled here</span></span><br><span class="line">    exc = <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exit(mgr, *sys.exc_info()):</span><br><span class="line">    		<span class="keyword">raise</span></span><br><span class="line">    <span class="comment"># The exception is swallowed if exit() returns true</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment"># The normal and non-local-goto cases are handled here</span></span><br><span class="line">    <span class="keyword">if</span> exc:</span><br><span class="line">        exit(mgr, <span class="keyword">None</span>, <span class="keyword">None</span>, <span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<h2 id="contextlib"><a href="#contextlib" class="headerlink" title="contextlib"></a>contextlib</h2><p>contextlib提供了快速定义支持上下文管理器的函数对象。</p>
<p>定义一个生成器函数，contextmanager装饰后就变成一个支持上下文管理器的函数对象。yield之前语句子在代码块之前被执行，yield之后语句在代码执行完之后被执行。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@contextmanager</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">tag</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'&lt;%s&gt;'</span> % name)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'&lt;/%s&gt;'</span> % name)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> tag(<span class="string">'h1'</span>):</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'hotbaby'</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">&lt;h1&gt;</span><br><span class="line">hotbaby</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure>
<h2 id="context-decorator"><a href="#context-decorator" class="headerlink" title="context decorator"></a>context decorator</h2><p>contextmanager是一个函数装饰器，装饰只包含一个yield语句的生成器函数，返回一个支持上下文管理器的函数对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">contextmanager</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(*args, **kwds)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> GeneratorContextManager(func(*args, **kwds))</span><br><span class="line">    <span class="keyword">return</span> helper</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note: 被装饰的生成器函数变成生成器作为参数传递到<strong>GeneratorContextManager</strong>对象中。</p>
</blockquote>
<p>生成器上下文管理器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GeneratorContextManager</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""Helper for @contextmanager decorator."""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, gen)</span>:</span></span><br><span class="line">        self.gen = gen</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.gen.next()</span><br><span class="line">        <span class="keyword">except</span> StopIteration:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">"generator didn't yield"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, type, value, traceback)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> type <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.gen.next()</span><br><span class="line">            <span class="keyword">except</span> StopIteration:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">"generator didn't stop"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> value <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">                <span class="comment"># Need to force instantiation so we can reliably</span></span><br><span class="line">                <span class="comment"># tell if we get the same exception back</span></span><br><span class="line">                value = type()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.gen.throw(type, value, traceback)</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">"generator didn't stop after throw()"</span>)</span><br><span class="line">            <span class="keyword">except</span> StopIteration, exc:</span><br><span class="line">                <span class="comment"># Suppress the exception *unless* it's the same exception that</span></span><br><span class="line">                <span class="comment"># was passed to throw().  This prevents a StopIteration</span></span><br><span class="line">                <span class="comment"># raised inside the "with" statement from being suppressed</span></span><br><span class="line">                <span class="keyword">return</span> exc <span class="keyword">is</span> <span class="keyword">not</span> value</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="comment"># only re-raise if it's *not* the exception that was</span></span><br><span class="line">                <span class="comment"># passed to throw(), because __exit__() must not raise</span></span><br><span class="line">                <span class="comment"># an exception unless __exit__() itself failed.  But throw()</span></span><br><span class="line">                <span class="comment"># has to raise the exception to signal propagation, so this</span></span><br><span class="line">                <span class="comment"># fixes the impedance mismatch between the throw() protocol</span></span><br><span class="line">                <span class="comment"># and the __exit__() protocol.</span></span><br><span class="line">                <span class="comment">#</span></span><br><span class="line">                <span class="keyword">if</span> sys.exc_info()[<span class="number">1</span>] <span class="keyword">is</span> <span class="keyword">not</span> value:</span><br><span class="line">                    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><ul>
<li><a href="http://hotbaby.org/python/2/reference/datamodel.html#with-statement-context-managers" target="_blank" rel="noopener">http://hotbaby.org/python/2/reference/datamodel.html#with-statement-context-managers</a></li>
<li><a href="http://hotbaby.org/python/2/reference/compound_stmts.html#the-with-statement" target="_blank" rel="noopener">http://hotbaby.org/python/2/reference/compound_stmts.html#the-with-statement</a></li>
<li><a href="http://hotbaby.org/python/2/library/contextlib.html" target="_blank" rel="noopener">http://hotbaby.org/python/2/library/contextlib.html</a></li>
<li><a href="https://hg.python.org/cpython/file/2.7/Lib/contextlib.py" target="_blank" rel="noopener">https://hg.python.org/cpython/file/2.7/Lib/contextlib.py</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0343/" target="_blank" rel="noopener">https://www.python.org/dev/peps/pep-0343/</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-itertools"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/07/01/python-itertools/">Python Itertools</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/07/01/python-itertools/" class="article-date">
	  <time datetime="2017-07-01T13:57:10.000Z" itemprop="datePublished">July 1, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="itertools-imap"><a href="#itertools-imap" class="headerlink" title="itertools.imap()"></a>itertools.imap()</h4><p><code>imap(func, *iterables)</code> 和iter和map混合体。</p>
<p>工作原理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">myimap</span><span class="params">(func, *iterables)</span>:</span></span><br><span class="line">	iterables = map(iter,iterables)</span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">		args = [next(it) <span class="keyword">for</span> it <span class="keyword">in</span> iterables]</span><br><span class="line">		<span class="keyword">yield</span> func(*args)</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[item <span class="keyword">for</span> item <span class="keyword">in</span> myimap(pow, (<span class="number">2</span>,<span class="number">2</span>), (<span class="number">3</span>,<span class="number">3</span>))]</span><br><span class="line">[<span class="number">8</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<h4 id="itertools-chain"><a href="#itertools-chain" class="headerlink" title="itertools.chain()"></a>itertools.chain()</h4><p><code>chain(*iterables)</code> 返回一个迭代器，该迭代器依次返回可迭代对象中没一个元素。</p>
<p>工作原理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">mychain</span><span class="params">(*iterables)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> iter_ <span class="keyword">in</span> iterables:</span><br><span class="line">		<span class="keyword">for</span> item <span class="keyword">in</span> iter_:</span><br><span class="line">			<span class="keyword">yield</span> item</span><br><span class="line">			</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[item <span class="keyword">for</span> item <span class="keyword">in</span> mychain(<span class="string">'abc'</span>, <span class="string">'def'</span>)]</span><br><span class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>]</span><br></pre></td></tr></table></figure>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://docs.python.org/2/library/functions.html" target="_blank" rel="noopener">https://docs.python.org/2/library/functions.html</a></li>
<li><a href="https://docs.python.org/2/library/functools.html" target="_blank" rel="noopener">https://docs.python.org/2/library/functools.html</a></li>
<li><a href="https://docs.python.org/2/library/itertools.html" target="_blank" rel="noopener">https://docs.python.org/2/library/itertools.html</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/5/">Next</a>
  </nav>


</section>
          <aside id="sidebar">
  
    <div style="margin: 20px 0;">
	<div id="search-form-wrap">

    <form class="search-form">
        <label style="width: 72%;">
            <span class="screen-reader-text">Search for:</span>
            <input type="search" class="search-field" style="height: 36px; width: 100%;" placeholder=" Search…" value="" name="s" title="Search for:">
        </label>
        <input type="submit" class="search-form-submit" value="Search">
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
</div>
  
    
  <div class="widget_athemes_tabs">
    <ul id="widget-tab" class="clearfix widget-tab-nav">
      <li class="active"><a>Recent Posts</a></li>
    </ul>
    <div class="widget">
      <ul>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2020/01/30/关于学习的一点想法/" title=""><img width="50" height="50" src="http://edu_img.bs2.100.com/33ea56264756f3b759844ce.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2020/01/30/关于学习的一点想法/">关于学习的一点想法</a></h6>
              <span>January 30, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2020/01/30/隆美尔战时文件/" title=""><img width="50" height="50" src="https://dingyue.ws.126.net/Ulf=Y0IDcGJb2RiNF7OAsK7VV8EkzWGWs40GSDnbGQ1Bs1449640368296compressflag.png" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2020/01/30/隆美尔战时文件/">隆美尔战时文件</a></h6>
              <span>January 30, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2019/12/14/远去的胜利/" title=""><img width="50" height="50" src="https://gss2.bdstatic.com/9fo3dSag_xI4khGkpoWK1HF6hhy/baike/q%3D90/sign=a111d0cedc62853594e0de2190ef2378/aa18972bd40735fadc8ce48597510fb30f240889.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2019/12/14/远去的胜利/">远去的胜利</a></h6>
              <span>December 14, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2019/11/30/闪击英雄/" title=""><img width="50" height="50" src="https://p1.ssl.qhimg.com/t0133bafd03c884b075.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2019/11/30/闪击英雄/">闪击英雄</a></h6>
              <span>November 30, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2019/11/06/华为研发/" title=""><img width="50" height="50" src="https://www.zaobao.com.sg/sites/default/files/styles/article_large_full/public/images/201901/20190125/20190125_opinion_renzhengfei.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2019/11/06/华为研发/">华为研发</a></h6>
              <span>November 6, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2019/10/05/美国陷阱/" title=""><img width="50" height="50" src="https://imgstatic.ctfile.com/upload/portal/19926596/HYj0oewG/20190530-1559217560551910.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2019/10/05/美国陷阱/">美国陷阱</a></h6>
              <span>October 5, 2019</span>
            </div>

          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>

    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">9</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/12306/" style="font-size: 10px;">12306</a> <a href="/tags/Debian/" style="font-size: 10px;">Debian</a> <a href="/tags/Decorator/" style="font-size: 10px;">Decorator</a> <a href="/tags/Django/" style="font-size: 16px;">Django</a> <a href="/tags/Flask/" style="font-size: 10px;">Flask</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Gitlab/" style="font-size: 10px;">Gitlab</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hacker/" style="font-size: 10px;">Hacker</a> <a href="/tags/Jekins/" style="font-size: 10px;">Jekins</a> <a href="/tags/Lisp/" style="font-size: 10px;">Lisp</a> <a href="/tags/MacOS/" style="font-size: 10px;">MacOS</a> <a href="/tags/McFarland/" style="font-size: 10px;">McFarland</a> <a href="/tags/Nginx/" style="font-size: 12px;">Nginx</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/OAuth/" style="font-size: 10px;">OAuth</a> <a href="/tags/PEP/" style="font-size: 10px;">PEP</a> <a href="/tags/PyPI/" style="font-size: 10px;">PyPI</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/RSS/" style="font-size: 10px;">RSS</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/WSGI/" style="font-size: 10px;">WSGI</a> <a href="/tags/万历十五年/" style="font-size: 10px;">万历十五年</a> <a href="/tags/三体/" style="font-size: 12px;">三体</a> <a href="/tags/三体2/" style="font-size: 10px;">三体2</a> <a href="/tags/二战/" style="font-size: 12px;">二战</a> <a href="/tags/人工智能/" style="font-size: 10px;">人工智能</a> <a href="/tags/任泽平/" style="font-size: 10px;">任泽平</a> <a href="/tags/八达岭长城/" style="font-size: 10px;">八达岭长城</a> <a href="/tags/凯恩斯主义/" style="font-size: 10px;">凯恩斯主义</a> <a href="/tags/刘慈欣/" style="font-size: 14px;">刘慈欣</a> <a href="/tags/区块链/" style="font-size: 10px;">区块链</a> <a href="/tags/华为/" style="font-size: 10px;">华为</a> <a href="/tags/原则/" style="font-size: 10px;">原则</a> <a href="/tags/古德里安/" style="font-size: 10px;">古德里安</a> <a href="/tags/奈飞/" style="font-size: 10px;">奈飞</a> <a href="/tags/学习/" style="font-size: 10px;">学习</a> <a href="/tags/微软/" style="font-size: 10px;">微软</a> <a href="/tags/战争/" style="font-size: 12px;">战争</a> <a href="/tags/房地产/" style="font-size: 10px;">房地产</a> <a href="/tags/抢票/" style="font-size: 10px;">抢票</a> <a href="/tags/文化/" style="font-size: 10px;">文化</a> <a href="/tags/旅行/" style="font-size: 12px;">旅行</a> <a href="/tags/朱镕基/" style="font-size: 10px;">朱镕基</a> <a href="/tags/机器学习/" style="font-size: 10px;">机器学习</a> <a href="/tags/村上春树/" style="font-size: 10px;">村上春树</a> <a href="/tags/查理·芒格/" style="font-size: 10px;">查理·芒格</a> <a href="/tags/桥水/" style="font-size: 10px;">桥水</a> <a href="/tags/比特币/" style="font-size: 10px;">比特币</a> <a href="/tags/深度学习/" style="font-size: 10px;">深度学习</a> <a href="/tags/电影/" style="font-size: 10px;">电影</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/索罗斯/" style="font-size: 10px;">索罗斯</a> <a href="/tags/经济学/" style="font-size: 10px;">经济学</a> <a href="/tags/缓存/" style="font-size: 10px;">缓存</a> <a href="/tags/腾讯/" style="font-size: 12px;">腾讯</a> <a href="/tags/萨提亚·纳德拉/" style="font-size: 10px;">萨提亚·纳德拉</a> <a href="/tags/读书/" style="font-size: 18px;">读书</a> <a href="/tags/跑步/" style="font-size: 12px;">跑步</a> <a href="/tags/邓小平/" style="font-size: 10px;">邓小平</a> <a href="/tags/金融/" style="font-size: 10px;">金融</a> <a href="/tags/隆美尔，战争/" style="font-size: 10px;">隆美尔，战争</a> <a href="/tags/马化腾/" style="font-size: 10px;">马化腾</a> <a href="/tags/黄仁宇/" style="font-size: 10px;">黄仁宇</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/12306/">12306</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian/">Debian</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Decorator/">Decorator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask/">Flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitlab/">Gitlab</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hacker/">Hacker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jekins/">Jekins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lisp/">Lisp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MacOS/">MacOS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/McFarland/">McFarland</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/">Node.js</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth/">OAuth</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PEP/">PEP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PyPI/">PyPI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RSS/">RSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WSGI/">WSGI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/万历十五年/">万历十五年</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/三体/">三体</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/三体2/">三体2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/二战/">二战</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/人工智能/">人工智能</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/任泽平/">任泽平</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/八达岭长城/">八达岭长城</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/凯恩斯主义/">凯恩斯主义</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/刘慈欣/">刘慈欣</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/区块链/">区块链</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/华为/">华为</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/原则/">原则</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/古德里安/">古德里安</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/奈飞/">奈飞</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习/">学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微软/">微软</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/战争/">战争</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/房地产/">房地产</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/抢票/">抢票</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文化/">文化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/旅行/">旅行</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/朱镕基/">朱镕基</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/村上春树/">村上春树</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/查理·芒格/">查理·芒格</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/桥水/">桥水</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/比特币/">比特币</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深度学习/">深度学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电影/">电影</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/索罗斯/">索罗斯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/经济学/">经济学</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/缓存/">缓存</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/腾讯/">腾讯</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/萨提亚·纳德拉/">萨提亚·纳德拉</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书/">读书</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/跑步/">跑步</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/邓小平/">邓小平</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/金融/">金融</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/隆美尔，战争/">隆美尔，战争</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/马化腾/">马化腾</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/黄仁宇/">黄仁宇</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2020 Mengyy&#39;s Blog All Rights Reserved.
        
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次  
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
          
      </div>
      <div class="site-credit">
        <!--
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
        -->
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
    
</script>

    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>








	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>



	<script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?{{ theme.baidu_analytics }}";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
