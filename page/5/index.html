<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Mengyy&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta name="keywords" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Mengyy&#39;s Blog">
<meta property="og:url" content="http://mengyangyang.org/page/5/index.html">
<meta property="og:site_name" content="Mengyy&#39;s Blog">
<meta property="og:locale" content="en_US.UTF-8">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mengyy&#39;s Blog">
  
    <link rel="alternate" href="/atom.xml" title="Mengyy&#39;s Blog" type="application/atom+xml">
  
  <link rel="icon" href="/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/fashion.css">
  <link rel="stylesheet" href="/css/glyphs.css">

</head>
</html>


  <body>


  


<header id="allheader" class="site-header" role="banner" 
   >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="Mengyy&#39;s Blog" rel="home"> Mengyy&#39;s Blog </a>
            
          </h1>
          
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">

  
    <article id="post-python-metaclass"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/07/18/python-metaclass/">Python元类</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/07/18/python-metaclass/" class="article-date">
	  <time datetime="2017-07-18T14:29:23.000Z" itemprop="datePublished">July 18, 2017</time>
	</a>





       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>[Metaclasses] are deeper magic than 99% of users should ever worry about. If you wonder whether you need them, you don’t (the people who actually need them know with certainty that they need them, and don’t need an explanation about why).</em> The Python core developer Time Peters said.</p>
<p>元类是创建类的类。新风格(new-style)类是type类的实例。元类是type类的派生类，通过重载type类的<code>__new__</code>和<code>__init__</code>方法，重新定义类创建协议，来实现类创建的定制化。</p>
<h2 id="元类模型"><a href="#元类模型" class="headerlink" title="元类模型"></a>元类模型</h2><p>(对象)实例是通过类创建，类是通过type类创建，元类是type类的派生类。</p>
<ul>
<li>类型(自定义)是通过type类或type派生元类创建</li>
<li>元类是type类的派生类</li>
<li>用户自定义类是type类的实例</li>
<li>用户自定义类可以生成自己的实例</li>
</ul>
<h3 id="类声明协议"><a href="#类声明协议" class="headerlink" title="类声明协议"></a>类声明协议</h3><p>Python解释器在类声明语句结束时，调用type类型创建，<code>class = type(classname, superclasses, attributedict)</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type.__new__(meta, classname, superclasses, attributedict)</span><br><span class="line">type.__init__(cls, classname, superclasses, attributedict)</span><br></pre></td></tr></table></figure>
<h2 id="声明元类"><a href="#声明元类" class="headerlink" title="声明元类"></a>声明元类</h2><p>Py3与Py2声明元类的方式不一样：</p>
<p>Py3声明元类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Metaclass</span><span class="params">(type)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(meta, classname, superclasses, attributedict)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> type(classname, superclasses, attributedict)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(cls, classname, superclasses, attributedict)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Dummy</span><span class="params">(object, metaclass=Metaclass)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Py2声明元类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Metaclass</span><span class="params">(type)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(meta, classname, superclasses, attributedict)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> type(classname, superclasses, attributedict)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(cls, classname, superclasses, attributedict)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Dummy</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">... </span>    __metaclass__ = Metaclass</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="继承和实例"><a href="#继承和实例" class="headerlink" title="继承和实例"></a>继承和实例</h2><ul>
<li>元类继承于type类</li>
<li>元类的声明可以被派生类继承</li>
<li>元类的属性不能被类的实例继承</li>
<li>元类的属性可以被类获取</li>
</ul>
<p><strong>元类继承于type类</strong></p>
<p>元类重载type类的<code>__new__</code>和<code>__init__</code>方法，定制类的创建和初始化。</p>
<p><strong>元类的声明可以被派生类继承</strong></p>
<p><strong>元类的属性不能被类实例继承</strong></p>
<p>类是元类的实例，元类的行为可以被类访问，当类不能被类的实例访问。</p>
<p><strong>元类的属性可以被类获取</strong></p>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p><strong>Python继承算法</strong></p>
<ol>
<li>对于一个实例，先搜索这个实例，再搜索实例的类，再搜索超类<br>a. 先搜索实例的<code>__dict__</code><br>b. 再搜索该实例的类的<code>__mro__</code>对应类的<code>__dict__</code></li>
<li>对于一个类，先搜索类，再搜索超类，再搜索元类<br>a. 根据<code>__mro__</code>搜索类的<code>__dict__</code><br>b. 再搜索元类的<code>__dict__</code></li>
<li>规则1和2中，再b阶段中，数据描述的优先级高</li>
<li>规则1和2中，对于内置的运算符，跳过a阶段</li>
</ol>
<p><strong>数据描述符继承算法</strong></p>
<p>对于定义了<code>__set__</code>拦截赋值的描述符就是数据描述符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, ins, _type)</span>:</span></span><br><span class="line"><span class="meta">... </span>            print(<span class="string">'call D.__get__'</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, ins, value)</span>:</span></span><br><span class="line"><span class="meta">... </span>            print(<span class="string">'call D.__set__'</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Dummy</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">... </span>    d = D()</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins = Dummy()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins.d</span><br><span class="line">call D.__get__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins.d = <span class="string">'spam'</span></span><br><span class="line">call D.__set__</span><br></pre></td></tr></table></figure>
<p>未定义<code>__set__</code>的描述符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, ins, value)</span>:</span></span><br><span class="line"><span class="meta">... </span>            print(<span class="string">'call D.__get__'</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Dummy</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">... </span>    d = D()</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins = Dummy()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins.d</span><br><span class="line">call D.__get__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins.d = <span class="string">'spam'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ins.d</span><br><span class="line"><span class="string">'spam</span></span><br></pre></td></tr></table></figure>
<p>Python 的继承算法</p>
<ol>
<li>对于实例I，先搜索实例，再搜索类，再搜索超类<br>a. 根据类的<code>__mro__</code>搜索超类的<code>__dict__</code><br>b. If 如果在a阶段发现了数据描述，调用该数据描述，完成后退出<br>c. Else 返回该实例<code>__dict__</code>中的值<br>d. Else 调用非数据描述符，并放回结果</li>
<li>对于类C，搜索类，再搜索超类，再搜索元类<br>a. 搜索类的<code>__mro__</code>依次搜索类的<code>__dict__</code><br>b. If 如果在a阶段发现了数据描述符，调用该数据描述符，完成后退出<br>c. Else 返回该类<code>__dict__</code>中值g<br>d. Else 调用非数据描述符，返回结果</li>
</ol>
<blockquote>
<p>Note, 数据描述符的优先级 &gt; 普通属性 &gt; 非数据描述符</p>
</blockquote>
<h2 id="元类与类装饰器"><a href="#元类与类装饰器" class="headerlink" title="元类与类装饰器"></a>元类与类装饰器</h2><p>TODO</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>django ORM</p>
<p>ripozo API</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><em>Learning Python 5th Edition</em></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-descriptor"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/07/10/python-descriptor/">Python描述符</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/07/10/python-descriptor/" class="article-date">
	  <time datetime="2017-07-10T14:28:07.000Z" itemprop="datePublished">July 10, 2017</time>
	</a>





       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>如果一个对象定义了以下任意方法，这个对象就是一个描述符。给描述符下个定义，描述符就是绑定了行为属性的对象。</p>
<p><code>object.__get__(self, instance, owner)</code></p>
<p><code>object.__set__(self, instance, value)</code></p>
<p><code>object.__delete__(self, instance)</code></p>
<p>属性访问的默认行为就是从一个对象字典中获取、设置和删除属性。比如，<code>a.x</code>首先会搜索<code>a.__dict__[&#39;x&#39;]</code>，其次<code>type(a).__dict__[&#39;x&#39;]</code>，最后所有<code>type(a)</code>的元类。<strong>如果要查找的值一个包含描述器方法的对象，Python会用调用描述器方法代替默认行为。</strong></p>
<blockquote>
<p>Note:只有new-style class会调用描述符的对象的方法。</p>
</blockquote>
<p>描述符是一个强大的通用协议。Python内建的property, staticmethod, classmethod, super背后的实现机制都是描述符协议。</p>
<h2 id="Descriptor-Protocol"><a href="#Descriptor-Protocol" class="headerlink" title="Descriptor Protocol"></a>Descriptor Protocol</h2><p><code>object.__get__(self, ins, _type=None)</code></p>
<p><code>object.__set__(self, ins, value)</code></p>
<p><code>object.__del__(self, ins)</code></p>
<p>如果一个对象包含上面任意一个方法，就可以被看作是一个描述符。如果一个对象定义了<code>__get__</code>和<code>__set__</code>两个方法，该对象可以被看作一个数据描述符，如果一个对象只定义了<code>__get__</code>，该对象就是non-data描述符。</p>
<p><strong>数据描述符与非数据描述符的区别在于，描述符与对象实例entry调用优先级。如果一个实例的字典有一个entry和数据描述符的名字相同，数据描述符的调用的优先级高。如果一个实例有一个entry和非数据描述符的名字相同个，实例entry的调用的优先级高。</strong></p>
<h2 id="Invoking-Descriptors"><a href="#Invoking-Descriptors" class="headerlink" title="Invoking Descriptors"></a>Invoking Descriptors</h2><p><code>obj.d</code>查找obj的字典是否包含d，如果d定义了<code>__get__</code>方法，<code>d.__get__(obj, type(obj))</code>就会被调用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">    <span class="string">"Emulate type_getattro() in Objects/typeobject.c"</span></span><br><span class="line">    v = object.__getattribute__(self, key)</span><br><span class="line">    <span class="keyword">if</span> hasattr(v, <span class="string">'__get__'</span>):</span><br><span class="line">        <span class="keyword">return</span> v.__get__(<span class="keyword">None</span>, self)</span><br><span class="line">    <span class="keyword">return</span> v</span><br></pre></td></tr></table></figure>
<p>super()返回的对象有一个定制化的<code>__getattribute__</code>方法，用于调用描述符。<code>super(B, self).m</code>先会搜索<code>obj.__class__.__mro__</code>查找基类A，如果是一个数据描述符，则会调用<code>A.__dict__[&#39;m&#39;].__get__(obj, B)</code>，如果是一个非数据描述符，返回结果不会改变。</p>
<h2 id="Built-in-Descriptors"><a href="#Built-in-Descriptors" class="headerlink" title="Built-in Descriptors"></a>Built-in Descriptors</h2><h3 id="Property"><a href="#Property" class="headerlink" title="Property"></a>Property</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getx</span><span class="params">(self)</span>:</span> <span class="keyword">return</span> self.__x</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setx</span><span class="params">(self, value)</span>:</span> self.__x = value</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delx</span><span class="params">(self)</span>:</span> <span class="keyword">del</span> self.__x</span><br><span class="line">    x = property(getx, setx, delx, <span class="string">"I'm the 'x' property."</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Property</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"Emulate PyProperty_Type() in Objects/descrobject.c"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, fget=None, fset=None, fdel=None, doc=None)</span>:</span></span><br><span class="line">        self.fget = fget</span><br><span class="line">        self.fset = fset</span><br><span class="line">        self.fdel = fdel</span><br><span class="line">        <span class="keyword">if</span> doc <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">and</span> fget <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            doc = fget.__doc__</span><br><span class="line">        self.__doc__ = doc</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, obj, objtype=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> obj <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">if</span> self.fget <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">"unreadable attribute"</span>)</span><br><span class="line">        <span class="keyword">return</span> self.fget(obj)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, obj, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.fset <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">"can't set attribute"</span>)</span><br><span class="line">        self.fset(obj, value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.fdel <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">"can't delete attribute"</span>)</span><br><span class="line">        self.fdel(obj)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getter</span><span class="params">(self, fget)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> type(self)(fget, self.fset, self.fdel, self.__doc__)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setter</span><span class="params">(self, fset)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> type(self)(self.fget, fset, self.fdel, self.__doc__)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deleter</span><span class="params">(self, fdel)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> type(self)(self.fget, self.fset, fdel, self.__doc__)</span><br></pre></td></tr></table></figure>
<h3 id="Staticmethod"><a href="#Staticmethod" class="headerlink" title="Staticmethod"></a>Staticmethod</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaticMethod</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"Emulate PyStaticMethod_Type() in Objects/funcobject.c"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, f)</span>:</span></span><br><span class="line">        self.f = f</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, obj, objtype=None)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.f</span><br></pre></td></tr></table></figure>
<h3 id="Classmethod"><a href="#Classmethod" class="headerlink" title="Classmethod"></a>Classmethod</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassMethod</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"Emulate PyClassMethod_Type() in Objects/funcobject.c"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, f)</span>:</span></span><br><span class="line">        self.f = f</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, obj, klass=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> klass <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            klass = type(obj)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">newfunc</span><span class="params">(*args)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self.f(klass, *args)</span><br><span class="line">        <span class="keyword">return</span> newfunc</span><br></pre></td></tr></table></figure>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://docs.python.org/2/reference/datamodel.html#descriptors" target="_blank" rel="noopener">https://docs.python.org/2/reference/datamodel.html#descriptors</a></li>
<li><a href="https://docs.python.org/2/howto/descriptor.html" target="_blank" rel="noopener">https://docs.python.org/2/howto/descriptor.html</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-context"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/07/09/python-context/">Python上下文管理器</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/07/09/python-context/" class="article-date">
	  <time datetime="2017-07-09T14:26:25.000Z" itemprop="datePublished">July 9, 2017</time>
	</a>





       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>上下管理器是一个对象，定义了执行<code>with</code>语句时需要创建的上下文。context manager的<code>__enter__()</code>和<code>__exit__()</code>方法分别在进入、退出<code>with</code>语句时被调用。</p>
<p><code>object.__enter__(self)</code></p>
<p><code>object.__exit__(self, exc_type, exc_value, traceback)</code></p>
<h2 id="with-statement"><a href="#with-statement" class="headerlink" title="with statement"></a>with statement</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with_stmt ::=  <span class="string">"with"</span> with_item (<span class="string">","</span> with_item)* <span class="string">":"</span> suite</span><br><span class="line">with_item ::=  expression [<span class="string">"as"</span> target]</span><br></pre></td></tr></table></figure>
<p><strong>with</strong>语句执行数据流：</p>
<ol>
<li>评估上下文表达式是否包含上下文管理器</li>
<li>加载上下文管理器的<code>__exit__</code>方法</li>
<li>调用上下文管理的<code>__enter__</code>方法</li>
<li>如果target包含在with语句中，将<code>__enter__</code>方法的返回值赋给target</li>
<li>执行suite</li>
<li>调用<code>__exit__()</code>方法</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mgr = (EXPR)</span><br><span class="line">exit = type(mgr).__exit__  <span class="comment"># Not calling it yet</span></span><br><span class="line">value = type(mgr).__enter__(mgr)</span><br><span class="line">exc = <span class="keyword">True</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    VAR = value  <span class="comment"># Only if "as VAR" is present</span></span><br><span class="line">    BLOCK</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># The exceptional case is handled here</span></span><br><span class="line">    exc = <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exit(mgr, *sys.exc_info()):</span><br><span class="line">    		<span class="keyword">raise</span></span><br><span class="line">    <span class="comment"># The exception is swallowed if exit() returns true</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment"># The normal and non-local-goto cases are handled here</span></span><br><span class="line">    <span class="keyword">if</span> exc:</span><br><span class="line">        exit(mgr, <span class="keyword">None</span>, <span class="keyword">None</span>, <span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<h2 id="contextlib"><a href="#contextlib" class="headerlink" title="contextlib"></a>contextlib</h2><p>contextlib提供了快速定义支持上下文管理器的函数对象。</p>
<p>定义一个生成器函数，contextmanager装饰后就变成一个支持上下文管理器的函数对象。yield之前语句子在代码块之前被执行，yield之后语句在代码执行完之后被执行。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@contextmanager</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">tag</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'&lt;%s&gt;'</span> % name)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'&lt;/%s&gt;'</span> % name)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> tag(<span class="string">'h1'</span>):</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'hotbaby'</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">&lt;h1&gt;</span><br><span class="line">hotbaby</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure>
<h2 id="context-decorator"><a href="#context-decorator" class="headerlink" title="context decorator"></a>context decorator</h2><p>contextmanager是一个函数装饰器，装饰只包含一个yield语句的生成器函数，返回一个支持上下文管理器的函数对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">contextmanager</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(*args, **kwds)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> GeneratorContextManager(func(*args, **kwds))</span><br><span class="line">    <span class="keyword">return</span> helper</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note: 被装饰的生成器函数变成生成器作为参数传递到<strong>GeneratorContextManager</strong>对象中。</p>
</blockquote>
<p>生成器上下文管理器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GeneratorContextManager</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""Helper for @contextmanager decorator."""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, gen)</span>:</span></span><br><span class="line">        self.gen = gen</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.gen.next()</span><br><span class="line">        <span class="keyword">except</span> StopIteration:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">"generator didn't yield"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, type, value, traceback)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> type <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.gen.next()</span><br><span class="line">            <span class="keyword">except</span> StopIteration:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">"generator didn't stop"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> value <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">                <span class="comment"># Need to force instantiation so we can reliably</span></span><br><span class="line">                <span class="comment"># tell if we get the same exception back</span></span><br><span class="line">                value = type()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.gen.throw(type, value, traceback)</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">"generator didn't stop after throw()"</span>)</span><br><span class="line">            <span class="keyword">except</span> StopIteration, exc:</span><br><span class="line">                <span class="comment"># Suppress the exception *unless* it's the same exception that</span></span><br><span class="line">                <span class="comment"># was passed to throw().  This prevents a StopIteration</span></span><br><span class="line">                <span class="comment"># raised inside the "with" statement from being suppressed</span></span><br><span class="line">                <span class="keyword">return</span> exc <span class="keyword">is</span> <span class="keyword">not</span> value</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="comment"># only re-raise if it's *not* the exception that was</span></span><br><span class="line">                <span class="comment"># passed to throw(), because __exit__() must not raise</span></span><br><span class="line">                <span class="comment"># an exception unless __exit__() itself failed.  But throw()</span></span><br><span class="line">                <span class="comment"># has to raise the exception to signal propagation, so this</span></span><br><span class="line">                <span class="comment"># fixes the impedance mismatch between the throw() protocol</span></span><br><span class="line">                <span class="comment"># and the __exit__() protocol.</span></span><br><span class="line">                <span class="comment">#</span></span><br><span class="line">                <span class="keyword">if</span> sys.exc_info()[<span class="number">1</span>] <span class="keyword">is</span> <span class="keyword">not</span> value:</span><br><span class="line">                    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><ul>
<li><a href="http://hotbaby.org/python/2/reference/datamodel.html#with-statement-context-managers" target="_blank" rel="noopener">http://hotbaby.org/python/2/reference/datamodel.html#with-statement-context-managers</a></li>
<li><a href="http://hotbaby.org/python/2/reference/compound_stmts.html#the-with-statement" target="_blank" rel="noopener">http://hotbaby.org/python/2/reference/compound_stmts.html#the-with-statement</a></li>
<li><a href="http://hotbaby.org/python/2/library/contextlib.html" target="_blank" rel="noopener">http://hotbaby.org/python/2/library/contextlib.html</a></li>
<li><a href="https://hg.python.org/cpython/file/2.7/Lib/contextlib.py" target="_blank" rel="noopener">https://hg.python.org/cpython/file/2.7/Lib/contextlib.py</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0343/" target="_blank" rel="noopener">https://www.python.org/dev/peps/pep-0343/</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-itertools"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/07/01/python-itertools/">Python Itertools</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/07/01/python-itertools/" class="article-date">
	  <time datetime="2017-07-01T13:57:10.000Z" itemprop="datePublished">July 1, 2017</time>
	</a>





       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="itertools-imap"><a href="#itertools-imap" class="headerlink" title="itertools.imap()"></a>itertools.imap()</h4><p><code>imap(func, *iterables)</code> 和iter和map混合体。</p>
<p>工作原理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">myimap</span><span class="params">(func, *iterables)</span>:</span></span><br><span class="line">	iterables = map(iter,iterables)</span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">		args = [next(it) <span class="keyword">for</span> it <span class="keyword">in</span> iterables]</span><br><span class="line">		<span class="keyword">yield</span> func(*args)</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[item <span class="keyword">for</span> item <span class="keyword">in</span> myimap(pow, (<span class="number">2</span>,<span class="number">2</span>), (<span class="number">3</span>,<span class="number">3</span>))]</span><br><span class="line">[<span class="number">8</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<h4 id="itertools-chain"><a href="#itertools-chain" class="headerlink" title="itertools.chain()"></a>itertools.chain()</h4><p><code>chain(*iterables)</code> 返回一个迭代器，该迭代器依次返回可迭代对象中没一个元素。</p>
<p>工作原理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">mychain</span><span class="params">(*iterables)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> iter_ <span class="keyword">in</span> iterables:</span><br><span class="line">		<span class="keyword">for</span> item <span class="keyword">in</span> iter_:</span><br><span class="line">			<span class="keyword">yield</span> item</span><br><span class="line">			</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[item <span class="keyword">for</span> item <span class="keyword">in</span> mychain(<span class="string">'abc'</span>, <span class="string">'def'</span>)]</span><br><span class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>]</span><br></pre></td></tr></table></figure>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://docs.python.org/2/library/functions.html" target="_blank" rel="noopener">https://docs.python.org/2/library/functions.html</a></li>
<li><a href="https://docs.python.org/2/library/functools.html" target="_blank" rel="noopener">https://docs.python.org/2/library/functools.html</a></li>
<li><a href="https://docs.python.org/2/library/itertools.html" target="_blank" rel="noopener">https://docs.python.org/2/library/itertools.html</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-debian-tz"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/06/09/debian-tz/">Debian时区配置</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/06/09/debian-tz/" class="article-date">
	  <time datetime="2017-06-09T14:23:48.000Z" itemprop="datePublished">June 9, 2017</time>
	</a>





       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>dpkg-reconfigure tzdata</code></p>
<p><strong>Referece</strong></p>
<ul>
<li><a href="https://wiki.debian.org/TimeZoneChanges" target="_blank" rel="noopener">https://wiki.debian.org/TimeZoneChanges</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Debian/">Debian</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-pypi"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/06/08/python-pypi/">Python PyPI</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/06/08/python-pypi/" class="article-date">
	  <time datetime="2017-06-08T14:22:06.000Z" itemprop="datePublished">June 8, 2017</time>
	</a>





       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>PyPI(Python Package Index)是Python软件仓库。</p>
<p>pip是Python包管理工具，默认使用<code>pypi.python.org</code>作为PyPI的镜像。</p>
<p>pip安装Python软件包经常会出现”链接pypi.python.org失败”。为了优化包的管理，考虑替换<code>pypi.python.org</code>,转而使用国内的PyPI镜像。</p>
<p><strong>PyPI mirror list</strong></p>
<table>
<thead>
<tr>
<th>Mirror</th>
<th>Location</th>
</tr>
</thead>
<tbody>
<tr>
<td>pypi.python.org</td>
<td>San Francisco, California US</td>
</tr>
<tr>
<td>pypi.douban.com</td>
<td>Beijing, Beijing CN</td>
</tr>
<tr>
<td>pypi.fcio.net</td>
<td>Oberhausen, Nordrhein-Westfalen DE</td>
</tr>
</tbody>
</table>
<p><strong>Linux(Debian) 替换PyPI镜像</strong></p>
<p><code>touch ~/.pip/pip.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = https://pypi.douban.com/simple</span><br><span class="line">format = columns</span><br></pre></td></tr></table></figure>
<p><strong>参考</strong></p>
<ul>
<li><a href="https://www.pypi-mirrors.org/" target="_blank" rel="noopener">https://www.pypi-mirrors.org/</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/21863043" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/21863043</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PyPI/">PyPI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-lisp"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/06/01/lisp/">Lisp</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/06/01/lisp/" class="article-date">
	  <time datetime="2017-06-01T14:21:04.000Z" itemprop="datePublished">June 1, 2017</time>
	</a>





       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Lisp语言从诞生的时候就包含9种思想.其中一些我们今天已经习以为常,另一些则刚刚在其他高级语言中出现,至今还有2种是Lisp独有的.按照大众的接受程度,这9种思想依次如下排列:</p>
<ol>
<li>条件结构.现在大家都觉得这是理所当然的,但是Fortran I就没有这个结构,它只有底层机器的goto结构.</li>
<li>函数也是一种数据类型.在Lisp语言中,函数与整数或字符串一样,也属于数据类型的一种.它有自己的字面表示形式(literal representation),能狗存储在变量中,也能当作参数传递.一种数据类型应该有的功能,它都有.</li>
<li>递归.Lisp是第一个支持递归函数的高级语言.</li>
<li>变量的动态类型.在Lisp语言中,所有变量实际上都是指针,所指向的值有类型之分,而变量本身没有.复制变量就是相当于复制指针,而不是复制它们指向的数据.</li>
<li>垃圾回收机制.</li>
<li>程序由表达式组成.Lisp程序是一些表达树的集合,每个表达式都返回一个值.这与Fortran和大多数后来的语言都截然不同,他们的程序都由表达式和语句组成.区分表达式与语句在Fortran I中是自然的,因为它不支持语句嵌套.所以,如果你需要用数学式子计算一个值,那就只有表达式返回这个值,没有其他语法结构可用,否则就无法处理这个值.后来,新的编程语言支持块结构,这种限制当然就不存在了.但是为时已晚,表达式和语句的区分已经根深蒂固.它从Fortran扩散到它们两者的后继语言.</li>
<li>符号类型.符号实际上是一种指针,指向存储在散列表中字符串.所以,比较两个符号是否相等,只要看它们的指针是否一样就可以了,不用逐个字符比较.</li>
<li>代码使用符号和常量组成的树形表示法.</li>
<li>无论什么时候,整个语言都是可用的.Lisp并不真正区分读取,编译期和运行期.你可以在读取期编译或运行代码,也可以在编译期读取和运行代码,还可以在运行期读取或编译代码.在读取期运行代码,使得用户可以重新调整Lisp的语法,在编译期运行代码,则是Lisp宏的工作基础,在运行期编译代码,使得Lisp可以在Emacs这样的程序中充当扩展语言(extension language),在运行期读取代码,使得程序之间可以用S表达式通信,近来XML格式的出现使得这个概念被重新”发明”出来了.</li>
</ol>
<p>Lisp语言刚出现的时候,这些思想与其他编程语言大相径庭,后者的设计思想主要由50年代后期的硬件决定.随着时间流逝,流行的编程语言不断更新换代,语言设计思想逐渐向Lisp靠拢.思想(1)到思想(5)已经被广泛接受,思想(6)开始在主流编程语言中出现,思想(7)在Python语言中有所实现,不过似乎没有专用的语法.</p>
<p>思想(8)可能是最有意思的一点.它与思想(9)只是由于偶然的原因成为Lisp语言的一部分，因为它们不属于麦卡锡的原始构想，是由拉塞尔自行添加的．它们从此使得Lisp语言看上去很古怪，但也成为了这种语言最独一无二的特点．说Lisp语法古怪不是因为它的语法很古怪，而是因为它根本就没有语法，程序直接以解析树(parse tree)的形式表达出来．在其他语言中，这种形式只是经过解析在后台产生，但是Lisp直接采用它作为表达式形式．它由列表构成，而列表则是Lisp的基本数据结构．</p>
<p>用一种语言自己的数据结构来表达该语言是非常强大的功能．思想(8)和思想(9)，意味着你可以写出一种能够自己编程的程序．</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Lisp/">Lisp</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-django-database-router"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/05/17/django-database-router/">Django数据库路由</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/05/17/django-database-router/" class="article-date">
	  <time datetime="2017-05-17T14:19:28.000Z" itemprop="datePublished">May 17, 2017</time>
	</a>





       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>django ORM数据模型配置数据库．</p>
<p>django支持多个数据库，通过django ORM定义数据模型，比如<code>class User(Model)</code>，无法通过<code>class Meta</code>配置管理该数据模型对应的数据库，只能使用默认数据库<code>default</code>．</p>
<p>django <code>ConnectionRouter</code>解决数据模型与数据库映射．</p>
<p><strong>实现DB router</strong></p>
<p><code>db_router.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line">_logger = logging.getLogger(<span class="string">'django'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatabaseRouter</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Database router to control the  models for differrent db.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    DEFAULT_DB = <span class="string">'default'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_db</span><span class="params">(self, model, **hints)</span>:</span></span><br><span class="line">        db = getattr(model, <span class="string">'_database'</span>, <span class="keyword">None</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> db:</span><br><span class="line">            <span class="keyword">return</span> self.DEFAULT_DB</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> db <span class="keyword">in</span> settings.DATABASES.keys():</span><br><span class="line">            <span class="keyword">return</span> db</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            _logger.warn(<span class="string">'%s not exist'</span> % db)</span><br><span class="line">            <span class="keyword">return</span> self.DEFAULT_DB</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db_for_read</span><span class="params">(self, model, **hints)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._db(model, **hints)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db_for_write</span><span class="params">(self, model, **hints)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._db(model, **hints)</span><br></pre></td></tr></table></figure>
<p><strong>配置DB routers</strong></p>
<p><code>DATABASE_ROUTERS = [&#39;db_router.DatabaseRouter&#39;]</code></p>
<p><strong>为Model制定数据库</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Model)</span></span></span><br><span class="line">	_database = 'user_db'</span><br><span class="line">    <span class="class"><span class="keyword">class</span>  <span class="title">Meta</span>:</span></span><br><span class="line">    	db_table = <span class="string">'user'</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p><strong>实现原理</strong></p>
<p>django通过<code>ConnectionRouter</code>管理数据库路由</p>
<p><code>django/db/utils.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConnectionRouter</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @cached_property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">routers</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self._routers <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            self._routers = settings.DATABASE_ROUTERS</span><br><span class="line">        routers = []</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> self._routers:</span><br><span class="line">            <span class="keyword">if</span> isinstance(r, six.string_types):</span><br><span class="line">                router = import_string(r)()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                router = r</span><br><span class="line">            routers.append(router)</span><br><span class="line">        <span class="keyword">return</span> routers</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_router_func</span><span class="params">(action)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">_route_db</span><span class="params">(self, model, **hints)</span>:</span></span><br><span class="line">            chosen_db = <span class="keyword">None</span></span><br><span class="line">            <span class="keyword">for</span> router <span class="keyword">in</span> self.routers:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    method = getattr(router, action)</span><br><span class="line">                <span class="keyword">except</span> AttributeError:</span><br><span class="line">                    <span class="comment"># If the router doesn't have a method, skip to the next one.</span></span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    chosen_db = method(model, **hints)</span><br><span class="line">                    <span class="keyword">if</span> chosen_db:</span><br><span class="line">                        <span class="keyword">return</span> chosen_db</span><br><span class="line">            instance = hints.get(<span class="string">'instance'</span>)</span><br><span class="line">            <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">and</span> instance._state.db:</span><br><span class="line">                <span class="keyword">return</span> instance._state.db</span><br><span class="line">            <span class="keyword">return</span> DEFAULT_DB_ALIAS</span><br><span class="line">        <span class="keyword">return</span> _route_db</span><br><span class="line"></span><br><span class="line">    db_for_read = _router_func(<span class="string">'db_for_read'</span>)</span><br><span class="line">    db_for_write = _router_func(<span class="string">'db_for_write'</span>)</span><br></pre></td></tr></table></figure>
<p>router初始化</p>
<p><code>router = ConnectionRouter()</code></p>
<p>router引用</p>
<p><code>django/db/models/query.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuerySet</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"Return the database that will be used if this query is executed now"</span></span><br><span class="line">        <span class="keyword">if</span> self._for_write:</span><br><span class="line">            <span class="keyword">return</span> self._db <span class="keyword">or</span> router.db_for_write(self.model, **self._hints)</span><br><span class="line">        <span class="keyword">return</span> self._db <span class="keyword">or</span> router.db_for_read(self.model, **self._hints)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/">Django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-wsgi"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/05/17/python-wsgi/">Python WSGI</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/05/17/python-wsgi/" class="article-date">
	  <time datetime="2017-05-17T14:17:37.000Z" itemprop="datePublished">May 17, 2017</time>
	</a>





       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>WSGI(Web Server Gateway Interface) Web服务网关接口。</p>
<p>WSGI的目的替代CGI。CGI进程（类似Python解释器）针对每个请求进行创建，完成请求后退出。如果应程序接收树钱个请求，创建大量的语言解释器进程就会很快导致服务器宕机。</p>
<p><strong>其目标在Web服务器与Web框架层之间提供一个通用的API标准，减少之间互操作性，并形成统一的调用方式。</strong></p>
<h2 id="WSGI-应用"><a href="#WSGI-应用" class="headerlink" title="WSGI 应用"></a>WSGI 应用</h2><p>根据WSGI的定义，其应用是可调用的对象，其参数固定为两个：</p>
<ul>
<li>含有服务器环境变量的字典</li>
<li>可调用的对象， 该对象使用HTTP状态码和会返回客户端的HTTP头来初始化响应</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">simple_wsgi_app</span><span class="params">(environment, start_response)</span>:</span></span><br><span class="line">    status = <span class="string">'200 OK'</span></span><br><span class="line">    headers = [<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>]</span><br><span class="line">    start_response(status, headers)</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">'Hello world!'</span>]</span><br></pre></td></tr></table></figure>
<p><strong>environment</strong> 包含一些环境变量，如HTTP_HOST, HTTP_USER, HTTP_AGENT, SERVER_PROTOCOL等。‘</p>
<p><strong>start_response()</strong>是一个可调用的对象，必须在应用执行，生成最终发送回客户端的响应</p>
<p>werkzeug中start_response定义：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_response</span><span class="params">(status, response_headers, exc_info=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> exc_info:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> headers_sent:</span><br><span class="line">                reraise(*exc_info)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            exc_info = <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">elif</span> headers_set:</span><br><span class="line">        <span class="keyword">raise</span> AssertionError(<span class="string">'Headers already set'</span>)</span><br><span class="line">    headers_set[:] = [status, response_headers]</span><br><span class="line">    <span class="keyword">return</span> write</span><br></pre></td></tr></table></figure>
<h2 id="WSGI服务器"><a href="#WSGI服务器" class="headerlink" title="WSGI服务器"></a>WSGI服务器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_wsgi_app</span><span class="params">(app, environment)</span>:</span></span><br><span class="line">    body = StringIO.StringIO()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_response</span><span class="params">(status, headers)</span>:</span></span><br><span class="line">        body.write(<span class="string">'Status: %s\r\n'</span> % status)</span><br><span class="line">        <span class="keyword">for</span> header <span class="keyword">in</span> headers:</span><br><span class="line">            body.write(<span class="string">'%s: %s\r\n'</span> % header)</span><br><span class="line">        <span class="keyword">return</span> body.write</span><br><span class="line"></span><br><span class="line">    iterable = app(environment, start_response)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        body.write(<span class="string">'\r\n%s\r\n'</span> % <span class="string">'\r\n'</span>.join(line <span class="keyword">for</span> line <span class="keyword">in</span> iterable))</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> hasattr(iterable, <span class="string">'close'</span>) <span class="keyword">and</span> callable(iterable.close):</span><br><span class="line">            iterable.close()</span><br></pre></td></tr></table></figure>
<h2 id="Flask-WSGI-应用和服务实现"><a href="#Flask-WSGI-应用和服务实现" class="headerlink" title="Flask WSGI 应用和服务实现"></a>Flask WSGI 应用和服务实现</h2><p><strong>flask WSGI app</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Flask:wsgi_app</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wsgi_app</span><span class="params">(self, environ, start_response)</span>:</span></span><br><span class="line">    <span class="string">"""The actual WSGI application.  This is not implemented in</span></span><br><span class="line"><span class="string">    `__call__` so that middlewares can be applied without losing a</span></span><br><span class="line"><span class="string">    reference to the class.  So instead of doing this::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        app = MyMiddleware(app)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    It's a better idea to do this instead::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        app.wsgi_app = MyMiddleware(app.wsgi_app)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Then you still have the original application object around and</span></span><br><span class="line"><span class="string">    can continue to call methods on it.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 0.7</span></span><br><span class="line"><span class="string">       The behavior of the before and after request callbacks was changed</span></span><br><span class="line"><span class="string">       under error conditions and a new callback was added that will</span></span><br><span class="line"><span class="string">       always execute at the end of the request, independent on if an</span></span><br><span class="line"><span class="string">       error occurred or not.  See :ref:`callbacks-and-errors`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param environ: a WSGI environment</span></span><br><span class="line"><span class="string">    :param start_response: a callable accepting a status code,</span></span><br><span class="line"><span class="string">                           a list of headers and an optional</span></span><br><span class="line"><span class="string">                           exception context to start the response</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ctx = self.request_context(environ)</span><br><span class="line">    ctx.push()</span><br><span class="line">    error = <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = self.full_dispatch_request()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            error = e</span><br><span class="line">            response = self.handle_exception(e)</span><br><span class="line">        <span class="keyword">return</span> response(environ, start_response)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> self.should_ignore_error(error):</span><br><span class="line">            error = <span class="keyword">None</span></span><br><span class="line">        ctx.auto_pop(error)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Flask:__call__</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, environ, start_response)</span>:</span></span><br><span class="line">    <span class="string">"""Shortcut for :attr:`wsgi_app`."""</span></span><br><span class="line">    <span class="keyword">return</span> self.wsgi_app(environ, start_response)</span><br><span class="line"></span><br><span class="line"><span class="comment"># BaseResponse:__call__</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, environ, start_response)</span>:</span></span><br><span class="line">    <span class="string">"""Process this response as WSGI application.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param environ: the WSGI environment.</span></span><br><span class="line"><span class="string">    :param start_response: the response callable provided by the WSGI</span></span><br><span class="line"><span class="string">                           server.</span></span><br><span class="line"><span class="string">    :return: an application iterator</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    app_iter, status, headers = self.get_wsgi_response(environ)</span><br><span class="line">    start_response(status, headers)</span><br><span class="line">    <span class="keyword">return</span> app_iter</span><br></pre></td></tr></table></figure>
<p><strong>flask WSGI Server</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_wsgi</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> self.headers.get(<span class="string">'Expect'</span>, <span class="string">''</span>).lower().strip() == <span class="string">'100-continue'</span>:</span><br><span class="line">        self.wfile.write(<span class="string">b'HTTP/1.1 100 Continue\r\n\r\n'</span>)</span><br><span class="line"></span><br><span class="line">    self.environ = environ = self.make_environ()</span><br><span class="line">    headers_set = []</span><br><span class="line">    headers_sent = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(data)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> headers_set, <span class="string">'write() before start_response'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> headers_sent:</span><br><span class="line">            status, response_headers = headers_sent[:] = headers_set</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                code, msg = status.split(<span class="keyword">None</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                code, msg = status, <span class="string">""</span></span><br><span class="line">            self.send_response(int(code), msg)</span><br><span class="line">            header_keys = set()</span><br><span class="line">            <span class="keyword">for</span> key, value <span class="keyword">in</span> response_headers:</span><br><span class="line">                self.send_header(key, value)</span><br><span class="line">                key = key.lower()</span><br><span class="line">                header_keys.add(key)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'content-length'</span> <span class="keyword">not</span> <span class="keyword">in</span> header_keys:</span><br><span class="line">                self.close_connection = <span class="keyword">True</span></span><br><span class="line">                self.send_header(<span class="string">'Connection'</span>, <span class="string">'close'</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'server'</span> <span class="keyword">not</span> <span class="keyword">in</span> header_keys:</span><br><span class="line">                self.send_header(<span class="string">'Server'</span>, self.version_string())</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'date'</span> <span class="keyword">not</span> <span class="keyword">in</span> header_keys:</span><br><span class="line">                self.send_header(<span class="string">'Date'</span>, self.date_time_string())</span><br><span class="line">            self.end_headers()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> isinstance(data, bytes), <span class="string">'applications must write bytes'</span></span><br><span class="line">        self.wfile.write(data)</span><br><span class="line">        self.wfile.flush()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_response</span><span class="params">(status, response_headers, exc_info=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> exc_info:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> headers_sent:</span><br><span class="line">                    reraise(*exc_info)</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                exc_info = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">elif</span> headers_set:</span><br><span class="line">            <span class="keyword">raise</span> AssertionError(<span class="string">'Headers already set'</span>)</span><br><span class="line">        headers_set[:] = [status, response_headers]</span><br><span class="line">        <span class="keyword">return</span> write</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">execute</span><span class="params">(app)</span>:</span></span><br><span class="line">        application_iter = app(environ, start_response)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">for</span> data <span class="keyword">in</span> application_iter:</span><br><span class="line">                write(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> headers_sent:</span><br><span class="line">                write(<span class="string">b''</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">if</span> hasattr(application_iter, <span class="string">'close'</span>):</span><br><span class="line">                application_iter.close()</span><br><span class="line">            application_iter = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        execute(self.server.app)</span><br><span class="line">    <span class="keyword">except</span> (socket.error, socket.timeout) <span class="keyword">as</span> e:</span><br><span class="line">        self.connection_dropped(e, environ)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">if</span> self.server.passthrough_errors:</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">from</span> werkzeug.debug.tbtools <span class="keyword">import</span> get_current_traceback</span><br><span class="line">        traceback = get_current_traceback(ignore_system_exceptions=<span class="keyword">True</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># if we haven't yet sent the headers but they are set</span></span><br><span class="line">            <span class="comment"># we roll back to be able to set them again.</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> headers_sent:</span><br><span class="line">                <span class="keyword">del</span> headers_set[:]</span><br><span class="line">            execute(InternalServerError())</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        self.server.log(<span class="string">'error'</span>, <span class="string">'Error on request:\n%s'</span>,</span><br><span class="line">                        traceback.plaintext)</span><br></pre></td></tr></table></figure>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>《Python核心编程》</li>
<li><a href="https://docs.python.org/2/howto/webservers.html#step-back-wsgi" target="_blank" rel="noopener">https://docs.python.org/2/howto/webservers.html#step-back-wsgi</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WSGI/">WSGI</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-flask-signal"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/05/14/flask-signal/">Flask信号</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/05/14/flask-signal/" class="article-date">
	  <time datetime="2017-05-14T14:15:46.000Z" itemprop="datePublished">May 14, 2017</time>
	</a>





       
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Flask signals 默认没有自己实现signal，而是使用blink进行信号的定义，连接，分发。</p>
<h2 id="Flask-singal"><a href="#Flask-singal" class="headerlink" title="Flask singal"></a>Flask singal</h2><p>flask未实现自己信号处理,而是使用blink.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">signals_available = <span class="keyword">False</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> blinker <span class="keyword">import</span> Namespace</span><br><span class="line">    signals_available = <span class="keyword">True</span></span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Namespace</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">signal</span><span class="params">(self, name, doc=None)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> _FakeSignal(name, doc)</span><br></pre></td></tr></table></figure>
<p>flask 支持的信号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">_signals = Namespace()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Core signals.  For usage examples grep the source code or consult</span></span><br><span class="line"><span class="comment"># the API documentation in docs/api.rst as well as docs/signals.rst</span></span><br><span class="line">template_rendered = _signals.signal(<span class="string">'template-rendered'</span>)</span><br><span class="line">before_render_template = _signals.signal(<span class="string">'before-render-template'</span>)</span><br><span class="line">request_started = _signals.signal(<span class="string">'request-started'</span>)</span><br><span class="line">request_finished = _signals.signal(<span class="string">'request-finished'</span>)</span><br><span class="line">request_tearing_down = _signals.signal(<span class="string">'request-tearing-down'</span>)</span><br><span class="line">got_request_exception = _signals.signal(<span class="string">'got-request-exception'</span>)</span><br><span class="line">appcontext_tearing_down = _signals.signal(<span class="string">'appcontext-tearing-down'</span>)</span><br><span class="line">appcontext_pushed = _signals.signal(<span class="string">'appcontext-pushed'</span>)</span><br><span class="line">appcontext_popped = _signals.signal(<span class="string">'appcontext-popped'</span>)</span><br><span class="line">message_flashed = _signals.signal(<span class="string">'message-flashed'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Blinker-signal"><a href="#Blinker-signal" class="headerlink" title="Blinker signal"></a>Blinker signal</h2><p>blinker支持的特性:</p>
<ul>
<li>a global registry of named signals</li>
<li>anonymous signals</li>
<li>custom name registries</li>
<li>permanently or temporarily connected receivers</li>
<li>automically disconnected receivers via weak referencing</li>
<li>sending arbirary data payloads</li>
<li>collecting return values from signal receivers</li>
<li>thread safety</li>
</ul>
<h3 id="Blinker-signal-sample"><a href="#Blinker-signal-sample" class="headerlink" title="Blinker signal sample"></a>Blinker signal sample</h3><p>TODO</p>
<h3 id="Blinker-signal-realization"><a href="#Blinker-signal-realization" class="headerlink" title="Blinker signal realization"></a>Blinker signal realization</h3><p>TODO</p>
<p>注册</p>
<p>弱引用</p>
<p>线程安全</p>
<h2 id="Problems"><a href="#Problems" class="headerlink" title="Problems"></a>Problems</h2><p>connecter weak reference</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register_signal_handlers</span><span class="params">(app)</span>:</span></span><br><span class="line">   <span class="keyword">import</span> logging</span><br><span class="line">   <span class="keyword">from</span> flask.signals <span class="keyword">import</span> request_finished</span><br><span class="line">   _logger = logging.getLogger(<span class="string">'api.debug'</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">log_response</span><span class="params">(sender, response, **options)</span>:</span></span><br><span class="line">       print(response)</span><br><span class="line">   request_finished.connect(log_response, app)</span><br></pre></td></tr></table></figure>
<p>以上代码，不能按原意正确的运行。因为log_response是局部作用域函数，在函数调用完成后，该作用域会消失，因此不能正确的调用<code>log_response</code>函数。</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://pythonhosted.org/blinker/" target="_blank" rel="noopener">https://pythonhosted.org/blinker/</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flask/">Flask</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/6/">Next</a>
  </nav>


</section>
          <aside id="sidebar">
  
    <div style="margin: 20px 0;">
	<div id="search-form-wrap">

    <form class="search-form">
        <label style="width: 72%;">
            <span class="screen-reader-text">Search for:</span>
            <input type="search" class="search-field" style="height: 36px; width: 100%;" placeholder=" Search…" value="" name="s" title="Search for:">
        </label>
        <input type="submit" class="search-form-submit" value="Search">
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
</div>
  
    
  <div class="widget_athemes_tabs">
    <ul id="widget-tab" class="clearfix widget-tab-nav">
      <li class="active"><a>Recent Posts</a></li>
    </ul>
    <div class="widget">
      <ul>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2020/04/05/情人/" title=""><img width="50" height="50" src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1586112370221&amp;di=1fed964032065a894c260a59425553c6&amp;imgtype=0&amp;src=http%3A%2F%2Fn.sinaimg.cn%2Fsinacn%2Fw800h400%2F20180313%2Ff3e2-fyscsmu9593150.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2020/04/05/情人/">情人</a></h6>
              <span>April 5, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2020/03/04/真名实姓/" title=""><img width="50" height="50" src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1583314207901&amp;di=32e739af2edb26a1c7a3f563773c2f9d&amp;imgtype=0&amp;src=http%3A%2F%2Fresource.feng.com%2Fresource%2Fh040%2Fh89%2Fimg201409291312340.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2020/03/04/真名实姓/">真名实姓</a></h6>
              <span>March 4, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2020/02/13/谈话录/" title=""><img width="50" height="50" src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1581533915677&amp;di=7162c767499b5ff99e3031a1c678fc36&amp;imgtype=0&amp;src=http%3A%2F%2Fgov.eastday.com%2Fimages%2Fthumbnailimg%2Fmonth_1812%2F201812181158261846.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2020/02/13/谈话录/">谈话录</a></h6>
              <span>February 13, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2020/02/02/从疫情想到的/" title=""><img width="50" height="50" src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1580634816484&amp;di=dc5986420e23abbab9ca863d503797c8&amp;imgtype=0&amp;src=http%3A%2F%2Fcrawl.ws.126.net%2F91b2448d6ffc26e8333162d40e21576e.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2020/02/02/从疫情想到的/">从疫情想到的</a></h6>
              <span>February 2, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2020/01/30/关于学习的一点想法/" title=""><img width="50" height="50" src="http://edu_img.bs2.100.com/33ea56264756f3b759844ce.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2020/01/30/关于学习的一点想法/">关于学习的一点想法</a></h6>
              <span>January 30, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2020/01/30/隆美尔战时文件/" title=""><img width="50" height="50" src="https://dingyue.ws.126.net/Ulf=Y0IDcGJb2RiNF7OAsK7VV8EkzWGWs40GSDnbGQ1Bs1449640368296compressflag.png" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2020/01/30/隆美尔战时文件/">隆美尔战时文件</a></h6>
              <span>January 30, 2020</span>
            </div>

          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>

    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">9</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/12306/" style="font-size: 10px;">12306</a> <a href="/tags/Debian/" style="font-size: 10px;">Debian</a> <a href="/tags/Decorator/" style="font-size: 10px;">Decorator</a> <a href="/tags/Django/" style="font-size: 16px;">Django</a> <a href="/tags/Flask/" style="font-size: 10px;">Flask</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Gitlab/" style="font-size: 10px;">Gitlab</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hacker/" style="font-size: 10px;">Hacker</a> <a href="/tags/Jekins/" style="font-size: 10px;">Jekins</a> <a href="/tags/Lisp/" style="font-size: 10px;">Lisp</a> <a href="/tags/MacOS/" style="font-size: 10px;">MacOS</a> <a href="/tags/McFarland/" style="font-size: 10px;">McFarland</a> <a href="/tags/Nginx/" style="font-size: 12px;">Nginx</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/OAuth/" style="font-size: 10px;">OAuth</a> <a href="/tags/PEP/" style="font-size: 10px;">PEP</a> <a href="/tags/PyPI/" style="font-size: 10px;">PyPI</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/RSS/" style="font-size: 10px;">RSS</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/WSGI/" style="font-size: 10px;">WSGI</a> <a href="/tags/万历十五年/" style="font-size: 10px;">万历十五年</a> <a href="/tags/三体/" style="font-size: 12px;">三体</a> <a href="/tags/三体2/" style="font-size: 10px;">三体2</a> <a href="/tags/二战/" style="font-size: 12px;">二战</a> <a href="/tags/人工智能/" style="font-size: 10px;">人工智能</a> <a href="/tags/任泽平/" style="font-size: 10px;">任泽平</a> <a href="/tags/八达岭长城/" style="font-size: 10px;">八达岭长城</a> <a href="/tags/凯恩斯主义/" style="font-size: 10px;">凯恩斯主义</a> <a href="/tags/刘慈欣/" style="font-size: 14px;">刘慈欣</a> <a href="/tags/区块链/" style="font-size: 10px;">区块链</a> <a href="/tags/华为/" style="font-size: 10px;">华为</a> <a href="/tags/原则/" style="font-size: 10px;">原则</a> <a href="/tags/古德里安/" style="font-size: 10px;">古德里安</a> <a href="/tags/奈飞/" style="font-size: 10px;">奈飞</a> <a href="/tags/学习/" style="font-size: 10px;">学习</a> <a href="/tags/微软/" style="font-size: 10px;">微软</a> <a href="/tags/情人/" style="font-size: 10px;">情人</a> <a href="/tags/战争/" style="font-size: 12px;">战争</a> <a href="/tags/房地产/" style="font-size: 10px;">房地产</a> <a href="/tags/抢票/" style="font-size: 10px;">抢票</a> <a href="/tags/文化/" style="font-size: 10px;">文化</a> <a href="/tags/旅行/" style="font-size: 12px;">旅行</a> <a href="/tags/朱镕基/" style="font-size: 10px;">朱镕基</a> <a href="/tags/机器学习/" style="font-size: 10px;">机器学习</a> <a href="/tags/村上春树/" style="font-size: 10px;">村上春树</a> <a href="/tags/杜拉斯/" style="font-size: 10px;">杜拉斯</a> <a href="/tags/查理·芒格/" style="font-size: 10px;">查理·芒格</a> <a href="/tags/桥水/" style="font-size: 10px;">桥水</a> <a href="/tags/比特币/" style="font-size: 10px;">比特币</a> <a href="/tags/深度学习/" style="font-size: 10px;">深度学习</a> <a href="/tags/王安忆/" style="font-size: 10px;">王安忆</a> <a href="/tags/电影/" style="font-size: 10px;">电影</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/索罗斯/" style="font-size: 10px;">索罗斯</a> <a href="/tags/经济学/" style="font-size: 10px;">经济学</a> <a href="/tags/缓存/" style="font-size: 10px;">缓存</a> <a href="/tags/腾讯/" style="font-size: 12px;">腾讯</a> <a href="/tags/萨提亚·纳德拉/" style="font-size: 10px;">萨提亚·纳德拉</a> <a href="/tags/读书/" style="font-size: 18px;">读书</a> <a href="/tags/跑步/" style="font-size: 12px;">跑步</a> <a href="/tags/邓小平/" style="font-size: 10px;">邓小平</a> <a href="/tags/金融/" style="font-size: 10px;">金融</a> <a href="/tags/隆美尔，战争/" style="font-size: 10px;">隆美尔，战争</a> <a href="/tags/马化腾/" style="font-size: 10px;">马化腾</a> <a href="/tags/黄仁宇/" style="font-size: 10px;">黄仁宇</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/12306/">12306</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian/">Debian</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Decorator/">Decorator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask/">Flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitlab/">Gitlab</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hacker/">Hacker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jekins/">Jekins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lisp/">Lisp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MacOS/">MacOS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/McFarland/">McFarland</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/">Node.js</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth/">OAuth</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PEP/">PEP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PyPI/">PyPI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RSS/">RSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WSGI/">WSGI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/万历十五年/">万历十五年</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/三体/">三体</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/三体2/">三体2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/二战/">二战</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/人工智能/">人工智能</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/任泽平/">任泽平</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/八达岭长城/">八达岭长城</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/凯恩斯主义/">凯恩斯主义</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/刘慈欣/">刘慈欣</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/区块链/">区块链</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/华为/">华为</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/原则/">原则</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/古德里安/">古德里安</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/奈飞/">奈飞</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习/">学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微软/">微软</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/情人/">情人</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/战争/">战争</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/房地产/">房地产</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/抢票/">抢票</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文化/">文化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/旅行/">旅行</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/朱镕基/">朱镕基</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/村上春树/">村上春树</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杜拉斯/">杜拉斯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/查理·芒格/">查理·芒格</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/桥水/">桥水</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/比特币/">比特币</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深度学习/">深度学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/王安忆/">王安忆</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电影/">电影</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/索罗斯/">索罗斯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/经济学/">经济学</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/缓存/">缓存</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/腾讯/">腾讯</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/萨提亚·纳德拉/">萨提亚·纳德拉</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书/">读书</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/跑步/">跑步</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/邓小平/">邓小平</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/金融/">金融</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/隆美尔，战争/">隆美尔，战争</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/马化腾/">马化腾</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/黄仁宇/">黄仁宇</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2020 Mengyy&#39;s Blog All Rights Reserved.
         
      </div>

	
	        <!-- 不蒜子统计 -->
	        <span id="busuanzi_container_site_pv">
	                本站总访问量<span id="busuanzi_value_site_pv"></span>次
	        </span>
	        <span class="post-meta-divider">|</span>
	        <span id="busuanzi_container_site_uv" style='display:none'>
	                本站访客数<span id="busuanzi_value_site_uv"></span>人
	        </span>
	        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	  

      <div class="site-credit">
        <!--
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
        -->
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
    
</script>

    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>










	<script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?{{ theme.baidu_analytics }}";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
