<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Mengyy&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta name="keywords" content="Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Mengyy&#39;s Blog">
<meta property="og:url" content="http://mengyangyang.org/page/6/index.html">
<meta property="og:site_name" content="Mengyy&#39;s Blog">
<meta property="og:locale" content="en_US.UTF-8">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mengyy&#39;s Blog">
  
    <link rel="alternate" href="/atom.xml" title="Mengyy&#39;s Blog" type="application/atom+xml">
  
  <link rel="icon" href="/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/fashion.css">
  <link rel="stylesheet" href="/css/glyphs.css">

</head>
</html>


  <body>


  


<header id="allheader" class="site-header" role="banner" 
   >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="Mengyy&#39;s Blog" rel="home"> Mengyy&#39;s Blog </a>
            
          </h1>
          
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">

  
    <article id="post-django-cache"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/06/django-cache/">Django缓存</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/06/django-cache/" class="article-date">
	  <time datetime="2017-04-06T14:04:15.000Z" itemprop="datePublished">April 6, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>每次用户请求一个页面，Web服务器都要进行很多计算，查询数据库，合成模板，处理业务逻辑等，再将页面返回给用户．后续的相同资源的请求，服务器都需要重复这些计算．</p>
<p>django提供了缓存机制，每次将资源的响应的副本存储指定的位置，下次用户再发起相同的请求时，服务器不再需要进行类似的计算，直接将上次响应的副本返回给用户．这样既减少服务器的负载，又降低用户的请求时延，提高了用户体验．</p>
<h2 id="HTTP缓存介绍"><a href="#HTTP缓存介绍" class="headerlink" title="HTTP缓存介绍"></a>HTTP缓存介绍</h2><p>TODO</p>
<h2 id="缓存框架"><a href="#缓存框架" class="headerlink" title="缓存框架"></a>缓存框架</h2><p>缓存是django的一个核心组件，提供缓存服务。</p>
<h3 id="缓存实现"><a href="#缓存实现" class="headerlink" title="缓存实现"></a>缓存实现</h3><p><a href="https://github.com/hotbaby/cache/blob/master/django_cache/resources/django-cache.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/hotbaby/cache/blob/master/django_cache/resources/django-cache.png?raw=true" alt="img"></a></p>
<p><strong>config cache</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">settings.CACHES = &#123;</span><br><span class="line">    &apos;default&apos;: &#123;  </span><br><span class="line">        &apos;BACKEND&apos;:&apos;django.core.cache.backends.memcached.MemcachedCache&apos;,</span><br><span class="line">        &apos;LOCATION&apos;: &apos;127.0.0.1:11211&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以memcached为例介绍缓存的配置，<code>BACKEND</code>是缓存实例实现类，<code>LOCATION</code>是缓存实例的位置．</p>
<h4 id="CacheHandler"><a href="#CacheHandler" class="headerlink" title="CacheHandler"></a>CacheHandler</h4><p><code>CacheHandler</code>管理缓存实例的访问。</p>
<p>实现原理： 根据<code>settings.CACHES</code>中配置（运行时）创建缓存实例，重载<code>__getitem__</code>特殊方法管理缓存实例的访问，通过线程局部变量<code>thread.local()</code>保证对于<code>settings.CACHES</code>中每个缓存在每个线程中只有一个实例．</p>
<p><code>django.core.cache.caches</code> 是<code>CacheHandler</code>的一个实例，<code>django.core.cache.cache</code>是<code>caches[&#39;default&#39;]</code>的代理．</p>
<h4 id="缓存backends"><a href="#缓存backends" class="headerlink" title="缓存backends"></a>缓存backends</h4><p>采用模板方法的设计模式，通过抽象基类<code>BaseCache</code>声明了一套缓存操作接口，而将接口实现延迟到具体的子类中。如图所示：<br><a href="https://github.com/hotbaby/cache/blob/master/django_cache/resources/django-cache-backends.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/hotbaby/cache/blob/master/django_cache/resources/django-cache-backends.png?raw=true" alt="img"></a></p>
<p><code>BaseCache</code> 是一个抽象类，定义了缓存通用的操作接口和参数默认值．</p>
<p>其中重要的参数：</p>
<ul>
<li><code>key</code> 生成机制</li>
<li><code>timeout</code> 超时时间</li>
<li><code>max_entries</code> 最大条目数</li>
<li><code>cull_frequency</code> 更新频率</li>
</ul>
<p><code>MemcachedCache</code>实现抽象类中声明的接口，通过<code>_cache</code>实现数据的设置和获取操作．</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_cache</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Implements transparent thread-safe access to a memcached client.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> getattr(self, <span class="string">'_client'</span>, <span class="keyword">None</span>) <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        self._client = self._lib.Client(self._servers)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> self._client</span><br></pre></td></tr></table></figure>
<p><code>LocMemCache</code>实现了线程安全本地内存缓存．</p>
<p>实现原理：<code>_cache</code>一个字典对象用于缓存内存对象，<code>_expire_info</code>一个字典对象用于缓存内存对象的过期时间，<code>_lock</code>是django内部实现一个读写锁保证线程安全．在存储和获取内存对象时，通过<code>pickle</code>进行对象的序列化和反序列化．</p>
<p><code>FileBasedCache</code>实现了基于文件的缓存机制．</p>
<p>实现原理： 缓存对象，将过期时间和内存对象通过<code>pickle</code>序列化后写入本地文件系统．获取对象，检查是否需要删除就的对象，反序列化，检查是否过期，返回对象．</p>
<h3 id="缓存中间件"><a href="#缓存中间件" class="headerlink" title="缓存中间件"></a>缓存中间件</h3><p>如果使能缓存中间件，每个django的页面都会被缓存．</p>
<p>缓存中间件的工作原理（参考实现代码）：</p>
<ul>
<li>只有状态码为200的，方法为HEAD,GET请求的响应被缓存</li>
<li>检测缓存中是否已缓存该请求的响应对象</li>
<li>如果命中，返回原始响应对象的一个浅拷贝（shallow copy）</li>
<li>如果未命中，继续处理view函数</li>
<li>根据请求的header决定是否需要缓存</li>
<li>设置响应的ETag, Last-Modified, Expires, Cache-Control HTTP header.</li>
</ul>
<p>配置缓存中间件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">settings.MIDDLEWARE = [</span><br><span class="line">    &apos;django.middleware.cache.UpdateCacheMiddleware&apos;,</span><br><span class="line">    ...</span><br><span class="line">    &apos;django.middleware.cache.FetchFromCacheMiddleware&apos;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<p>在response阶段，中间件的处理顺序是bottom-top, <code>UPdateCacheMiddleware</code>必须最后被执行，因此放在靠前的位置．在request阶段，中间件的处理顺序是top-bottom, <code>FetchFromCacheMiddleware</code>必须最后被执行，因此放在靠后的位置．<br><a href="https://github.com/hotbaby/cache/blob/master/django_cache/resources/django-middleware-ordering.png?raw=true" target="_blank" rel="noopener"><img src="https://github.com/hotbaby/cache/blob/master/django_cache/resources/django-middleware-ordering.png?raw=true" alt="img"></a></p>
<h4 id="FetchFromCacheMiddleware"><a href="#FetchFromCacheMiddleware" class="headerlink" title="FetchFromCacheMiddleware"></a><code>FetchFromCacheMiddleware</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">      <span class="string">"""</span></span><br><span class="line"><span class="string">      Checks whether the page is already cached and returns the cached</span></span><br><span class="line"><span class="string">      version if available.</span></span><br><span class="line"><span class="string">      """</span></span><br><span class="line">        <span class="comment"># 只缓存HEAD, GET的请求</span></span><br><span class="line">        <span class="keyword">if</span> request.method <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">'GET'</span>, <span class="string">'HEAD'</span>):</span><br><span class="line">          request._cache_update_cache = <span class="keyword">False</span></span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">None</span>  <span class="comment"># Don't bother checking the cache.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取GET方法的cache_key,如果不存在，则设置_cache_update_cache标志位为True，需要更新缓存</span></span><br><span class="line">        <span class="comment"># try and get the cached GET response</span></span><br><span class="line">      cache_key = get_cache_key(request, self.key_prefix, <span class="string">'GET'</span>, cache=self.cache)</span><br><span class="line">      <span class="keyword">if</span> cache_key <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">          request._cache_update_cache = <span class="keyword">True</span></span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">None</span>  <span class="comment"># No cache information available, need to rebuild.</span></span><br><span class="line">      response = self.cache.get(cache_key)</span><br><span class="line">        <span class="comment"># 如果cache为命中，而且请求的方法为HEAD,则获取请求方法为HEAD的cache_key</span></span><br><span class="line">        <span class="comment"># if it wasn't found and we are looking for a HEAD, try looking just for that</span></span><br><span class="line">      <span class="keyword">if</span> response <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">and</span> request.method == <span class="string">'HEAD'</span>:</span><br><span class="line">          cache_key = get_cache_key(request, self.key_prefix, <span class="string">'HEAD'</span>, cache=self.cache)</span><br><span class="line">          response = self.cache.get(cache_key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存都未命中，设置_cache_update_cache标志位为True,调用view函数，并更新缓存</span></span><br><span class="line">        <span class="keyword">if</span> response <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">          request._cache_update_cache = <span class="keyword">True</span></span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">None</span>  <span class="comment"># No cache information available, need to rebuild.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存命中，设置_cache_update_cahe标志为False, 不调用view函数，不更新缓存</span></span><br><span class="line">        <span class="comment"># hit, return cached response</span></span><br><span class="line">      request._cache_update_cache = <span class="keyword">False</span></span><br><span class="line">      <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h4 id="UpdateCacheMiddleware"><a href="#UpdateCacheMiddleware" class="headerlink" title="UpdateCacheMiddleware"></a><code>UpdateCacheMiddleware</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_should_update_cache</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">      <span class="keyword">return</span> hasattr(request, <span class="string">'_cache_update_cache'</span>) <span class="keyword">and</span> request._cache_update_cache</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">      <span class="string">"""Sets the cache, if needed."""</span></span><br><span class="line">        <span class="comment"># 不缓存，直接返回Response</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._should_update_cache(request, response):</span><br><span class="line">          <span class="comment"># We don't need to update the cache, just return.</span></span><br><span class="line">          <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是流数据或状态码不为200, 不缓存</span></span><br><span class="line">        <span class="keyword">if</span> response.streaming <span class="keyword">or</span> response.status_code != <span class="number">200</span>:</span><br><span class="line">          <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是私有数据，不缓存</span></span><br><span class="line">        <span class="comment"># Don't cache responses that set a user-specific (and maybe security</span></span><br><span class="line">      <span class="comment"># sensitive) cookie in response to a cookie-less request.</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> request.COOKIES <span class="keyword">and</span> response.cookies <span class="keyword">and</span> has_vary_header(response, <span class="string">'Cookie'</span>):</span><br><span class="line">          <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Try to get the timeout from the "max-age" section of the "Cache-</span></span><br><span class="line">      <span class="comment"># Control" header before reverting to using the default cache_timeout</span></span><br><span class="line">      <span class="comment"># length.</span></span><br><span class="line">      timeout = get_max_age(response)</span><br><span class="line">      <span class="keyword">if</span> timeout <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">          timeout = self.cache_timeout</span><br><span class="line">      <span class="keyword">elif</span> timeout == <span class="number">0</span>:</span><br><span class="line">          <span class="comment"># max-age was set to 0, don't bother caching.</span></span><br><span class="line">          <span class="keyword">return</span> response</span><br><span class="line">      </span><br><span class="line">        <span class="comment"># 设置缓存的HTTP头部信息</span></span><br><span class="line">        patch_response_headers(response, timeout)</span><br><span class="line">        <span class="comment"># 缓存响应</span></span><br><span class="line">        <span class="keyword">if</span> timeout:</span><br><span class="line">          cache_key = learn_cache_key(request, response, timeout, self.key_prefix, cache=self.cache)</span><br><span class="line">          <span class="keyword">if</span> hasattr(response, <span class="string">'render'</span>) <span class="keyword">and</span> callable(response.render):</span><br><span class="line">              response.add_post_render_callback(</span><br><span class="line">                  <span class="keyword">lambda</span> r: self.cache.set(cache_key, r, timeout)</span><br><span class="line">              )</span><br><span class="line">          <span class="keyword">else</span>:</span><br><span class="line">              self.cache.set(cache_key, response, timeout)</span><br><span class="line">      <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h3 id="缓存装饰器"><a href="#缓存装饰器" class="headerlink" title="缓存装饰器"></a>缓存装饰器</h3><p>缓存装饰器用于控制view是否缓存.</p>
<h4 id="nerver-cache"><a href="#nerver-cache" class="headerlink" title="nerver_cache"></a>nerver_cache</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">never_cache</span><span class="params">(view_func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(view_func, assigned=available_attrs(view_func))</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_wrapped_view_func</span><span class="params">(request, *args, **kwargs)</span>:</span></span><br><span class="line">        response = view_func(request, *args, **kwargs)</span><br><span class="line">        add_never_cache_headers(response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">return</span> _wrapped_view_func</span><br></pre></td></tr></table></figure>
<p>view装饰器，在view函数处理完成后，patch缓存相关的HTTP头，控制该相应不被缓存。</p>
<p>相关的HTTP headers:</p>
<ul>
<li>Last-Modifed: current_datetime</li>
<li>Expires: current_datetime</li>
<li>Cache-Control: max-age=0</li>
</ul>
<h4 id="cache-control"><a href="#cache-control" class="headerlink" title="cache_control"></a>cache_control</h4><p>view装饰器，在view函数处理完成后，patch<code>Cache-Control</code>HTTP头。</p>
<h4 id="cache-page"><a href="#cache-page" class="headerlink" title="cache_page"></a>cache_page</h4><p>view装饰器，用于缓存页面。该装饰器是对cache中间件<code>CacheMiddleware</code>的封装。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://docs.djangoproject.com/en/1.11/topics/cache/#the-low-level-cache-api" target="_blank" rel="noopener">django’s cache framework</a></li>
<li><a href="http://django-redis-chs.readthedocs.io/zh_CN/latest/" target="_blank" rel="noopener">django redis</a></li>
<li><a href="https://tools.ietf.org/html/rfc7234" target="_blank" rel="noopener">rfc7234 Hypertext Transfer Protocol (HTTP/1.1): Caching</a></li>
<li><a href="http://blog.mengyangyang.org/2017/04/06/djaong-cache/HTTP%20Cache-Control%20Extensions%20for%20Stale%20Content" target="_blank" rel="noopener">rfc5861 HTTP Cache-Control Extensions for Stale Content</a></li>
<li><a href="https://github.com/django/django/tree/master/django/core/cache" target="_blank" rel="noopener">django core cache code</a></li>
<li><a href="https://docs.python.org/2/library/pickle.html" target="_blank" rel="noopener">python pickle library</a></li>
<li><a href="https://docs.python.org/2/library/threading.html#threading.local" target="_blank" rel="noopener">python threading.local</a></li>
<li><a href="https://docs.djangoproject.com/en/1.10/ref/middleware/#middleware-ordering" target="_blank" rel="noopener">django middleware ordering</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/">Django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/缓存/">缓存</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-腾讯传"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/05/腾讯传/">腾讯传</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/05/腾讯传/" class="article-date">
	  <time datetime="2017-04-04T16:00:00.000Z" itemprop="datePublished">April 5, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>吴晓波以平铺直叙的方式描述腾讯的发展史，从OICQ到QQ、QQ秀、QQ空间、QQ秀、QQ浏览器、QQ支付、腾讯网、腾讯文学、腾讯影业再到大微信生态。在互联网大发展的过程中，腾讯没有错过任何一场互联网盛宴， 除了搜索、电商领域没有什么大的作为，其他的领域都是攻城略地，鲜有敌手。腾讯只用了18年就做到了市值亚洲第一（总市值19826.40亿）。</p>
<p>读者（也就是我）并不打算描述（也表述不好）腾讯战略思维（马化腾说：腾讯只做两件事，连接和内容，就这么简单），只是从一个程序狗的角度思考一下腾讯的产品思维。</p>
<p>在读《腾讯传》之前，想的都是如何从技术上（准确的说是理论上）进行突破，占领技术制高点，高举高打。比如百度拥有搜索引擎的核心技术和专利，开拓了国内80%以上的搜索份额，实现了自己的价值。读《腾讯传》之后，才幡然醒悟，现在互联网已经由<strong>“技术驱动”向“应用驱动”再向“服务和用户驱动”的目标转变</strong>。</p>
<p><strong>“每个功能不一定要用得多才是好，而是用了的人都觉得好才是真正的好。”</strong>就像一位朋友曾经说的那样，腾讯的产品每个功能都不是最完美，但整体用起来都那么很舒服。</p>
<p><strong>“小步快跑，快速迭代”</strong>，也许每一次产品的更新都是不完美的，但是如果坚持每天发现、修正一两个小问题，不到一年基本就把作品打磨出来，自己也就有产品的感觉了。</p>
<p>作为一名程序狗，追求技术是我们的天性，但不要把“这个没有技术含量，那个没有技术含量”挂在嘴边，要从用户的角度去考虑如何做一个好的产品，而不是堆砌一大堆高大上的技术，最后用户不买单。要从“技术思维”向“技术+产品思维”转变。</p>
<p>附：<a href="https://bitbucket.org/hotbaby/clippings/src/bee2f5216c3794e72e025a8cdf41cd6653f8675d/clippings_%E8%85%BE%E8%AE%AF%E4%BC%A0.md?at=master&amp;fileviewer=file-view-default" target="_blank" rel="noopener">《腾讯传》标注</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/腾讯/">腾讯</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书/">读书</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-rss-feed"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/01/rss-feed/">RSS Feed</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/01/rss-feed/" class="article-date">
	  <time datetime="2017-04-01T14:02:58.000Z" itemprop="datePublished">April 1, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>优秀的RSS feed订阅源，其中包括大数据，Python，跑步，新闻等。</p>
<p>feed 列表：</p>
<ul>
<li><a href="http://feeds.feedburner.com/ProgrammableWeb" target="_blank" rel="noopener">ProgrammableWeb</a></li>
<li><a href="http://www.douban.com/feed/group/python/discussion" target="_blank" rel="noopener">豆瓣：Python编程小组</a></li>
<li><a href="http://www.runningshoesguru.com/feed/" target="_blank" rel="noopener">Running Shoes</a></li>
<li><a href="http://www.36dsj.com/feed" target="_blank" rel="noopener">36大数据</a></li>
<li><a href="http://dataunion.org/feed" target="_blank" rel="noopener">数盟社区</a></li>
<li><a href="http://news.ycombinator.com/rss" target="_blank" rel="noopener">Hack News</a></li>
<li><a href="http://feeds.appinn.com/appinns/" target="_blank" rel="noopener">小众软件</a></li>
<li><a href="https://www.elastic.co/blog/feed/" target="_blank" rel="noopener">elasticsearch</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RSS/">RSS</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-django-debug"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/03/30/django-debug/">Django调试</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/03/30/django-debug/" class="article-date">
	  <time datetime="2017-03-30T14:01:27.000Z" itemprop="datePublished">March 30, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>django默认情况会将所有的错误信息以HTML形式返回给前端，这样导致在运行nose的单元测试用例出现错误时，无法看到详细的错误栈帧信息，给程序的debug带来一定的困扰。</p>
<p>如何debug django异常栈帧？</p>
<p>方法一:</p>
<p>配置<code>settings.py</code>,将django的所有的debug信息，错误栈帧信息输出到终端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">'version'</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">'disable_existing_loggers'</span>: <span class="keyword">False</span>,</span><br><span class="line">    <span class="string">'handlers'</span>: &#123;</span><br><span class="line">        <span class="string">'console'</span>: &#123;</span><br><span class="line">            <span class="string">'class'</span>: <span class="string">'logging.StreamHandler'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'loggers'</span>: &#123;</span><br><span class="line">        <span class="string">'django'</span>: &#123;</span><br><span class="line">            <span class="string">'handlers'</span>: [<span class="string">'console'</span>],</span><br><span class="line">            <span class="string">'level'</span>: os.getenv(<span class="string">'DJANGO_LOG_LEVEL'</span>, <span class="string">'INFO'</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>连接信号<code>got_request_exception</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.signals <span class="keyword">import</span> got_request_exception</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exc_cb</span><span class="params">(sender, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> traceback</span><br><span class="line">    traceback.print_exc()</span><br><span class="line"></span><br><span class="line">got_request_exception.connect(exc_cb)</span><br></pre></td></tr></table></figure>
<p>方法二： 通过middleware，在<code>process_exception</code>中增加exception的调试信息，并将此middleware增加到<code>settings.py</code>的<code>MIDDLEWARE_CLASSES</code>中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LogMiddleware</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception)</span>:</span></span><br><span class="line">        traceback.print_exc()</span><br></pre></td></tr></table></figure>
<p><strong>注: 在中间件process_exception方法中打印异常栈帧，只能debug view函数的异常。 如果异常发生在中间件中，无法打印异常信息。</strong></p>
<p><strong>参考</strong></p>
<ul>
<li><a href="https://docs.djangoproject.com/en/1.11/topics/logging/" target="_blank" rel="noopener">django logging</a></li>
<li><a href="https://docs.djangoproject.com/en/1.11/topics/signals/" target="_blank" rel="noopener">django signals</a></li>
<li><a href="https://docs.python.org/2/library/logging.html" target="_blank" rel="noopener">logging</a></li>
<li><a href="https://docs.python.org/2/library/logging.config.html" target="_blank" rel="noopener">logging.config</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/">Django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-django-middleware"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/03/30/django-middleware/">Django中间件</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/03/30/django-middleware/" class="article-date">
	  <time datetime="2017-03-30T13:59:10.000Z" itemprop="datePublished">March 30, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>中间件是django处理request/response钩子的框架。它是一个用来修改输入、输出的轻量级的插件系统。 从另外角度上讲，中间件也是一种特殊的“装饰器”，装饰所有的视图函数。</p>
<h2 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h2><p>django中间件新版本与旧版本不兼容， 本文档是基于django 1.10编写。</p>
<p><strong>新版本中间件</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewMiddlewareCls</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, get_response)</span>:</span></span><br><span class="line">        self.get_response = get_response</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        response = self.get_response(request)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<p><strong>旧版本中间件</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OldMiddlewarCls</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span> <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h2 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h2><h3 id="中间件示例"><a href="#中间件示例" class="headerlink" title="中间件示例"></a>中间件示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.depreaction <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleMiddleware</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_exceptions</span><span class="params">(self, request, exception)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span> <span class="comment"># or return HttpResponse()</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h3 id="加载中间件"><a href="#加载中间件" class="headerlink" title="加载中间件"></a>加载中间件</h3><p><code>WSGIHandler</code>在初始化时加载中配置文件中的中间件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseHandler</span><span class="params">(object)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_middleware</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> settings.MIDDLEWARE <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            handler = convert_exception_to_response(self._get_response)</span><br><span class="line">            <span class="keyword">for</span> middleware_path <span class="keyword">in</span> reversed(settings.MIDDLEWARE):</span><br><span class="line">                middleware = import_string(middleware_path)</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    mw_instance = middleware(handler)</span><br><span class="line">                <span class="keyword">except</span> MiddlewareNotUsed <span class="keyword">as</span> exc:</span><br><span class="line">                    <span class="keyword">if</span> settings.DEBUG:</span><br><span class="line">                        <span class="keyword">if</span> six.text_type(exc):</span><br><span class="line">                            logger.debug(<span class="string">'MiddlewareNotUsed(%r): %s'</span>, middleware_path, exc)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            logger.debug(<span class="string">'MiddlewareNotUsed: %r'</span>, middleware_path)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> mw_instance <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">                    <span class="keyword">raise</span> ImproperlyConfigured(</span><br><span class="line">                        <span class="string">'Middleware factory %s returned None.'</span> % middleware_path</span><br><span class="line">                    )</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_view'</span>):</span><br><span class="line">                    self._view_middleware.insert(<span class="number">0</span>, mw_instance.process_view)</span><br><span class="line">                <span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_template_response'</span>):</span><br><span class="line">                    self._template_response_middleware.append(mw_instance.process_template_response)</span><br><span class="line">                <span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_exception'</span>):</span><br><span class="line">                    self._exception_middleware.append(mw_instance.process_exception)</span><br><span class="line"></span><br><span class="line">                handler = convert_exception_to_response(mw_instance)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WSGIHandler</span><span class="params">(base.BaseHandler)</span>:</span></span><br><span class="line">    request_class = WSGIRequest</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        super(WSGIHandler, self).__init__(*args, **kwargs)</span><br><span class="line">        self.load_middleware()</span><br></pre></td></tr></table></figure>
<h3 id="运行中间件"><a href="#运行中间件" class="headerlink" title="运行中间件"></a>运行中间件</h3><p>收到客户端发起的一个请求，调用所有注册的中间件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WSGIHandler</span><span class="params">(base.BaseHandler)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, environ, start_response)</span>:</span></span><br><span class="line">        ...</span><br><span class="line">        response = self.get_response(request)</span><br><span class="line">        ...</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseHandler</span><span class="params">(object)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_response</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">"""Return an HttpResponse object for the given HttpRequest."""</span></span><br><span class="line">        <span class="comment"># Setup default url resolver for this thread</span></span><br><span class="line">        set_urlconf(settings.ROOT_URLCONF)</span><br><span class="line"></span><br><span class="line">        response = self._middleware_chain(request)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># This block is only needed for legacy MIDDLEWARE_CLASSES; if</span></span><br><span class="line">        <span class="comment"># MIDDLEWARE is used, self._response_middleware will be empty.</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># Apply response middleware, regardless of the response</span></span><br><span class="line">            <span class="keyword">for</span> middleware_method <span class="keyword">in</span> self._response_middleware:</span><br><span class="line">                response = middleware_method(request, response)</span><br><span class="line">                <span class="comment"># Complain if the response middleware returned None (a common error).</span></span><br><span class="line">                <span class="keyword">if</span> response <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">                    <span class="keyword">raise</span> ValueError(</span><br><span class="line">                        <span class="string">"%s.process_response didn't return an "</span></span><br><span class="line">                        <span class="string">"HttpResponse object. It returned None instead."</span></span><br><span class="line">                        % (middleware_method.__self__.__class__.__name__))</span><br><span class="line">        <span class="keyword">except</span> Exception:  <span class="comment"># Any exception should be gathered and handled</span></span><br><span class="line">            signals.got_request_exception.send(sender=self.__class__, request=request)</span><br><span class="line">            response = self.handle_uncaught_exception(request, get_resolver(get_urlconf()), sys.exc_info())</span><br><span class="line"></span><br><span class="line">        response._closable_objects.append(request)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If the exception handler returns a TemplateResponse that has not</span></span><br><span class="line">        <span class="comment"># been rendered, force it to be rendered.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> getattr(response, <span class="string">'is_rendered'</span>, <span class="keyword">True</span>) <span class="keyword">and</span> callable(getattr(response, <span class="string">'render'</span>, <span class="keyword">None</span>)):</span><br><span class="line">            response = response.render()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">404</span>:</span><br><span class="line">            logger.warning(</span><br><span class="line">                <span class="string">'Not Found: %s'</span>, request.path,</span><br><span class="line">                extra=&#123;<span class="string">'status_code'</span>: <span class="number">404</span>, <span class="string">'request'</span>: request&#125;,</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h3 id="中间件chain"><a href="#中间件chain" class="headerlink" title="中间件chain"></a>中间件chain</h3><p>所有的中间件通过<code>MiddlewareMixin</code>链接起来，形成<code>middleware_chain</code>,参考<em>设计模式 chain of responsibility职责链</em>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiddlewareMixin</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, get_response=None)</span>:</span></span><br><span class="line">        self.get_response = get_response</span><br><span class="line">        super(MiddlewareMixin, self).__init__()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        response = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(self, <span class="string">'process_request'</span>):</span><br><span class="line">            response = self.process_request(request)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">            response = self.get_response(request)</span><br><span class="line">        <span class="keyword">if</span> hasattr(self, <span class="string">'process_response'</span>):</span><br><span class="line">            response = self.process_response(request, response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<p>新版本middleware处理时序：</p>
<p><a href="http://blog.mengyangyang.org/images/pasted-1.png" target="_blank" rel="noopener"><img src="http://blog.mengyangyang.org/images/pasted-1.png" alt="img"></a></p>
<p>旧版版本middleware处理时序：<br><a href="https://docs.djangoproject.com/en/1.9/_images/middleware.svg" target="_blank" rel="noopener"><img src="https://docs.djangoproject.com/en/1.9/_images/middleware.svg" alt="img"></a></p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>如果<code>process_request</code>返回结果为不<code>None</code>, 则不再迭代调用下一个层中间件(或视图函数)。</p>
<p>中间件处理分为几个阶段：</p>
<ul>
<li>process_request</li>
<li>process_view</li>
<li>process_exception</li>
<li>process_template_response</li>
<li>process_exception</li>
<li>process_response</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://docs.djangoproject.com/en/1.10/topics/http/middleware/" target="_blank" rel="noopener">django middleware framework</a></li>
<li><a href="https://github.com/django/deps/blob/master/final/0005-improved-middleware.rst" target="_blank" rel="noopener">DEP5 improved middleware</a></li>
<li><em>设计模式-可复用面向对象基础</em></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/">Django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-functools"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/03/29/python-functools/">Python Functools</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/03/29/python-functools/" class="article-date">
	  <time datetime="2017-03-29T13:53:49.000Z" itemprop="datePublished">March 29, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="functools-wraps"><a href="#functools-wraps" class="headerlink" title="functools.wraps()"></a><code>functools.wraps()</code></h4><p><code>wraps(wrapped[,assigned][,updated])</code><br>常用装饰器函数中返回的<code>wrapper()</code>函数，解决了被装饰函数<strong>name</strong>、<strong>doc</strong>等签名丢失问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import functools</span><br><span class="line">&gt;&gt;&gt; def decorator(f):</span><br><span class="line">	@functools.wrap(f)</span><br><span class="line">	def wrapper(*args, **kwargs):</span><br><span class="line">		return f(*args, **kwargs)</span><br><span class="line">	return wrapper</span><br></pre></td></tr></table></figure>
<h4 id="functools-partial"><a href="#functools-partial" class="headerlink" title="functools.partial()"></a><code>functools.partial()</code></h4><p><code>partial(func[,*args][,**kwargs])</code><br>是一个装饰器函数，也是一个闭包，返回一个可调用对象，freeze一些参数。</p>
<p>实现原理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def partial(func, *args, **keywords):</span><br><span class="line">    def newfunc(*fargs, **fkeywords):</span><br><span class="line">        newkeywords = keywords.copy()</span><br><span class="line">        newkeywords.update(fkeywords)</span><br><span class="line">        return func(*(args + fargs), **newkeywords)</span><br><span class="line">    newfunc.func = func</span><br><span class="line">    newfunc.args = args</span><br><span class="line">    newfunc.keywords = keywords</span><br><span class="line">    return newfunc</span><br></pre></td></tr></table></figure>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://docs.python.org/2/library/functions.html" target="_blank" rel="noopener">https://docs.python.org/2/library/functions.html</a></li>
<li><a href="https://docs.python.org/2/library/functools.html" target="_blank" rel="noopener">https://docs.python.org/2/library/functools.html</a></li>
<li><a href="https://docs.python.org/2/library/itertools.html" target="_blank" rel="noopener">https://docs.python.org/2/library/itertools.html</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-decorator"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/03/28/python-decorator/">Python装饰器</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/03/28/python-decorator/" class="article-date">
	  <time datetime="2017-03-28T11:29:29.000Z" itemprop="datePublished">March 28, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>装饰器是一种设计模型（结构型模式），可以动态给一个对象添加一些额外的职责，而不用修改该对象的任何code。</p>
<p>比如，我们要给一个API增加权限认证，可以通过<code>auth_decorator()</code>装饰这个API，而不必修改每个API的代码；debug一个函数的耗时，可以实现一个<code>time_decorator()</code>装饰要这些函数，而不用修改这些函数的内部实现；给个<code>TextView()</code>增加滚动条的装饰器<code>ScrollDecorator()</code>；Flask使用<code>route()</code>装饰器进行路由的注册等等。</p>
<p>装饰器优点：</p>
<ul>
<li>比静态继承更灵活。与静态继承相比，装饰器可以灵活向对象添加额外的责任</li>
<li>避免在层次结构高层的类有特多的特征。 可以定义一个简单的类，通过装饰器给他逐渐添加功能。</li>
</ul>
<h2 id="基本装饰器"><a href="#基本装饰器" class="headerlink" title="基本装饰器"></a>基本装饰器</h2><p>Python从语法本身就支持装饰器，Python装饰器是一个可调用对象（比如，函数、类），接受一个函数对象作为输入，返回另外一个函数对象。</p>
<p>最简单的Python函数装饰器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(f)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">		print(<span class="string">'before call %s'</span> % f.__name__)</span><br><span class="line">		result = f(*args, **kwargs)</span><br><span class="line">		print(<span class="string">'after call %s'</span> % f.__name__)</span><br><span class="line">		<span class="keyword">return</span> result</span><br><span class="line">	<span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@decorator</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">	print(<span class="string">'call func'</span>)</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func()</span><br><span class="line">before call func</span><br><span class="line">call func</span><br><span class="line">after call func</span><br></pre></td></tr></table></figure>
<h3 id="函数装饰器"><a href="#函数装饰器" class="headerlink" title="函数装饰器"></a>函数装饰器</h3><p>函数装饰器，接受一个函数f作为输入，返回另外一个函数对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">function decorator</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_cost_decorator</span><span class="params">(f)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        rv = f(*args, **kwargs)</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        delta = end_time - start_time</span><br><span class="line">        print(<span class="string">'time cost: %ds'</span> %  delta)</span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@time_cost_decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sleep_10s_func</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sleep_10s_func()</span><br><span class="line">time cost: <span class="number">10</span>s</span><br></pre></td></tr></table></figure>
<p>使用类实现函数装饰器，在对象初始化时接受一个函数f作为输入，在模拟调用<code>__call__</code>特殊方法中调用f函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># class decorator</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeCostDecorator</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, f)</span>:</span></span><br><span class="line">        self._f = f</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        ret = self._f(*args, **kwargs)</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        delta = end_time - start_time</span><br><span class="line">        print(<span class="string">'time cost %ds'</span> % delta)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TimeCostDecorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sleep_5s_func</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h3 id="类装饰器"><a href="#类装饰器" class="headerlink" title="类装饰器"></a>类装饰器</h3><p>类装饰器的与函数装饰器语法非常类似。类装饰器接受cls作为输入，返回另外一个cls。</p>
<p>类装饰器可以用来管理管理类，类实例的创建。</p>
<p>函数实现类装饰器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">class_decorator</span><span class="params">(cls)</span>:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ClassWrapper</span><span class="params">(object)</span>:</span></span><br><span class="line">		<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">			self._ins = cls(*args, **kwargs)</span><br><span class="line">		<span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">			print(<span class="string">'call ClassWapper.__getattr__ func'</span>)</span><br><span class="line">			<span class="keyword">return</span> getattr(self._ins, name)</span><br><span class="line">	<span class="keyword">return</span> ClassWrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@class_decorator</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'call Foo.func'</span>)</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Foo().func()</span><br><span class="line">call ClassWapper.__getattr__ func</span><br><span class="line">call Foo.func</span><br></pre></td></tr></table></figure>
<p>类实现类装饰器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassDecorator</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, cls)</span>:</span></span><br><span class="line">		self._cls = cls</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">		self._ins = self._cls(*args, **kwargs)</span><br><span class="line">		<span class="keyword">return</span> self</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">		print(<span class="string">'call ClassDecorator.__getattr__'</span>)</span><br><span class="line">		<span class="keyword">return</span> getattr(self._ins, name)</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@ClassDecorator</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'call Foo.func func'</span>)</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Foo().func()</span><br><span class="line">call ClassDecorator.__getattr__</span><br><span class="line">call Foo.func func</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h2 id="装饰器进阶"><a href="#装饰器进阶" class="headerlink" title="装饰器进阶"></a>装饰器进阶</h2><h3 id="带参数装饰器"><a href="#带参数装饰器" class="headerlink" title="带参数装饰器"></a>带参数装饰器</h3><p>不仅被装饰的函数可以携带参数，装饰器函数也可以携带参数。</p>
<p>Decorator params imply three levels of callables: a callable to accept decorator arguments, which return a callable to serve a callable to serve as decorator, which return a callbale to handle calls to the origin function or class. Each of the three levels may be a function or class and may retain state in the form of scopes or class attributes.</p>
<p>函数实现的带参数的函数装饰器：</p>
<p>以最近写的权限验证为例，描述带参数的装饰器实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; def perm_required(perm, **options):</span><br><span class="line">	def decorator(f):</span><br><span class="line">		def wrapper(*args, **kwargs):</span><br><span class="line">			return f(*args, **kwargs)</span><br><span class="line">		return wrapper</span><br><span class="line">	return decoraor</span><br></pre></td></tr></table></figure>
<p>类实现的带参数的装饰器：</p>
<p>TODO</p>
<p>函数实现的带参数类装饰器：</p>
<p>TODO</p>
<p>类实现的带参数类装饰器：</p>
<p>TODO</p>
<h3 id="函数签名"><a href="#函数签名" class="headerlink" title="函数签名"></a>函数签名</h3><p><code>functools.wraps()</code> 保留被封装函数的签名，如<code>__module__</code>, <code>__name__</code>, <code>__doc__</code>等</p>
<p>以下函数装饰器，被装饰的函数的签名被覆盖</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(f)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> f(*args, **kwargs)</span><br><span class="line">	<span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@decorator</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span> <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.__name__</span><br><span class="line"><span class="string">'wrapper'</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>调用<code>functools.wraps()</code>之后</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(f)</span>:</span></span><br><span class="line"><span class="meta">	@functools.wraps(f)</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> f(*args, **kwargs)</span><br><span class="line">	<span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@decorator</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span> <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.__name__</span><br><span class="line"><span class="string">'func'</span></span><br></pre></td></tr></table></figure>
<p><code>wraps()</code>函数的定义</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WRAPPER_ASSIGNMENTS = (<span class="string">'__module__'</span>, <span class="string">'__name__'</span>, <span class="string">'__doc__'</span>)</span><br><span class="line">WRAPPER_UPDATES = (<span class="string">'__dict__'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wraps</span><span class="params">(wrapped, assign=WRAPPER_ASSIGNMENTS, updated=WRAPPER_UPDATES)</span>:</span><span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="嵌套装饰器"><a href="#嵌套装饰器" class="headerlink" title="嵌套装饰器"></a>嵌套装饰器</h3><p>有时一个装饰器不能满足需求，这时，我们可以添加多个装饰器(decorator nesting)。</p>
<p>以下两个装饰器函数分别实现如下功能，<code>scroll_decorator()</code>添加滚动条，<code>border_decorator()</code>添加边框</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">border_decorator</span><span class="params">(f)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">		print(<span class="string">'border wrapper'</span>)</span><br><span class="line">		<span class="keyword">return</span> f(*args, **kwargs)</span><br><span class="line">	<span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">scroll_decorator</span><span class="params">(f)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">		print(<span class="string">'scroll decorator'</span>)</span><br><span class="line">		<span class="keyword">return</span> f(*args, **kwargs)</span><br><span class="line">	<span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@border_decorator</span><br><span class="line"><span class="meta">@scroll_decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorated_func</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">	print(<span class="string">'call decorated func'</span>)</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>decorated_func()</span><br><span class="line">border wrapper</span><br><span class="line">scroll decorator</span><br><span class="line">call decorated func</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>以上装饰器从语法与以下等价</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">decorated_func</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">	print(<span class="string">'decorated func'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = border_decorator(scroll_decorator(decorated_func))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f()</span><br><span class="line">border wrapper</span><br><span class="line">scroll decorator</span><br><span class="line">decorated func</span><br></pre></td></tr></table></figure>
<h2 id="装饰器的其他特性"><a href="#装饰器的其他特性" class="headerlink" title="装饰器的其他特性"></a>装饰器的其他特性</h2><h3 id="装饰器与闭包"><a href="#装饰器与闭包" class="headerlink" title="装饰器与闭包"></a>装饰器与闭包</h3><p>TODO</p>
<h3 id="装饰器与描述符"><a href="#装饰器与描述符" class="headerlink" title="装饰器与描述符"></a>装饰器与描述符</h3><p>TODO</p>
<h2 id="装饰器使用场景"><a href="#装饰器使用场景" class="headerlink" title="装饰器使用场景"></a>装饰器使用场景</h2><h3 id="统计API的调用时间"><a href="#统计API的调用时间" class="headerlink" title="统计API的调用时间"></a>统计API的调用时间</h3><p>TODO</p>
<h3 id="单例设计模式"><a href="#单例设计模式" class="headerlink" title="单例设计模式"></a>单例设计模式</h3><p>TODO</p>
<h3 id="跟踪方法调用"><a href="#跟踪方法调用" class="headerlink" title="跟踪方法调用"></a>跟踪方法调用</h3><p>TODO</p>
<h3 id="其他用例"><a href="#其他用例" class="headerlink" title="其他用例"></a>其他用例</h3><ul>
<li>Flask 路由管理</li>
<li>Django model 事务管理</li>
<li>Tornado 异步框架</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://docs.python.org/2/library/functools.html#module-functools" target="_blank" rel="noopener">https://docs.python.org/2/library/functools.html#module-functools</a></li>
<li><a href="http://stackoverflow.com/questions/5929107/python-decorators-with-parameters" target="_blank" rel="noopener">http://stackoverflow.com/questions/5929107/python-decorators-with-parameters</a></li>
<li><em>Design Patterns - Elements of Resuable Object-Oriented Software</em></li>
<li><em>Learning Python 5th Edition</em></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Decorator/">Decorator</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-读书与不读书的区别"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/03/21/读书与不读书的区别/">读书与不读书的区别</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/03/21/读书与不读书的区别/" class="article-date">
	  <time datetime="2017-03-21T11:27:40.000Z" itemprop="datePublished">March 21, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>没有养成读书习惯的人，以时间和空间而言，是受他眼前的世界所禁锢的。</p>
<p>他的生活是机械化的，刻板的。他只是跟几个朋友和相识者接触谈话，他只看到周遭发生的事情。他在这个监狱里是逃不出去的。</p>
<p>可是当他拿起一本书的时候，他立刻走进一个不同的世界。如果是一本好书，他便立刻接触到世界上一个最健谈的人。</p>
<p>这个谈话者引导他前进，带他到一个不同的国度或不同的时代，或者对他发泄一些私人的悔恨，或者跟他讨论一些他从来不知道的学问或生活问题。</p>
<p>摘自:《林语堂： 读书人和不读书的人，最大的区别是什么》</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书/">读书</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python-pep"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/03/18/python-pep/">Python PEP</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/03/18/python-pep/" class="article-date">
	  <time datetime="2017-03-18T11:25:44.000Z" itemprop="datePublished">March 18, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>PEP是Python Enehencement Proposal的缩写．每篇PEP都是一个设计文档，或者描述Python社区信息，或者描述Python的新特性等．PEP提供了特性的技术规范和这个特性的来源.</p>
<p>Python常见的PEP，比如PEP8 Python代码风格指南、PEP333 Python Web服务网关接口（WSGI）、PEP20 Python之禅、PEP248 Python 数据库接口规范等。</p>
<ul>
<li><a href="https://www.python.org/dev/peps/pep-0008/" target="_blank" rel="noopener">PEP8 Python代码风格指南</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0333/" target="_blank" rel="noopener">PEP333 Python Web服务网关接口 v1.0</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0020/" target="_blank" rel="noopener">PEP20 Python之禅</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0248/" target="_blank" rel="noopener">PEP248 Python数据库接口规范 v1.0</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0249/" target="_blank" rel="noopener">PEP249 Python数据库接口规范 v2.0</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0234/" target="_blank" rel="noopener">PEP234 迭代器</a></li>
<li><a href="https://www.python.org/dev/peps/pep-3129/" target="_blank" rel="noopener">PEP3129 类装饰器</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0318/" target="_blank" rel="noopener">PEP318 函数、方法装饰器</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0362/" target="_blank" rel="noopener">PEP362 函数签名对象</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0451/" target="_blank" rel="noopener">PEP451 A ModuleSpec Type for the Import System</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0328/" target="_blank" rel="noopener">PEP328 绝对相对import</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0343/" target="_blank" rel="noopener">PEP343 with语句</a></li>
<li><a href="https://www.python.org/dev/peps/pep-3154/" target="_blank" rel="noopener">PEP3154 Pickle protocol version 4</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0307/" target="_blank" rel="noopener">PEP307 Extensions to the pickle protocole</a></li>
<li><p><a href="https://www.python.org/dev/peps/pep-0342/" target="_blank" rel="noopener">PEP342 协程</a></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2></li>
</ul>
<ul>
<li><a href="https://www.python.org/dev/peps/" target="_blank" rel="noopener">Python PEPs</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PEP/">PEP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-八达岭长城"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/03/13/八达岭长城/">八达岭长城</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/03/13/八达岭长城/" class="article-date">
	  <time datetime="2017-03-13T11:21:49.000Z" itemprop="datePublished">March 13, 2017</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>骑行百里以前是躺在愿望单里了，现在已经成为一个现实，一段难忘的经历。</p>
<p>两个快奔三的人还跟个愣头青一样骑着自行车去长城，是逃离城市放松一下，抑或是证明自己还年轻，抑或是其他，答案未知。只知道去时，充满激情，一路狂奔（山路阶段艰难骑行）；回来时，身体很疲惫，但心灵得到了某种不知名的慰藉。</p>
<p><img src="https://bytebucket.org/hotbaby/resource/raw/c652673bc449badf42b4930169f532d1e807514e/八达岭/八达岭－起点1.jpg" alt></p>
<p><img src="https://bytebucket.org/hotbaby/resource/raw/c652673bc449badf42b4930169f532d1e807514e/八达岭/八达岭－居庸关.jpg" alt></p>
<p><img src="https://bytebucket.org/hotbaby/resource/raw/c652673bc449badf42b4930169f532d1e807514e/八达岭/八达岭－终点2.jpg" alt></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/八达岭长城/">八达岭长城</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/旅行/">旅行</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/7/">Next</a>
  </nav>


</section>
          <aside id="sidebar">
  
    <div style="margin: 20px 0;">
	<div id="search-form-wrap">

    <form class="search-form">
        <label style="width: 72%;">
            <span class="screen-reader-text">Search for:</span>
            <input type="search" class="search-field" style="height: 36px; width: 100%;" placeholder=" Search…" value="" name="s" title="Search for:">
        </label>
        <input type="submit" class="search-form-submit" value="Search">
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
</div>
  
    
  <div class="widget_athemes_tabs">
    <ul id="widget-tab" class="clearfix widget-tab-nav">
      <li class="active"><a>Recent Posts</a></li>
    </ul>
    <div class="widget">
      <ul>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2020/01/30/隆美尔战时文件/" title=""><img width="50" height="50" src="https://09.imgmini.eastday.com/mobile/20180410/20180410124332_72154d7daf3c4f0b32bac86c4b017149_1.jpeg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2020/01/30/隆美尔战时文件/">隆美尔战时文件</a></h6>
              <span>January 30, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2019/12/14/远去的胜利/" title=""><img width="50" height="50" src="https://img3.doubanio.com/lpic/s28387663.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2019/12/14/远去的胜利/">远去的胜利</a></h6>
              <span>December 14, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2019/11/30/闪击英雄/" title=""><img width="50" height="50" src="https://p1.ssl.qhimg.com/t0133bafd03c884b075.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2019/11/30/闪击英雄/">闪击英雄</a></h6>
              <span>November 30, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2019/11/06/华为研发/" title=""><img width="50" height="50" src="https://www.zaobao.com.sg/sites/default/files/styles/article_large_full/public/images/201901/20190125/20190125_opinion_renzhengfei.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2019/11/06/华为研发/">华为研发</a></h6>
              <span>November 6, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2019/10/05/美国陷阱/" title=""><img width="50" height="50" src="https://imgstatic.ctfile.com/upload/portal/19926596/HYj0oewG/20190530-1559217560551910.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2019/10/05/美国陷阱/">美国陷阱</a></h6>
              <span>October 5, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-thumbnail">
                <a href="/2019/10/02/邓小平时代/" title=""><img width="50" height="50" src="https://a1.att.hudong.com/80/02/01300543066068143247026369152.jpg" class="attachment-thumb-small size-thumb-small wp-post-image" alt="preview-16" title=""></a>
              </div>
              <div class="widget-entry-summary">
            

              <h6 style="margin: 0;"><a href="/2019/10/02/邓小平时代/">邓小平时代</a></h6>
              <span>October 2, 2019</span>
            </div>

          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>

    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">9</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/12306/" style="font-size: 10px;">12306</a> <a href="/tags/Debian/" style="font-size: 10px;">Debian</a> <a href="/tags/Decorator/" style="font-size: 10px;">Decorator</a> <a href="/tags/Django/" style="font-size: 16px;">Django</a> <a href="/tags/Flask/" style="font-size: 10px;">Flask</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Gitlab/" style="font-size: 10px;">Gitlab</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hacker/" style="font-size: 10px;">Hacker</a> <a href="/tags/Jekins/" style="font-size: 10px;">Jekins</a> <a href="/tags/Lisp/" style="font-size: 10px;">Lisp</a> <a href="/tags/MacOS/" style="font-size: 10px;">MacOS</a> <a href="/tags/McFarland/" style="font-size: 10px;">McFarland</a> <a href="/tags/Nginx/" style="font-size: 12px;">Nginx</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/OAuth/" style="font-size: 10px;">OAuth</a> <a href="/tags/PEP/" style="font-size: 10px;">PEP</a> <a href="/tags/PyPI/" style="font-size: 10px;">PyPI</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/RSS/" style="font-size: 10px;">RSS</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/WSGI/" style="font-size: 10px;">WSGI</a> <a href="/tags/万历十五年/" style="font-size: 10px;">万历十五年</a> <a href="/tags/三体/" style="font-size: 12px;">三体</a> <a href="/tags/三体2/" style="font-size: 10px;">三体2</a> <a href="/tags/二战/" style="font-size: 10px;">二战</a> <a href="/tags/人工智能/" style="font-size: 10px;">人工智能</a> <a href="/tags/任泽平/" style="font-size: 10px;">任泽平</a> <a href="/tags/八达岭长城/" style="font-size: 10px;">八达岭长城</a> <a href="/tags/凯恩斯主义/" style="font-size: 10px;">凯恩斯主义</a> <a href="/tags/刘慈欣/" style="font-size: 14px;">刘慈欣</a> <a href="/tags/区块链/" style="font-size: 10px;">区块链</a> <a href="/tags/华为/" style="font-size: 10px;">华为</a> <a href="/tags/原则/" style="font-size: 10px;">原则</a> <a href="/tags/奈飞/" style="font-size: 10px;">奈飞</a> <a href="/tags/微软/" style="font-size: 10px;">微软</a> <a href="/tags/战争/" style="font-size: 10px;">战争</a> <a href="/tags/房地产/" style="font-size: 10px;">房地产</a> <a href="/tags/抢票/" style="font-size: 10px;">抢票</a> <a href="/tags/文化/" style="font-size: 10px;">文化</a> <a href="/tags/旅行/" style="font-size: 12px;">旅行</a> <a href="/tags/朱镕基/" style="font-size: 10px;">朱镕基</a> <a href="/tags/机器学习/" style="font-size: 10px;">机器学习</a> <a href="/tags/村上春树/" style="font-size: 10px;">村上春树</a> <a href="/tags/查理·芒格/" style="font-size: 10px;">查理·芒格</a> <a href="/tags/桥水/" style="font-size: 10px;">桥水</a> <a href="/tags/比特币/" style="font-size: 10px;">比特币</a> <a href="/tags/深度学习/" style="font-size: 10px;">深度学习</a> <a href="/tags/电影/" style="font-size: 10px;">电影</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/索罗斯/" style="font-size: 10px;">索罗斯</a> <a href="/tags/经济学/" style="font-size: 10px;">经济学</a> <a href="/tags/缓存/" style="font-size: 10px;">缓存</a> <a href="/tags/腾讯/" style="font-size: 12px;">腾讯</a> <a href="/tags/萨提亚·纳德拉/" style="font-size: 10px;">萨提亚·纳德拉</a> <a href="/tags/读书/" style="font-size: 18px;">读书</a> <a href="/tags/跑步/" style="font-size: 12px;">跑步</a> <a href="/tags/邓小平/" style="font-size: 10px;">邓小平</a> <a href="/tags/金融/" style="font-size: 10px;">金融</a> <a href="/tags/隆美尔，战争/" style="font-size: 10px;">隆美尔，战争</a> <a href="/tags/马化腾/" style="font-size: 10px;">马化腾</a> <a href="/tags/黄仁宇/" style="font-size: 10px;">黄仁宇</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/12306/">12306</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian/">Debian</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Decorator/">Decorator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask/">Flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitlab/">Gitlab</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hacker/">Hacker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jekins/">Jekins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lisp/">Lisp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MacOS/">MacOS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/McFarland/">McFarland</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/">Node.js</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth/">OAuth</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PEP/">PEP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PyPI/">PyPI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RSS/">RSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WSGI/">WSGI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/万历十五年/">万历十五年</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/三体/">三体</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/三体2/">三体2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/二战/">二战</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/人工智能/">人工智能</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/任泽平/">任泽平</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/八达岭长城/">八达岭长城</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/凯恩斯主义/">凯恩斯主义</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/刘慈欣/">刘慈欣</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/区块链/">区块链</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/华为/">华为</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/原则/">原则</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/奈飞/">奈飞</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微软/">微软</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/战争/">战争</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/房地产/">房地产</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/抢票/">抢票</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文化/">文化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/旅行/">旅行</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/朱镕基/">朱镕基</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/村上春树/">村上春树</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/查理·芒格/">查理·芒格</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/桥水/">桥水</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/比特币/">比特币</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深度学习/">深度学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电影/">电影</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/索罗斯/">索罗斯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/经济学/">经济学</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/缓存/">缓存</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/腾讯/">腾讯</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/萨提亚·纳德拉/">萨提亚·纳德拉</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书/">读书</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/跑步/">跑步</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/邓小平/">邓小平</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/金融/">金融</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/隆美尔，战争/">隆美尔，战争</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/马化腾/">马化腾</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/黄仁宇/">黄仁宇</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2020 Mengyy&#39;s Blog All Rights Reserved.
        
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次  
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
          
      </div>
      <div class="site-credit">
        <!--
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
        -->
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
    
</script>

    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>








	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>



	<script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?{{ theme.baidu_analytics }}";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
